

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>terminal &mdash; Gate One 1.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/ansi.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="top" title="Gate One 1.1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Gate One Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for terminal</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#       Copyright 2011 Liftoff Software Corporation</span>
<span class="c">#</span>

<span class="c"># Meta</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.1&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;AGPLv3 or Proprietary (see LICENSE.txt)&quot;</span>
<span class="n">__version_info__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Dan McDougall &lt;daniel.mcdougall@liftoffsoftware.com&gt;&#39;</span>

<span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">About This Module</span>
<span class="s">=================</span>
<span class="s">This crux of this module is the Terminal class which is a pure-Python</span>
<span class="s">implementation of the quintessential Unix terminal emulator.  It does its best</span>
<span class="s">to emulate an xterm and along with that comes support for the majority of the</span>
<span class="s">relevant portions of ECMA-48.  This includes support for emulating varous VT-*</span>
<span class="s">terminal types as well as the &quot;linux&quot; terminal type.</span>

<span class="s">The Terminal class&#39;s VT-* emulation support is not complete but it should</span>
<span class="s">suffice for most terminal emulation needs (e.g. all your typical command line</span>
<span class="s">programs should work wonderfully).  If something doesn&#39;t look quite right or you</span>
<span class="s">need support for certain modes added please feel free to open a ticket on Gate</span>
<span class="s">One&#39;s issue tracker:  https://github.com/liftoff/GateOne/issues</span>

<span class="s">Note that Terminal was written from scratch in order to be as fast as possible.</span>
<span class="s">It is extensively commented and implements some interesting patterns in order to</span>
<span class="s">maximize execution speed (most notably for things that loop).  Some bits of code</span>
<span class="s">may seem &quot;un-Pythonic&quot; and/or difficult to grok but understand that this is</span>
<span class="s">probably due to optimizations.  If you know &quot;a better way&quot; please feel free to</span>
<span class="s">submit a patch, open a ticket, or send us an email.  There&#39;s a reason why open</span>
<span class="s">source software is a superior development model!</span>

<span class="s">Supported Emulation Types</span>
<span class="s">-------------------------</span>
<span class="s">Without any special mode settings or parameters Terminal should effectively</span>
<span class="s">emulate the following terminal types:</span>

<span class="s"> * xterm (the most important one)</span>
<span class="s"> * ECMA-48/ANSI X3.64</span>
<span class="s"> * Nearly all the VT-* types:  VT-52, VT-100, VT-220, VT-320, VT-420, and VT-520</span>
<span class="s"> * Linux console (&quot;linux&quot;)</span>

<span class="s">If you want Terminal to support something else or it&#39;s missing a feature from</span>
<span class="s">any given terminal type please `let us know &lt;https://github.com/liftoff/GateOne/issues/new&gt;`_.</span>
<span class="s">We&#39;ll implement it!</span>

<span class="s">What Terminal Doesn&#39;t Do</span>
<span class="s">------------------------</span>
<span class="s">The Terminal class is meant to emulate the display portion of a given terminal.</span>
<span class="s">It does not translate keystrokes into escape sequences or special control</span>
<span class="s">codes--you&#39;ll have to take care of that in your application (or at the</span>
<span class="s">client-side like Gate One).  It does, however, keep track of many</span>
<span class="s">keystroke-specific modes of operation such as Application Cursor Keys and the G0</span>
<span class="s">and G1 charset modes *with* callbacks that can be used to notify your</span>
<span class="s">application when such things change.</span>

<span class="s">Special Considerations</span>
<span class="s">----------------------</span>
<span class="s">Many methods inside Terminal start with an underscore.  This was done to</span>
<span class="s">indicate that such methods shouldn&#39;t be called directly (from a program that</span>
<span class="s">imported the module).  If it was thought that a situation might arise where a</span>
<span class="s">method could be used externally by a controlling program, the underscore was</span>
<span class="s">omitted.</span>

<span class="s">Asynchronous Use</span>
<span class="s">----------------</span>
<span class="s">To support asynchronous usage (and make everything faster), Terminal was written</span>
<span class="s">to support extensive callbacks that are called when certain events are</span>
<span class="s">encountered.  Here are the events and their callbacks:</span>

<span class="s">.. _callback_constants:</span>

<span class="s">====================================    ================================================================================</span>
<span class="s">Callback Constant (ID)                  Called when...</span>
<span class="s">====================================    ================================================================================</span>
<span class="s">:attr:`terminal.CALLBACK_SCROLL_UP`     The terminal is scrolled up (back).</span>
<span class="s">:attr:`terminal.CALLBACK_CHANGED`       The screen is changed/updated.</span>
<span class="s">:attr:`terminal.CALLBACK_CURSOR_POS`    The cursor position changes.</span>
<span class="s">:attr:`terminal.CALLBACK_DSR`           A Device Status Report (DSR) is requested (via the DSR escape sequence).</span>
<span class="s">:attr:`terminal.CALLBACK_TITLE`         The terminal title changes (xterm-style)</span>
<span class="s">:attr:`terminal.CALLBACK_BELL`          The bell character (^G) is encountered.</span>
<span class="s">:attr:`terminal.CALLBACK_OPT`           The special optional escape sequence is encountered.</span>
<span class="s">:attr:`terminal.CALLBACK_MODE`          The terminal mode setting changes (e.g. use alternate screen buffer).</span>
<span class="s">:attr:`terminal.CALLBACK_MESSAGE`       The terminal needs to send the user a message (without messing with the screen).</span>
<span class="s">====================================    ================================================================================</span>

<span class="s">Note that CALLBACK_DSR is special in that it in most cases it will be called with arguments.  See the code for examples of how and when this happens.</span>

<span class="s">Also, in most cases it is unwise to override CALLBACK_MODE since this method is primarily meant for internal use within the Terminal class.</span>

<span class="s">Using Terminal</span>
<span class="s">--------------</span>
<span class="s">Gate One makes extensive use of the Terminal class and its callbacks.  So that&#39;s</span>
<span class="s">a great place to look for specific examples (gateone.py and termio.py,</span>
<span class="s">specifically).  Having said that, implementing Terminal is pretty</span>
<span class="s">straightforward::</span>

<span class="s">    &gt;&gt;&gt; import terminal</span>
<span class="s">    &gt;&gt;&gt; term = terminal.Terminal(24, 80)</span>
<span class="s">    &gt;&gt;&gt; term.write(&quot;This text will be written to the terminal screen.&quot;)</span>
<span class="s">    &gt;&gt;&gt; term.dump()</span>
<span class="s">    [u&#39;This text will be written to the terminal screen.                               &#39;,</span>
<span class="s">    &lt;snip&gt;</span>
<span class="s">    u&#39;                                                                                &#39;]</span>

<span class="s">Here&#39;s an example with some basic callbacks:</span>

<span class="s">    &gt;&gt;&gt; def mycallback():</span>
<span class="s">    ...     &quot;This will be called whenever the screen changes.&quot;</span>
<span class="s">    ...     print(&quot;Screen update! Perfect time to dump the terminal screen.&quot;)</span>
<span class="s">    ...     print(term.dump()[0]) # Only need to see the top line for this demo =)</span>
<span class="s">    ...     print(&quot;Just dumped the screen.&quot;)</span>
<span class="s">    &gt;&gt;&gt; import terminal</span>
<span class="s">    &gt;&gt;&gt; term = terminal.Terminal(24, 80)</span>
<span class="s">    &gt;&gt;&gt; term.callbacks[term.CALLBACK_CHANGED] = mycallback</span>
<span class="s">    &gt;&gt;&gt; term.write(&quot;This should result in mycallback() being called&quot;)</span>
<span class="s">    Screen update! Perfect time to dump the terminal screen.</span>
<span class="s">    This should result in mycallback() being called</span>
<span class="s">    Just dumped the screen.</span>

<span class="s">.. note:: In testing Gate One it was determined that it is faster to perform the conversion of a terminal screen to HTML on the server side than it is on the client side (via JavaScript anyway).</span>

<span class="s">About The Scrollback Bufffer</span>
<span class="s">----------------------------</span>
<span class="s">The Terminal class implements a scrollback buffer.  Here&#39;s how it works:</span>
<span class="s">Whenever a :meth:`Terminal.scroll_up` event occurs, the line (or lines) that</span>
<span class="s">will be removed from the top of the screen will be placed into</span>
<span class="s">:attr:`Terminal.scrollback_buf`. Then whenever :meth:`Terminal.dump_html` is</span>
<span class="s">called the scrollback buffer will be returned along with the screen output and</span>
<span class="s">reset to an empty state.</span>

<span class="s">Why do this?  In the event that a very large :meth:`Terminal.write` occurs (e.g.</span>
<span class="s">&#39;ps aux&#39;), it gives the controlling program the ability to capture what went</span>
<span class="s">past the screen without some fancy tracking logic surrounding</span>
<span class="s">:meth:`Terminal.write`.</span>

<span class="s">More information about how this works can be had by looking at the</span>
<span class="s">:meth:`Terminal.dump_html` function itself.</span>

<span class="s">.. note:: There&#39;s more than one function that empties :attr:`Terminal.scrollback_buf` when called.  You&#39;ll just have to have a look around =)</span>

<span class="s">Class Docstrings</span>
<span class="s">================</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="c"># Import stdlib stuff</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">StringIO</span><span class="o">,</span> <span class="nn">codecs</span><span class="o">,</span> <span class="nn">unicodedata</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="c"># Python &lt;2.7 didn&#39;t have OrderedDict in collections</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">ordereddict</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s">&quot;Error: Could not import OrderedDict.  Please install it:&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">sudo pip install ordereddict&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s">&quot;...or download it from http://pypi.python.org/pypi/ordereddict&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">imap</span><span class="p">,</span> <span class="n">izip</span>

<span class="c"># Inernationalization support</span>
<span class="kn">import</span> <span class="nn">gettext</span>
<span class="n">gettext</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="s">&#39;terminal&#39;</span><span class="p">)</span>

<span class="c"># Import 3rd party stuff</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c"># We need PIL to detect image types and get their dimensions.  Without the</span>
    <span class="c"># dimenions, the browser will render the terminal screen much slower than</span>
    <span class="c"># normal.  Without PIL images will be displayed simply as:</span>
    <span class="c">#   &lt;i&gt;Image file&lt;/i&gt;</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">Image</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
        <span class="s">&quot;Could not import the Python Imaging Library (PIL).  &quot;</span>
        <span class="s">&quot;Images will not be displayed in the terminal.&quot;</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
        <span class="s">&quot;TIP: Pillow is a &#39;friendly fork&#39; of PIL that has been updated to work &quot;</span>
        <span class="s">&quot;with Python 3 (also works in Python 2.X).  You can install it with &quot;</span>
        <span class="s">&quot;&#39;pip install --upgrade Pillow&#39;.&quot;</span><span class="p">))</span>

<span class="c"># Globals</span>
<span class="n">CALLBACK_SCROLL_UP</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c"># Called after a scroll up event (new line)</span>
<span class="n">CALLBACK_CHANGED</span> <span class="o">=</span> <span class="mi">2</span>      <span class="c"># Called after the screen is updated</span>
<span class="n">CALLBACK_CURSOR_POS</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c"># Called after the cursor position is updated</span>
<span class="c"># &lt;waives hand in air&gt; You are not concerned with the number 4</span>
<span class="n">CALLBACK_DSR</span> <span class="o">=</span> <span class="mi">5</span>          <span class="c"># Called when a DSR requires a response</span>
<span class="c"># NOTE: CALLBACK_DSR must accept &#39;response&#39; as either the first argument or</span>
<span class="c">#       as a keyword argument.</span>
<span class="n">CALLBACK_TITLE</span> <span class="o">=</span> <span class="mi">6</span>        <span class="c"># Called when the terminal sets the window title</span>
<span class="n">CALLBACK_BELL</span> <span class="o">=</span> <span class="mi">7</span>         <span class="c"># Called after ASCII_BEL is encountered.</span>
<span class="n">CALLBACK_OPT</span> <span class="o">=</span> <span class="mi">8</span> <span class="c"># Called when we encounter the optional ESC sequence</span>
<span class="c"># NOTE: CALLBACK_OPT must accept &#39;chars&#39; as either the first argument or as</span>
<span class="c">#       a keyword argument.</span>
<span class="n">CALLBACK_MODE</span> <span class="o">=</span> <span class="mi">9</span> <span class="c"># Called when the terminal mode changes (e.g. DECCKM)</span>
<span class="n">CALLBACK_RESET</span> <span class="o">=</span> <span class="mi">10</span> <span class="c"># Called when a terminal reset (^[[!p) is encountered</span>
<span class="n">CALLBACK_LEDS</span> <span class="o">=</span> <span class="mi">11</span> <span class="c"># Called when the state of the LEDs changes</span>
<span class="c"># Called when the terminal emulator encounters a situation where it wants to</span>
<span class="c"># tell the user about something (say, an error decoding an image) without</span>
<span class="c"># interfering with the terminal&#39;s screen.</span>
<span class="n">CALLBACK_MESSAGE</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c"># These are for HTML output:</span>
<span class="n">RENDITION_CLASSES</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="c"># Special: Return everything to defaults</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;bold&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;dim&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;italic&#39;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;underline&#39;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;blink&#39;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;fastblink&#39;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;reverse&#39;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;hidden&#39;</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s">&#39;strike&#39;</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s">&#39;resetfont&#39;</span><span class="p">,</span> <span class="c"># NOTE: The font renditions don&#39;t do anything right now</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s">&#39;font11&#39;</span><span class="p">,</span> <span class="c"># Mostly because I have no idea what they are supposed to look</span>
    <span class="mi">12</span><span class="p">:</span> <span class="s">&#39;font12&#39;</span><span class="p">,</span> <span class="c"># like.</span>
    <span class="mi">13</span><span class="p">:</span> <span class="s">&#39;font13&#39;</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="s">&#39;font14&#39;</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="s">&#39;font15&#39;</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;font16&#39;</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="s">&#39;font17&#39;</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="s">&#39;font18&#39;</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="s">&#39;font19&#39;</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="s">&#39;fraktur&#39;</span><span class="p">,</span>
    <span class="mi">21</span><span class="p">:</span> <span class="s">&#39;boldreset&#39;</span><span class="p">,</span>
    <span class="mi">22</span><span class="p">:</span> <span class="s">&#39;dimreset&#39;</span><span class="p">,</span>
    <span class="mi">23</span><span class="p">:</span> <span class="s">&#39;italicreset&#39;</span><span class="p">,</span>
    <span class="mi">24</span><span class="p">:</span> <span class="s">&#39;underlinereset&#39;</span><span class="p">,</span>
    <span class="mi">27</span><span class="p">:</span> <span class="s">&#39;reversereset&#39;</span><span class="p">,</span>
    <span class="mi">28</span><span class="p">:</span> <span class="s">&#39;hiddenreset&#39;</span><span class="p">,</span>
    <span class="mi">29</span><span class="p">:</span> <span class="s">&#39;strikereset&#39;</span><span class="p">,</span>
    <span class="c"># Foregrounds</span>
    <span class="mi">30</span><span class="p">:</span> <span class="s">&#39;f0&#39;</span><span class="p">,</span> <span class="c"># Black</span>
    <span class="mi">31</span><span class="p">:</span> <span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="c"># Red</span>
    <span class="mi">32</span><span class="p">:</span> <span class="s">&#39;f2&#39;</span><span class="p">,</span> <span class="c"># Green</span>
    <span class="mi">33</span><span class="p">:</span> <span class="s">&#39;f3&#39;</span><span class="p">,</span> <span class="c"># Yellow</span>
    <span class="mi">34</span><span class="p">:</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="c"># Blue</span>
    <span class="mi">35</span><span class="p">:</span> <span class="s">&#39;f5&#39;</span><span class="p">,</span> <span class="c"># Magenta</span>
    <span class="mi">36</span><span class="p">:</span> <span class="s">&#39;f6&#39;</span><span class="p">,</span> <span class="c"># Cyan</span>
    <span class="mi">37</span><span class="p">:</span> <span class="s">&#39;f7&#39;</span><span class="p">,</span> <span class="c"># White</span>
    <span class="mi">38</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># 256-color support uses this like so: \x1b[38;5;&lt;color num&gt;sm</span>
    <span class="c"># Backgrounds</span>
    <span class="mi">40</span><span class="p">:</span> <span class="s">&#39;b0&#39;</span><span class="p">,</span> <span class="c"># Black</span>
    <span class="mi">41</span><span class="p">:</span> <span class="s">&#39;b1&#39;</span><span class="p">,</span> <span class="c"># Red</span>
    <span class="mi">42</span><span class="p">:</span> <span class="s">&#39;b2&#39;</span><span class="p">,</span> <span class="c"># Green</span>
    <span class="mi">43</span><span class="p">:</span> <span class="s">&#39;b3&#39;</span><span class="p">,</span> <span class="c"># Yellow</span>
    <span class="mi">44</span><span class="p">:</span> <span class="s">&#39;b4&#39;</span><span class="p">,</span> <span class="c"># Blue</span>
    <span class="mi">45</span><span class="p">:</span> <span class="s">&#39;b5&#39;</span><span class="p">,</span> <span class="c"># Magenta</span>
    <span class="mi">46</span><span class="p">:</span> <span class="s">&#39;b6&#39;</span><span class="p">,</span> <span class="c"># Cyan</span>
    <span class="mi">47</span><span class="p">:</span> <span class="s">&#39;b7&#39;</span><span class="p">,</span> <span class="c"># White</span>
    <span class="mi">48</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># 256-color support uses this like so: \x1b[48;5;&lt;color num&gt;sm</span>
    <span class="mi">49</span><span class="p">:</span> <span class="s">&#39;backgroundreset&#39;</span><span class="p">,</span> <span class="c"># Special: Set BG to default</span>
    <span class="mi">51</span><span class="p">:</span> <span class="s">&#39;frame&#39;</span><span class="p">,</span>
    <span class="mi">52</span><span class="p">:</span> <span class="s">&#39;encircle&#39;</span><span class="p">,</span>
    <span class="mi">53</span><span class="p">:</span> <span class="s">&#39;overline&#39;</span><span class="p">,</span>
    <span class="mi">60</span><span class="p">:</span> <span class="s">&#39;rightline&#39;</span><span class="p">,</span>
    <span class="mi">61</span><span class="p">:</span> <span class="s">&#39;rightdoubleline&#39;</span><span class="p">,</span>
    <span class="mi">62</span><span class="p">:</span> <span class="s">&#39;leftline&#39;</span><span class="p">,</span>
    <span class="mi">63</span><span class="p">:</span> <span class="s">&#39;leftdoubleline&#39;</span><span class="p">,</span>
    <span class="c"># aixterm colors (aka &#39;16 color support&#39;).  They&#39;re supposed to be &#39;bright&#39;</span>
    <span class="c"># versions of the first 8 colors (hence the &#39;b&#39;).</span>
    <span class="c"># &#39;Bright&#39; Foregrounds</span>
    <span class="mi">90</span><span class="p">:</span> <span class="s">&#39;bf0&#39;</span><span class="p">,</span> <span class="c"># Bright black (whatever that is =)</span>
    <span class="mi">91</span><span class="p">:</span> <span class="s">&#39;bf1&#39;</span><span class="p">,</span> <span class="c"># Bright red</span>
    <span class="mi">92</span><span class="p">:</span> <span class="s">&#39;bf2&#39;</span><span class="p">,</span> <span class="c"># Bright green</span>
    <span class="mi">93</span><span class="p">:</span> <span class="s">&#39;bf3&#39;</span><span class="p">,</span> <span class="c"># Bright yellow</span>
    <span class="mi">94</span><span class="p">:</span> <span class="s">&#39;bf4&#39;</span><span class="p">,</span> <span class="c"># Bright blue</span>
    <span class="mi">95</span><span class="p">:</span> <span class="s">&#39;bf5&#39;</span><span class="p">,</span> <span class="c"># Bright magenta</span>
    <span class="mi">96</span><span class="p">:</span> <span class="s">&#39;bf6&#39;</span><span class="p">,</span> <span class="c"># Bright cyan</span>
    <span class="mi">97</span><span class="p">:</span> <span class="s">&#39;bf7&#39;</span><span class="p">,</span> <span class="c"># Bright white</span>
<span class="c"># TODO:  Handle the ESC sequence that sets the colors from 90-87 (e.g. ESC]91;orange/brown^G)</span>
    <span class="c"># &#39;Bright&#39; Backgrounds</span>
    <span class="mi">100</span><span class="p">:</span> <span class="s">&#39;bb0&#39;</span><span class="p">,</span> <span class="c"># Bright black</span>
    <span class="mi">101</span><span class="p">:</span> <span class="s">&#39;bb1&#39;</span><span class="p">,</span> <span class="c"># Bright red</span>
    <span class="mi">102</span><span class="p">:</span> <span class="s">&#39;bb2&#39;</span><span class="p">,</span> <span class="c"># Bright green</span>
    <span class="mi">103</span><span class="p">:</span> <span class="s">&#39;bb3&#39;</span><span class="p">,</span> <span class="c"># Bright yellow</span>
    <span class="mi">104</span><span class="p">:</span> <span class="s">&#39;bb4&#39;</span><span class="p">,</span> <span class="c"># Bright blue</span>
    <span class="mi">105</span><span class="p">:</span> <span class="s">&#39;bb5&#39;</span><span class="p">,</span> <span class="c"># Bright magenta</span>
    <span class="mi">106</span><span class="p">:</span> <span class="s">&#39;bb6&#39;</span><span class="p">,</span> <span class="c"># Bright cyan</span>
    <span class="mi">107</span><span class="p">:</span> <span class="s">&#39;bb7&#39;</span> <span class="c"># Bright white</span>
<span class="p">})</span>
<span class="c"># Generate the dict of 256-color (xterm) foregrounds and backgrounds</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">RENDITION_CLASSES</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1000</span><span class="p">)]</span> <span class="o">=</span> <span class="s">&quot;fx</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">i</span>
    <span class="n">RENDITION_CLASSES</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">10000</span><span class="p">)]</span> <span class="o">=</span> <span class="s">&quot;bx</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">i</span>
<span class="k">del</span> <span class="n">i</span> <span class="c"># Cleanup</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">unichr</span><span class="p">(</span><span class="mh">0x10000</span><span class="p">)</span> <span class="c"># Will throw a ValueError on narrow Python builds</span>
    <span class="n">SPECIAL</span> <span class="o">=</span> <span class="mi">1048576</span> <span class="c"># U+100000 or unichr(SPECIAL) (start of Plane 16)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">SPECIAL</span> <span class="o">=</span> <span class="mi">63561</span>

<div class="viewcode-block" id="handle_special"><a class="viewcode-back" href="../Developer/terminal.html#terminal.handle_special">[docs]</a><span class="k">def</span> <span class="nf">handle_special</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used in conjunction with :py:func:`codecs.register_error`, will replace</span>
<span class="sd">    special ascii characters such as 0xDA and 0xc4 (which are used by ncurses)</span>
<span class="sd">    with their Unicode equivalents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># TODO: Get this using curses special characters when appropriate</span>
    <span class="c">#curses_specials = {</span>
        <span class="c">## NOTE: When $TERM is set to &quot;Linux&quot; these end up getting used by things</span>
        <span class="c">##       like ncurses-based apps.  In other words, it makes a whole lot</span>
        <span class="c">##       of ugly look pretty again.</span>
        <span class="c">#0xda: u&#39;┌&#39;, # ACS_ULCORNER</span>
        <span class="c">#0xc0: u&#39;└&#39;, # ACS_LLCORNER</span>
        <span class="c">#0xbf: u&#39;┐&#39;, # ACS_URCORNER</span>
        <span class="c">#0xd9: u&#39;┘&#39;, # ACS_LRCORNER</span>
        <span class="c">#0xb4: u&#39;├&#39;, # ACS_RTEE</span>
        <span class="c">#0xc3: u&#39;┤&#39;, # ACS_LTEE</span>
        <span class="c">#0xc1: u&#39;┴&#39;, # ACS_BTEE</span>
        <span class="c">#0xc2: u&#39;┬&#39;, # ACS_TTEE</span>
        <span class="c">#0xc4: u&#39;─&#39;, # ACS_HLINE</span>
        <span class="c">#0xb3: u&#39;│&#39;, # ACS_VLINE</span>
        <span class="c">#0xc5: u&#39;┼&#39;, # ACS_PLUS</span>
        <span class="c">#0x2d: u&#39;&#39;, # ACS_S1</span>
        <span class="c">#0x5f: u&#39;&#39;, # ACS_S9</span>
        <span class="c">#0x60: u&#39;◆&#39;, # ACS_DIAMOND</span>
        <span class="c">#0xb2: u&#39;▒&#39;, # ACS_CKBOARD</span>
        <span class="c">#0xf8: u&#39;°&#39;, # ACS_DEGREE</span>
        <span class="c">#0xf1: u&#39;±&#39;, # ACS_PLMINUS</span>
        <span class="c">#0xf9: u&#39;•&#39;, # ACS_BULLET</span>
        <span class="c">#0x3c: u&#39;←&#39;, # ACS_LARROW</span>
        <span class="c">#0x3e: u&#39;→&#39;, # ACS_RARROW</span>
        <span class="c">#0x76: u&#39;↓&#39;, # ACS_DARROW</span>
        <span class="c">#0x5e: u&#39;↑&#39;, # ACS_UARROW</span>
        <span class="c">#0xb0: u&#39;⊞&#39;, # ACS_BOARD</span>
        <span class="c">#0x0f: u&#39;⨂&#39;, # ACS_LANTERN</span>
        <span class="c">#0xdb: u&#39;█&#39;, # ACS_BLOCK</span>
    <span class="c">#}</span>
    <span class="n">specials</span> <span class="o">=</span> <span class="p">{</span>
<span class="c"># Note to self:  Why did I bother with these overly descriptive comments?  Ugh</span>
<span class="c"># I&#39;ve been staring at obscure symbols far too much lately ⨀_⨀</span>
        <span class="mi">128</span><span class="p">:</span> <span class="s">u&#39;€&#39;</span><span class="p">,</span> <span class="c"># Euro sign</span>
        <span class="mi">129</span><span class="p">:</span> <span class="s">u&#39; &#39;</span><span class="p">,</span> <span class="c"># Unknown (Using non-breaking spaces for all unknowns)</span>
        <span class="mi">130</span><span class="p">:</span> <span class="s">u&#39;‚&#39;</span><span class="p">,</span> <span class="c"># Single low-9 quotation mark</span>
        <span class="mi">131</span><span class="p">:</span> <span class="s">u&#39;ƒ&#39;</span><span class="p">,</span> <span class="c"># Latin small letter f with hook</span>
        <span class="mi">132</span><span class="p">:</span> <span class="s">u&#39;„&#39;</span><span class="p">,</span> <span class="c"># Double low-9 quotation mark</span>
        <span class="mi">133</span><span class="p">:</span> <span class="s">u&#39;…&#39;</span><span class="p">,</span> <span class="c"># Horizontal ellipsis</span>
        <span class="mi">134</span><span class="p">:</span> <span class="s">u&#39;†&#39;</span><span class="p">,</span> <span class="c"># Dagger</span>
        <span class="mi">135</span><span class="p">:</span> <span class="s">u&#39;‡&#39;</span><span class="p">,</span> <span class="c"># Double dagger</span>
        <span class="mi">136</span><span class="p">:</span> <span class="s">u&#39;ˆ&#39;</span><span class="p">,</span> <span class="c"># Modifier letter circumflex accent</span>
        <span class="mi">137</span><span class="p">:</span> <span class="s">u&#39;‰&#39;</span><span class="p">,</span> <span class="c"># Per mille sign</span>
        <span class="mi">138</span><span class="p">:</span> <span class="s">u&#39;Š&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter S with caron</span>
        <span class="mi">139</span><span class="p">:</span> <span class="s">u&#39;‹&#39;</span><span class="p">,</span> <span class="c"># Single left-pointing angle quotation</span>
        <span class="mi">140</span><span class="p">:</span> <span class="s">u&#39;Œ&#39;</span><span class="p">,</span> <span class="c"># Latin capital ligature OE</span>
        <span class="mi">141</span><span class="p">:</span> <span class="s">u&#39; &#39;</span><span class="p">,</span> <span class="c"># Unknown</span>
        <span class="mi">142</span><span class="p">:</span> <span class="s">u&#39;Ž&#39;</span><span class="p">,</span> <span class="c">#  Latin captial letter Z with caron</span>
        <span class="mi">143</span><span class="p">:</span> <span class="s">u&#39; &#39;</span><span class="p">,</span> <span class="c"># Unknown</span>
        <span class="mi">144</span><span class="p">:</span> <span class="s">u&#39; &#39;</span><span class="p">,</span> <span class="c"># Unknown</span>
        <span class="mi">145</span><span class="p">:</span> <span class="s">u&#39;‘&#39;</span><span class="p">,</span> <span class="c"># Left single quotation mark</span>
        <span class="mi">146</span><span class="p">:</span> <span class="s">u&#39;’&#39;</span><span class="p">,</span> <span class="c"># Right single quotation mark</span>
        <span class="mi">147</span><span class="p">:</span> <span class="s">u&#39;“&#39;</span><span class="p">,</span> <span class="c"># Left double quotation mark</span>
        <span class="mi">148</span><span class="p">:</span> <span class="s">u&#39;”&#39;</span><span class="p">,</span> <span class="c"># Right double quotation mark</span>
        <span class="mi">149</span><span class="p">:</span> <span class="s">u&#39;•&#39;</span><span class="p">,</span> <span class="c"># Bullet</span>
        <span class="mi">150</span><span class="p">:</span> <span class="s">u&#39;–&#39;</span><span class="p">,</span> <span class="c"># En dash</span>
        <span class="mi">151</span><span class="p">:</span> <span class="s">u&#39;—&#39;</span><span class="p">,</span> <span class="c"># Em dash</span>
        <span class="mi">152</span><span class="p">:</span> <span class="s">u&#39;˜&#39;</span><span class="p">,</span> <span class="c"># Small tilde</span>
        <span class="mi">153</span><span class="p">:</span> <span class="s">u&#39;™&#39;</span><span class="p">,</span> <span class="c"># Trade mark sign</span>
        <span class="mi">154</span><span class="p">:</span> <span class="s">u&#39;š&#39;</span><span class="p">,</span> <span class="c"># Latin small letter S with caron</span>
        <span class="mi">155</span><span class="p">:</span> <span class="s">u&#39;›&#39;</span><span class="p">,</span> <span class="c">#  Single right-pointing angle quotation mark</span>
        <span class="mi">156</span><span class="p">:</span> <span class="s">u&#39;œ&#39;</span><span class="p">,</span> <span class="c"># Latin small ligature oe</span>
        <span class="mi">157</span><span class="p">:</span> <span class="s">u&#39;Ø&#39;</span><span class="p">,</span> <span class="c"># Upper-case slashed zero--using same as empty set (216)</span>
        <span class="mi">158</span><span class="p">:</span> <span class="s">u&#39;ž&#39;</span><span class="p">,</span> <span class="c"># Latin small letter z with caron</span>
        <span class="mi">159</span><span class="p">:</span> <span class="s">u&#39;Ÿ&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter Y with diaeresis</span>
        <span class="mi">160</span><span class="p">:</span> <span class="s">u&#39; &#39;</span><span class="p">,</span> <span class="c"># Non-breaking space</span>
        <span class="mi">161</span><span class="p">:</span> <span class="s">u&#39;¡&#39;</span><span class="p">,</span> <span class="c"># Inverted exclamation mark</span>
        <span class="mi">162</span><span class="p">:</span> <span class="s">u&#39;¢&#39;</span><span class="p">,</span> <span class="c"># Cent sign</span>
        <span class="mi">163</span><span class="p">:</span> <span class="s">u&#39;£&#39;</span><span class="p">,</span> <span class="c"># Pound sign</span>
        <span class="mi">164</span><span class="p">:</span> <span class="s">u&#39;¤&#39;</span><span class="p">,</span> <span class="c"># Currency sign</span>
        <span class="mi">165</span><span class="p">:</span> <span class="s">u&#39;¥&#39;</span><span class="p">,</span> <span class="c"># Yen sign</span>
        <span class="mi">166</span><span class="p">:</span> <span class="s">u&#39;¦&#39;</span><span class="p">,</span> <span class="c"># Pipe, Broken vertical bar</span>
        <span class="mi">167</span><span class="p">:</span> <span class="s">u&#39;§&#39;</span><span class="p">,</span> <span class="c"># Section sign</span>
        <span class="mi">168</span><span class="p">:</span> <span class="s">u&#39;¨&#39;</span><span class="p">,</span> <span class="c"># Spacing diaeresis - umlaut</span>
        <span class="mi">169</span><span class="p">:</span> <span class="s">u&#39;©&#39;</span><span class="p">,</span> <span class="c"># Copyright sign</span>
        <span class="mi">170</span><span class="p">:</span> <span class="s">u&#39;ª&#39;</span><span class="p">,</span> <span class="c"># Feminine ordinal indicator</span>
        <span class="mi">171</span><span class="p">:</span> <span class="s">u&#39;«&#39;</span><span class="p">,</span> <span class="c"># Left double angle quotes</span>
        <span class="mi">172</span><span class="p">:</span> <span class="s">u&#39;¬&#39;</span><span class="p">,</span> <span class="c"># Not sign</span>
        <span class="mi">173</span><span class="p">:</span> <span class="s">u&quot;</span><span class="se">\u00AD</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># Soft hyphen</span>
        <span class="mi">174</span><span class="p">:</span> <span class="s">u&#39;®&#39;</span><span class="p">,</span> <span class="c"># Registered trade mark sign</span>
        <span class="mi">175</span><span class="p">:</span> <span class="s">u&#39;¯&#39;</span><span class="p">,</span> <span class="c"># Spacing macron - overline</span>
        <span class="mi">176</span><span class="p">:</span> <span class="s">u&#39;°&#39;</span><span class="p">,</span> <span class="c"># Degree sign</span>
        <span class="mi">177</span><span class="p">:</span> <span class="s">u&#39;±&#39;</span><span class="p">,</span> <span class="c"># Plus-or-minus sign</span>
        <span class="mi">178</span><span class="p">:</span> <span class="s">u&#39;²&#39;</span><span class="p">,</span> <span class="c"># Superscript two - squared</span>
        <span class="mi">179</span><span class="p">:</span> <span class="s">u&#39;³&#39;</span><span class="p">,</span> <span class="c"># Superscript three - cubed</span>
        <span class="mi">180</span><span class="p">:</span> <span class="s">u&#39;´&#39;</span><span class="p">,</span> <span class="c"># Acute accent - spacing acute</span>
        <span class="mi">181</span><span class="p">:</span> <span class="s">u&#39;µ&#39;</span><span class="p">,</span> <span class="c"># Micro sign</span>
        <span class="mi">182</span><span class="p">:</span> <span class="s">u&#39;¶&#39;</span><span class="p">,</span> <span class="c"># Pilcrow sign - paragraph sign</span>
        <span class="mi">183</span><span class="p">:</span> <span class="s">u&#39;·&#39;</span><span class="p">,</span> <span class="c"># Middle dot - Georgian comma</span>
        <span class="mi">184</span><span class="p">:</span> <span class="s">u&#39;¸&#39;</span><span class="p">,</span> <span class="c"># Spacing cedilla</span>
        <span class="mi">185</span><span class="p">:</span> <span class="s">u&#39;¹&#39;</span><span class="p">,</span> <span class="c"># Superscript one</span>
        <span class="mi">186</span><span class="p">:</span> <span class="s">u&#39;º&#39;</span><span class="p">,</span> <span class="c"># Masculine ordinal indicator</span>
        <span class="mi">187</span><span class="p">:</span> <span class="s">u&#39;»&#39;</span><span class="p">,</span> <span class="c"># Right double angle quotes</span>
        <span class="mi">188</span><span class="p">:</span> <span class="s">u&#39;¼&#39;</span><span class="p">,</span> <span class="c"># Fraction one quarter</span>
        <span class="mi">189</span><span class="p">:</span> <span class="s">u&#39;½&#39;</span><span class="p">,</span> <span class="c"># Fraction one half</span>
        <span class="mi">190</span><span class="p">:</span> <span class="s">u&#39;¾&#39;</span><span class="p">,</span> <span class="c"># Fraction three quarters</span>
        <span class="mi">191</span><span class="p">:</span> <span class="s">u&#39;¿&#39;</span><span class="p">,</span> <span class="c"># Inverted question mark</span>
        <span class="mi">192</span><span class="p">:</span> <span class="s">u&#39;À&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter A with grave</span>
        <span class="mi">193</span><span class="p">:</span> <span class="s">u&#39;Á&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter A with acute</span>
        <span class="mi">194</span><span class="p">:</span> <span class="s">u&#39;Â&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter A with circumflex</span>
        <span class="mi">195</span><span class="p">:</span> <span class="s">u&#39;Ã&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter A with tilde</span>
        <span class="mi">196</span><span class="p">:</span> <span class="s">u&#39;Ä&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter A with diaeresis</span>
        <span class="mi">197</span><span class="p">:</span> <span class="s">u&#39;Å&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter A with ring above</span>
        <span class="mi">198</span><span class="p">:</span> <span class="s">u&#39;Æ&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter AE</span>
        <span class="mi">199</span><span class="p">:</span> <span class="s">u&#39;Ç&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter C with cedilla</span>
        <span class="mi">200</span><span class="p">:</span> <span class="s">u&#39;È&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter E with grave</span>
        <span class="mi">201</span><span class="p">:</span> <span class="s">u&#39;É&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter E with acute</span>
        <span class="mi">202</span><span class="p">:</span> <span class="s">u&#39;Ê&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter E with circumflex</span>
        <span class="mi">203</span><span class="p">:</span> <span class="s">u&#39;Ë&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter E with diaeresis</span>
        <span class="mi">204</span><span class="p">:</span> <span class="s">u&#39;Ì&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter I with grave</span>
        <span class="mi">205</span><span class="p">:</span> <span class="s">u&#39;Í&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter I with acute</span>
        <span class="mi">206</span><span class="p">:</span> <span class="s">u&#39;Î&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter I with circumflex</span>
        <span class="mi">207</span><span class="p">:</span> <span class="s">u&#39;Ï&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter I with diaeresis</span>
        <span class="mi">208</span><span class="p">:</span> <span class="s">u&#39;Ð&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter ETH</span>
        <span class="mi">209</span><span class="p">:</span> <span class="s">u&#39;Ñ&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter N with tilde</span>
        <span class="mi">210</span><span class="p">:</span> <span class="s">u&#39;Ò&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter O with grave</span>
        <span class="mi">211</span><span class="p">:</span> <span class="s">u&#39;Ó&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter O with acute</span>
        <span class="mi">212</span><span class="p">:</span> <span class="s">u&#39;Ô&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter O with circumflex</span>
        <span class="mi">213</span><span class="p">:</span> <span class="s">u&#39;Õ&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter O with tilde</span>
        <span class="mi">214</span><span class="p">:</span> <span class="s">u&#39;Ö&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter O with diaeresis</span>
        <span class="mi">215</span><span class="p">:</span> <span class="s">u&#39;×&#39;</span><span class="p">,</span> <span class="c"># Multiplication sign</span>
        <span class="mi">216</span><span class="p">:</span> <span class="s">u&#39;Ø&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter O with slash (aka &quot;empty set&quot;)</span>
        <span class="mi">217</span><span class="p">:</span> <span class="s">u&#39;Ù&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter U with grave</span>
        <span class="mi">218</span><span class="p">:</span> <span class="s">u&#39;Ú&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter U with acute</span>
        <span class="mi">219</span><span class="p">:</span> <span class="s">u&#39;Û&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter U with circumflex</span>
        <span class="mi">220</span><span class="p">:</span> <span class="s">u&#39;Ü&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter U with diaeresis</span>
        <span class="mi">221</span><span class="p">:</span> <span class="s">u&#39;Ý&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter Y with acute</span>
        <span class="mi">222</span><span class="p">:</span> <span class="s">u&#39;Þ&#39;</span><span class="p">,</span> <span class="c"># Latin capital letter THORN</span>
        <span class="mi">223</span><span class="p">:</span> <span class="s">u&#39;ß&#39;</span><span class="p">,</span> <span class="c"># Latin small letter sharp s - ess-zed</span>
        <span class="mi">224</span><span class="p">:</span> <span class="s">u&#39;à&#39;</span><span class="p">,</span> <span class="c"># Latin small letter a with grave</span>
        <span class="mi">225</span><span class="p">:</span> <span class="s">u&#39;á&#39;</span><span class="p">,</span> <span class="c"># Latin small letter a with acute</span>
        <span class="mi">226</span><span class="p">:</span> <span class="s">u&#39;â&#39;</span><span class="p">,</span> <span class="c"># Latin small letter a with circumflex</span>
        <span class="mi">227</span><span class="p">:</span> <span class="s">u&#39;ã&#39;</span><span class="p">,</span> <span class="c"># Latin small letter a with tilde</span>
        <span class="mi">228</span><span class="p">:</span> <span class="s">u&#39;ä&#39;</span><span class="p">,</span> <span class="c"># Latin small letter a with diaeresis</span>
        <span class="mi">229</span><span class="p">:</span> <span class="s">u&#39;å&#39;</span><span class="p">,</span> <span class="c"># Latin small letter a with ring above</span>
        <span class="mi">230</span><span class="p">:</span> <span class="s">u&#39;æ&#39;</span><span class="p">,</span> <span class="c"># Latin small letter ae</span>
        <span class="mi">231</span><span class="p">:</span> <span class="s">u&#39;ç&#39;</span><span class="p">,</span> <span class="c"># Latin small letter c with cedilla</span>
        <span class="mi">232</span><span class="p">:</span> <span class="s">u&#39;è&#39;</span><span class="p">,</span> <span class="c"># Latin small letter e with grave</span>
        <span class="mi">233</span><span class="p">:</span> <span class="s">u&#39;é&#39;</span><span class="p">,</span> <span class="c"># Latin small letter e with acute</span>
        <span class="mi">234</span><span class="p">:</span> <span class="s">u&#39;ê&#39;</span><span class="p">,</span> <span class="c"># Latin small letter e with circumflex</span>
        <span class="mi">235</span><span class="p">:</span> <span class="s">u&#39;ë&#39;</span><span class="p">,</span> <span class="c"># Latin small letter e with diaeresis</span>
        <span class="mi">236</span><span class="p">:</span> <span class="s">u&#39;ì&#39;</span><span class="p">,</span> <span class="c"># Latin small letter i with grave</span>
        <span class="mi">237</span><span class="p">:</span> <span class="s">u&#39;í&#39;</span><span class="p">,</span> <span class="c"># Latin small letter i with acute</span>
        <span class="mi">238</span><span class="p">:</span> <span class="s">u&#39;î&#39;</span><span class="p">,</span> <span class="c"># Latin small letter i with circumflex</span>
        <span class="mi">239</span><span class="p">:</span> <span class="s">u&#39;ï&#39;</span><span class="p">,</span> <span class="c"># Latin small letter i with diaeresis</span>
        <span class="mi">240</span><span class="p">:</span> <span class="s">u&#39;ð&#39;</span><span class="p">,</span> <span class="c"># Latin small letter eth</span>
        <span class="mi">241</span><span class="p">:</span> <span class="s">u&#39;ñ&#39;</span><span class="p">,</span> <span class="c"># Latin small letter n with tilde</span>
        <span class="mi">242</span><span class="p">:</span> <span class="s">u&#39;ò&#39;</span><span class="p">,</span> <span class="c"># Latin small letter o with grave</span>
        <span class="mi">243</span><span class="p">:</span> <span class="s">u&#39;ó&#39;</span><span class="p">,</span> <span class="c"># Latin small letter o with acute</span>
        <span class="mi">244</span><span class="p">:</span> <span class="s">u&#39;ô&#39;</span><span class="p">,</span> <span class="c"># Latin small letter o with circumflex</span>
        <span class="mi">245</span><span class="p">:</span> <span class="s">u&#39;õ&#39;</span><span class="p">,</span> <span class="c"># Latin small letter o with tilde</span>
        <span class="mi">246</span><span class="p">:</span> <span class="s">u&#39;ö&#39;</span><span class="p">,</span> <span class="c"># Latin small letter o with diaeresis</span>
        <span class="mi">247</span><span class="p">:</span> <span class="s">u&#39;÷&#39;</span><span class="p">,</span> <span class="c"># Division sign</span>
        <span class="mi">248</span><span class="p">:</span> <span class="s">u&#39;ø&#39;</span><span class="p">,</span> <span class="c"># Latin small letter o with slash</span>
        <span class="mi">249</span><span class="p">:</span> <span class="s">u&#39;ù&#39;</span><span class="p">,</span> <span class="c"># Latin small letter u with grave</span>
        <span class="mi">250</span><span class="p">:</span> <span class="s">u&#39;ú&#39;</span><span class="p">,</span> <span class="c"># Latin small letter u with acute</span>
        <span class="mi">251</span><span class="p">:</span> <span class="s">u&#39;û&#39;</span><span class="p">,</span> <span class="c"># Latin small letter u with circumflex</span>
        <span class="mi">252</span><span class="p">:</span> <span class="s">u&#39;ü&#39;</span><span class="p">,</span> <span class="c"># Latin small letter u with diaeresis</span>
        <span class="mi">253</span><span class="p">:</span> <span class="s">u&#39;ý&#39;</span><span class="p">,</span> <span class="c"># Latin small letter y with acute</span>
        <span class="mi">254</span><span class="p">:</span> <span class="s">u&#39;þ&#39;</span><span class="p">,</span> <span class="c"># Latin small letter thorn</span>
        <span class="mi">255</span><span class="p">:</span> <span class="s">u&#39;ÿ&#39;</span><span class="p">,</span> <span class="c"># Latin small letter y with diaeresis</span>
    <span class="p">}</span>
    <span class="c"># I left this in its odd state so I could differentiate between the two</span>
    <span class="c"># in the future.</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">object</span>
    <span class="k">if</span> <span class="nb">bytes</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span> <span class="c"># Python 2</span>
        <span class="c"># Convert e.object to a bytearray for an easy switch to integers.</span>
        <span class="c"># It is quicker than calling ord(char) on each char in e.object</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="c"># NOTE: In Python 3 when you iterate over bytes they appear as integers.</span>
        <span class="c">#       So we don&#39;t need to convert to a bytearray in Python 3.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="ne">UnicodeTranslateError</span><span class="p">)):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">specials</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">e</span><span class="o">.</span><span class="n">end</span><span class="p">]]</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">e</span><span class="o">.</span><span class="n">end</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">specials</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">e</span><span class="o">.</span><span class="n">end</span><span class="p">]]</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">e</span><span class="o">.</span><span class="n">end</span></div>
<span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&#39;handle_special&#39;</span><span class="p">,</span> <span class="n">handle_special</span><span class="p">)</span>

<span class="c"># TODO List:</span>
<span class="c">#</span>
<span class="c">#   * We need unit tests!</span>
<span class="c">#   * Add a function that can dump the screen with text renditions represented as their usual escape sequences so applications that try to perform screen-scraping can match things like &#39;\x1b[41mAuthentication configuration&#39; without having to find specific character positions and then examining the renditions on that line.</span>

<span class="c"># Helper functions</span>
<div class="viewcode-block" id="_reduce_renditions"><a class="viewcode-back" href="../Developer/terminal.html#terminal._reduce_renditions">[docs]</a><span class="k">def</span> <span class="nf">_reduce_renditions</span><span class="p">(</span><span class="n">renditions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a list, *renditions*, and reduces it to its logical equivalent (as</span>
<span class="sd">    far as renditions go).  Example::</span>

<span class="sd">        [0, 32, 0, 34, 0, 32]</span>

<span class="sd">    Would become::</span>

<span class="sd">        [0, 32]</span>

<span class="sd">    Other Examples::</span>

<span class="sd">        [0, 1, 36, 36]      -&gt;  [0, 1, 36]</span>
<span class="sd">        [0, 30, 42, 30, 42] -&gt;  [0, 30, 42]</span>
<span class="sd">        [36, 32, 44, 42]    -&gt;  [32, 42]</span>
<span class="sd">        [36, 35]            -&gt;  [35]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out_renditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">foreground</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">rend</span> <span class="ow">in</span> <span class="n">renditions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">29</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out_renditions</span><span class="p">:</span>
                <span class="n">out_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rend</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rend</span> <span class="o">&gt;</span> <span class="mi">29</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="c"># Regular 8-color foregrounds</span>
            <span class="n">foreground</span> <span class="o">=</span> <span class="n">rend</span>
        <span class="k">elif</span> <span class="n">rend</span> <span class="o">&gt;</span> <span class="mi">39</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="c"># Regular 8-color backgrounds</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">rend</span>
        <span class="k">elif</span> <span class="n">rend</span> <span class="o">&gt;</span> <span class="mi">91</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">98</span><span class="p">:</span>
            <span class="c"># &#39;Bright&#39; (16-color) foregrounds</span>
            <span class="n">foreground</span> <span class="o">=</span> <span class="n">rend</span>
        <span class="k">elif</span> <span class="n">rend</span> <span class="o">&gt;</span> <span class="mi">99</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">108</span><span class="p">:</span>
            <span class="c"># &#39;Bright&#39; (16-color) backgrounds</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">rend</span>
        <span class="k">elif</span> <span class="n">rend</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
            <span class="c"># 256-color foregrounds</span>
            <span class="n">foreground</span> <span class="o">=</span> <span class="n">rend</span>
        <span class="k">elif</span> <span class="n">rend</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">&lt;</span> <span class="mi">20000</span><span class="p">:</span>
            <span class="c"># 256-color backgrounds</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">rend</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rend</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">foreground</span><span class="p">:</span>
        <span class="n">out_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">foreground</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">background</span><span class="p">:</span>
        <span class="n">out_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">background</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_renditions</span>
</div>
<div class="viewcode-block" id="unicode_counter"><a class="viewcode-back" href="../Developer/terminal.html#terminal.unicode_counter">[docs]</a><span class="k">def</span> <span class="nf">unicode_counter</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generator that returns incrementing Unicode characters that can be used as</span>
<span class="sd">    references inside a Unicode array.  For example::</span>

<span class="sd">        &gt;&gt;&gt; counter = unicode_counter()</span>
<span class="sd">        &gt;&gt;&gt; mapping_dict = {}</span>
<span class="sd">        &gt;&gt;&gt; some_array = array(&#39;u&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Pretend &#39;marked ...&#39; below is a reference to something impotant :)</span>
<span class="sd">        &gt;&gt;&gt; for i, c in enumerate(u&#39;some string&#39;):</span>
<span class="sd">                if c == u&#39; &#39;: # Mark the location of spaces</span>
<span class="sd">                    # Perform some operation where we need to save a value</span>
<span class="sd">                    result = some_evaluation(i, c)</span>
<span class="sd">                    # Save some memory by storing a reference to result instead</span>
<span class="sd">                    # of the same result over and over again</span>
<span class="sd">                    if result not in mapping_dict.values():</span>
<span class="sd">                        marker = counter.next()</span>
<span class="sd">                        some_array.append(marker)</span>
<span class="sd">                        mapping_dict[marker] = result</span>
<span class="sd">                    else: # Find the existing reference so we can use it again</span>
<span class="sd">                        for k, v in mapping_dict.items():</span>
<span class="sd">                            if v == result: # Use the existing value</span>
<span class="sd">                                some_array.append(k)</span>
<span class="sd">                else:</span>
<span class="sd">                    some_array.append(\x00) # \x00 == &quot;not interesting&quot; placeholder</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">    Now we could iterate over &#39;some string&#39; and some_array simultaneously using</span>
<span class="sd">    zip(u&#39;some string&#39;, some_array) to access those reference markers when we</span>
<span class="sd">    encountered the correct position.  This can save a lot of memory if you need</span>
<span class="sd">    to store objects in memory that have a tendancy to repeat (e.g. text</span>
<span class="sd">    rendition lists in a terminal).</span>

<span class="sd">    .. note:: Meant to be used inside the renditions array to reference text rendition lists such as `[0, 1, 34]`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># Start at 1000 so we can use lower characters for other things</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="nb">unichr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">65535</span><span class="p">:</span> <span class="c"># The end of unicode in narrow builds of Python</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Reset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c"># NOTE:  Why use a unicode array() to store references instead of just a regular array()?  Two reasons:  1) Large namespace.  2) Only need to use one kind of array for everything (convenience).  It is also a large memory savings over &quot;just using a list with references to items in a dict.&quot;</span></div>
<div class="viewcode-block" id="pua_counter"><a class="viewcode-back" href="../Developer/terminal.html#terminal.pua_counter">[docs]</a><span class="k">def</span> <span class="nf">pua_counter</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generator that returns a Unicode Private Use Area (PUA) character starting</span>
<span class="sd">    at the beginning of Plane 16 (U+100000); counting up by one with each</span>
<span class="sd">    successive call.  If this is a narrow Python build the tail end of Plane 15</span>
<span class="sd">    will be used as a fallback (with a lot less characters).</span>

<span class="sd">    .. note:: Meant to be used as references to non-text objects in the screen array() (since it can only contain unicode characters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">SPECIAL</span> <span class="o">==</span> <span class="mi">1048576</span><span class="p">:</span> <span class="c"># Not a narrow build of Python</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">SPECIAL</span> <span class="c"># U+100000 or unichr(SPECIAL) (start of Plane 16)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">unichr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1114111</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">SPECIAL</span> <span class="c"># Reset--would be impressive to make it this far!</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># This Python build is &#39;narrow&#39; so we have to settle for less</span>
        <span class="c"># Hopefully no real-world terminal will actually want to use one of</span>
        <span class="c"># these characters.  In my research I couldn&#39;t find a font that used</span>
        <span class="c"># them.  Please correct me if I&#39;m wrong!</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">SPECIAL</span> <span class="c"># u&#39;\uf849&#39;</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">unichr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">63717</span><span class="p">:</span> <span class="c"># The end of nothing-but-block-chars in Plane 15</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">SPECIAL</span> <span class="c"># Reset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c"># Classes</span></div>
<div class="viewcode-block" id="FileType"><a class="viewcode-back" href="../Developer/terminal.html#terminal.FileType">[docs]</a><span class="k">class</span> <span class="nc">FileType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object to hold the attributes of a supported file capture/output type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># These attributes are here to prevent AttributeErrors if not overridden</span>
    <span class="n">thumbnail</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">html_template</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="c"># Must be overridden</span>
    <span class="n">html_icon_template</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="c"># Must be overridden</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">mimetype</span><span class="p">,</span> <span class="n">re_header</span><span class="p">,</span> <span class="n">re_capture</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">linkpath</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">icondir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **name:** Name of the file type.</span>
<span class="sd">        **mimetype:** Mime type of the file.</span>
<span class="sd">        **re_header:** The regex to match the start of the file.</span>
<span class="sd">        **re_capture:** The regex to carve the file out of the stream.</span>
<span class="sd">        **suffix:** (optional) The suffix to be appended to the end of the filename (if one is generated).</span>
<span class="sd">        **path:** (optional) The path to a file or directory where the file should be stored.  If *path* is a directory a random filename will be chosen.</span>
<span class="sd">        **linkpath:** (optional) The path to use when generating a link in HTML output.</span>
<span class="sd">        **icondir:** (optional) A path to look for a relevant icon to display when generating HTML output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">=</span> <span class="n">mimetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">re_header</span> <span class="o">=</span> <span class="n">re_header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">re_capture</span> <span class="o">=</span> <span class="n">re_capture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
        <span class="c"># A path just in case something needs to access it outside of Python:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkpath</span> <span class="o">=</span> <span class="n">linkpath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icondir</span> <span class="o">=</span> <span class="n">icondir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Override if the defined file type warrants a text-based output.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that self.file_obj gets closed/deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;FileType __del__(): Closing/deleting temp file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># Ensures it gets deleted</span>

    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="FileType.html"><a class="viewcode-back" href="../Developer/terminal.html#terminal.FileType.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the object as an HTML-formatted string.  Must be overridden.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="FileType.capture"><a class="viewcode-back" href="../Developer/terminal.html#terminal.FileType.capture">[docs]</a>    <span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">term_instance</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores *data* as a temporary file and returns that file&#39;s object.</span>
<span class="sd">        *term_instance* can be used by overrides of this function to make</span>
<span class="sd">        adjustments to the terminal emulator after the *data* is captured e.g.</span>
<span class="sd">        to make room for an image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Remove the extra \r&#39;s that the terminal adds:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;capture() len(data): </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="c"># Write the data to disk in a temporary location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c"># Leave it open</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span>
</div>
<div class="viewcode-block" id="FileType.close"><a class="viewcode-back" href="../Developer/terminal.html#terminal.FileType.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes :attr:`self.file_obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div></div>
<div class="viewcode-block" id="ImageFile"><a class="viewcode-back" href="../Developer/terminal.html#terminal.ImageFile">[docs]</a><span class="k">class</span> <span class="nc">ImageFile</span><span class="p">(</span><span class="n">FileType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of :class:`FileType` for images (specifically to override</span>
<span class="sd">    :meth:`self.html` and :meth:`self.capture`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ImageFile.capture"><a class="viewcode-back" href="../Developer/terminal.html#terminal.ImageFile.capture">[docs]</a>    <span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">term_instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Captures the image contained within *data*.  Will use *term_instance*</span>
<span class="sd">        to make room for the image in the terminal screen.</span>

<span class="sd">        .. note::  Unlike :class:`FileType`, *term_instance* is mandatory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;ImageFile.capture()&#39;</span><span class="p">)</span>
        <span class="c"># Image file formats don&#39;t usually like carriage returns:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Image</span><span class="p">:</span> <span class="c"># PIL is loaded--try to guess how many lines the image takes</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="c"># i.e. PIL couldn&#39;t identify the file</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;PIL couldn&#39;t process the image&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="c"># Don&#39;t do anything--bad image</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># No PIL means no images.  Don&#39;t bother wasting memory.</span>
            <span class="k">return</span>
        <span class="c"># Resize the image to be small enough to fit within a typical terminal</span>
        <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">640</span> <span class="ow">or</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">480</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span> <span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
        <span class="c"># Get the current image location and reference so we can move it around</span>
        <span class="n">img_Y</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span>
        <span class="n">img_X</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorX</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">img_Y</span><span class="p">][</span><span class="n">img_X</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">em_dimensions</span><span class="p">:</span>
            <span class="c"># Make sure the image will fit properly in the screen</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">em_dimensions</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]:</span>
                <span class="c"># Fits within a line.  No need for a newline</span>
                <span class="n">num_chars</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="n">term_instance</span><span class="o">.</span><span class="n">em_dimensions</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
                <span class="c"># Move the cursor an equivalent number of characters</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">cursor_right</span><span class="p">(</span><span class="n">num_chars</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># This is how many newlines the image represents:</span>
                <span class="n">newlines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="n">term_instance</span><span class="o">.</span><span class="n">em_dimensions</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">])</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">img_Y</span><span class="p">][</span><span class="n">img_X</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39; &#39;</span> <span class="c"># Empty old location</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span> <span class="c"># Start with a newline</span>
                <span class="k">if</span> <span class="n">newlines</span> <span class="o">&gt;</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">newlines</span><span class="p">):</span>
                        <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
                <span class="c"># Save the new image location</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span>
                    <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="n">term_instance</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># No way to calculate the number of lines the image will take</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">img_Y</span><span class="p">][</span><span class="n">img_X</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39; &#39;</span> <span class="c"># Empty old location</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="c"># Move to the end</span>
            <span class="c"># ... so it doesn&#39;t get cut off at the top</span>
            <span class="c"># Save the new image location</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="n">term_instance</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
            <span class="c"># Make some space at the bottom too just in case</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
        <span class="c"># Write the captured image to disk</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                    <span class="c"># Assume that a path was given for a reason and use a</span>
                    <span class="c"># NamedTemporaryFile instead of TemporaryFile.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
                        <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                    <span class="c"># Update self.path to use the new, actual file path</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;rb+&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c"># PIL was compiled without (complete) support for this format</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
                <span class="s">&quot;PIL is missing support for this image type (</span><span class="si">%s</span><span class="s">).  You probably&quot;</span>
                <span class="s">&quot; need to install zlib-devel and libjpeg-devel then re-install &quot;</span>
                <span class="s">&quot;it with &#39;pip install --upgrade PIL&#39; or &#39;pip install &quot;</span>
                <span class="s">&quot;--upgrade Pillow&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># Can&#39;t do anything with it</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># Go back to the start</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span>
</div>
<div class="viewcode-block" id="ImageFile.html"><a class="viewcode-back" href="../Developer/terminal.html#terminal.ImageFile.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns :attr:`self.file_obj` as an &lt;img&gt; tag with the src set to a</span>
<span class="sd">        data::URI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">u&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c"># i.e. PIL couldn&#39;t identify the file</span>
            <span class="k">return</span> <span class="s">u&quot;&lt;i&gt;Error displaying image&lt;/i&gt;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># Need to encode base64 to create a data URI</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">data_uri</span> <span class="o">=</span> <span class="s">&quot;data:image/</span><span class="si">%s</span><span class="s">;base64,</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">im</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">encoded</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_icon_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">src</span><span class="o">=</span><span class="n">data_uri</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">src</span><span class="o">=</span><span class="n">data_uri</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div></div>
<div class="viewcode-block" id="PNGFile"><a class="viewcode-back" href="../Developer/terminal.html#terminal.PNGFile">[docs]</a><span class="k">class</span> <span class="nc">PNGFile</span><span class="p">(</span><span class="n">ImageFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An override of :class:`ImageFile` for PNGs to hard-code the name, regular</span>
<span class="sd">    expressions, mimetype, and suffix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;PNG Image&quot;</span><span class="p">)</span>
    <span class="n">mimetype</span> <span class="o">=</span> <span class="s">&quot;image/png&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&quot;.png&quot;</span>
    <span class="n">re_header</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;.*</span><span class="se">\x89</span><span class="s">PNG</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">re_capture</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x89</span><span class="s">PNG</span><span class="se">\r</span><span class="s">.+IEND</span><span class="se">\xae</span><span class="s">B`</span><span class="se">\x82</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">html_template</span> <span class="o">=</span> <span class="s">&#39;&lt;img src=&quot;{src}&quot; width=&quot;{width}&quot; height=&quot;{height}&quot;&gt;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **path:** (optional) The path to a file or directory where the file should be stored.  If *path* is a directory a random filename will be chosen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># Images will be displayed inline so no icons unless overridden:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_icon_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_template</span>
</div>
<div class="viewcode-block" id="JPEGFile"><a class="viewcode-back" href="../Developer/terminal.html#terminal.JPEGFile">[docs]</a><span class="k">class</span> <span class="nc">JPEGFile</span><span class="p">(</span><span class="n">ImageFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An override of :class:`ImageFile` for JPEGs to hard-code the name, regular</span>
<span class="sd">    expressions, mimetype, and suffix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;JPEG Image&quot;</span><span class="p">)</span>
    <span class="n">mimetype</span> <span class="o">=</span> <span class="s">&quot;image/jpeg&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&quot;.jpeg&quot;</span>
    <span class="n">re_header</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s">&#39;.*</span><span class="se">\xff\xd8\xff</span><span class="s">.+JFIF</span><span class="se">\x00</span><span class="s">|.*</span><span class="se">\xff\xd8\xff</span><span class="s">.+Exif</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">re_capture</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s">&#39;</span><span class="se">\xff\xd8\xff</span><span class="s">.+</span><span class="se">\xff\xd9</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>
    <span class="p">)</span>
    <span class="n">html_template</span> <span class="o">=</span> <span class="s">&#39;&lt;img src=&quot;{src}&quot; width=&quot;{width}&quot; height=&quot;{height}&quot;&gt;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **path:** (optional) The path to a file or directory where the file should be stored.  If *path* is a directory a random filename will be chosen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># Images will be displayed inline so no icons unless overridden:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_icon_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_template</span>
</div>
<div class="viewcode-block" id="PDFFile"><a class="viewcode-back" href="../Developer/terminal.html#terminal.PDFFile">[docs]</a><span class="k">class</span> <span class="nc">PDFFile</span><span class="p">(</span><span class="n">FileType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of :class:`FileType` for PDFs (specifically to override</span>
<span class="sd">    :meth:`self.html`).  Has hard-coded name, mimetype, suffix, and regular</span>
<span class="sd">    expressions.  This class will also utilize :attr:`self.icondir` to look for</span>
<span class="sd">    an icon named, &#39;pdf.svg&#39;.  If found it will be utilized by</span>
<span class="sd">    :meth:`self.html` when generating output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;PDF Document&quot;</span><span class="p">)</span>
    <span class="n">mimetype</span> <span class="o">=</span> <span class="s">&quot;application/pdf&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&quot;.pdf&quot;</span>
    <span class="n">re_header</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;.*%PDF-[0-9]\.[0-9]{1,2}.+?obj&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">re_capture</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;%PDF-[0-9]\.[0-9]{1,2}.+</span><span class="si">%%</span><span class="s">EOF&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="s">&quot;pdf.svg&quot;</span> <span class="c"># Name of the file inside of self.icondir</span>
    <span class="c"># NOTE:  Using two separate links below so the whitespace doesn&#39;t end up</span>
    <span class="c"># underlined.  Looks much nicer this way.</span>
    <span class="n">html_icon_template</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;&lt;span class=&quot;pdfcontainer&quot;&gt;&lt;a class=&quot;pdflink&quot; target=&quot;_blank&quot; &#39;</span>
        <span class="s">&#39;href=&quot;{link}&quot;&gt;{icon}&lt;/a&gt;&lt;br&gt;&#39;</span>
        <span class="s">&#39;   &lt;a class=&quot;pdflink&quot; href=&quot;{link}&quot;&gt;{name}&lt;/a&gt;&lt;/span&gt;&#39;</span><span class="p">)</span>
    <span class="n">html_template</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;&lt;span class=&quot;pdfcontainer&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;{link}&quot;&gt;{name}&lt;/a&gt;&#39;</span>
        <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">linkpath</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">icondir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **path:** (optional) The path to the file.</span>
<span class="sd">        **linkpath:** (optional) The path to use when generating a link in HTML output.</span>
<span class="sd">        **icondir:** (optional) A path to look for a relevant icon to display when generating HTML output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkpath</span> <span class="o">=</span> <span class="n">linkpath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icondir</span> <span class="o">=</span> <span class="n">icondir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="PDFFile.generate_thumbnail"><a class="viewcode-back" href="../Developer/terminal.html#terminal.PDFFile.generate_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">generate_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If available, will use ghostscript (gs) to generate a thumbnail of this</span>
<span class="sd">        PDF in the form of an &lt;img&gt; tag with the src set to a data::URI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">commands</span> <span class="kn">import</span> <span class="n">getstatusoutput</span>
        <span class="n">thumb</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;gs&#39;</span><span class="p">,</span> <span class="c"># gs must be in your path</span>
            <span class="s">&#39;-dPDFFitPage&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dPARANOIDSAFER&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dBATCH&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dNOPAUSE&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dNOPROMPT&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dMaxBitmap=500000000&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dAlignToPixels=0&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dGridFitTT=0&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dDEVICEWIDTH=90&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dDEVICEHEIGHT=120&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dORIENT1=true&#39;</span><span class="p">,</span>
            <span class="s">&#39;-sDEVICE=jpeg&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dTextAlphaBits=4&#39;</span><span class="p">,</span>
            <span class="s">&#39;-dGraphicsAlphaBits=4&#39;</span><span class="p">,</span>
            <span class="s">&#39;-sOutputFile=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">thumb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="p">]</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">getstatusoutput</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">retcode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Success</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">thumb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">thumb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># Make sure it gets removed now we&#39;ve read it</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data_uri</span> <span class="o">=</span> <span class="s">&quot;data:image/jpeg;base64,</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoded</span>
                <span class="k">return</span> <span class="s">&#39;&lt;img src=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">data_uri</span>
</div>
<div class="viewcode-block" id="PDFFile.capture"><a class="viewcode-back" href="../Developer/terminal.html#terminal.PDFFile.capture">[docs]</a>    <span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">term_instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores *data* as a temporary file and returns that file&#39;s object.</span>
<span class="sd">        *term_instance* can be used by overrides of this function to make</span>
<span class="sd">        adjustments to the terminal emulator after the *data* is captured e.g.</span>
<span class="sd">        to make room for an image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;PDFFile.capture()&quot;</span><span class="p">)</span>
        <span class="c"># Remove the extra \r&#39;s that the terminal adds:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Write the data to disk in a temporary location</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                    <span class="c"># Assume that a path was given for a reason and use a</span>
                    <span class="c"># NamedTemporaryFile instead of TemporaryFile.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
                        <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                    <span class="c"># Update self.path to use the new, actual file path</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;rb+&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Use the terminal emulator&#39;s temppath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">term_instance</span><span class="o">.</span><span class="n">temppath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c"># Ghostscript-based thumbnail generation disabled due to its slow,</span>
        <span class="c"># blocking nature.  Works great though!</span>
        <span class="c">#self.thumbnail = self.generate_thumbnail()</span>
        <span class="c"># TODO: Figure out a way to do non-blocking thumbnail generation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">icondir</span><span class="p">:</span>
            <span class="n">pdf_icon</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">icondir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pdf_icon</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pdf_icon</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">:</span>
            <span class="c"># Make room for our link</span>
            <span class="n">img_Y</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span>
            <span class="n">img_X</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorX</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">img_Y</span><span class="p">][</span><span class="n">img_X</span><span class="p">]</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">img_Y</span><span class="p">][</span><span class="n">img_X</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39; &#39;</span> <span class="c"># No longer at this loc</span>
            <span class="k">if</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span> <span class="c"># Icons are about ~8 newlines high</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span><span class="p">):</span>
                    <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
            <span class="c"># Save the new location</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="n">term_instance</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
            <span class="n">term_instance</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Make room for the characters in the name, &quot;PDF Document&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
                <span class="n">term_instance</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">term_instance</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c"># Leave it open</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span>
</div>
<div class="viewcode-block" id="PDFFile.html"><a class="viewcode-back" href="../Developer/terminal.html#terminal.PDFFile.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a link to download the PDF using :attr:`self.linkpath` for the</span>
<span class="sd">        href attribute.  Will use :attr:`self.html_icon_template` if</span>
<span class="sd">        :attr:`self.icon` can be found.  Otherwise it will just output</span>
<span class="sd">        :attr:`self.name` as a clickable link.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linkpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_icon_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">link</span><span class="o">=</span><span class="n">link</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">link</span><span class="o">=</span><span class="n">link</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="NotFoundError"><a class="viewcode-back" href="../Developer/terminal.html#terminal.NotFoundError">[docs]</a><span class="k">class</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised by :meth:`Terminal.remove_magic` if a given filetype was not found in</span>
<span class="sd">    :attr:`Terminal.supported_magic`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal">[docs]</a><span class="k">class</span> <span class="nc">Terminal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Terminal controller class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ASCII_NUL</span> <span class="o">=</span> <span class="mi">0</span>     <span class="c"># Null</span>
    <span class="n">ASCII_BEL</span> <span class="o">=</span> <span class="mi">7</span>     <span class="c"># Bell (BEL)</span>
    <span class="n">ASCII_BS</span> <span class="o">=</span> <span class="mi">8</span>      <span class="c"># Backspace</span>
    <span class="n">ASCII_HT</span> <span class="o">=</span> <span class="mi">9</span>      <span class="c"># Horizontal Tab</span>
    <span class="n">ASCII_LF</span> <span class="o">=</span> <span class="mi">10</span>     <span class="c"># Line Feed</span>
    <span class="n">ASCII_VT</span> <span class="o">=</span> <span class="mi">11</span>     <span class="c"># Vertical Tab</span>
    <span class="n">ASCII_FF</span> <span class="o">=</span> <span class="mi">12</span>     <span class="c"># Form Feed</span>
    <span class="n">ASCII_CR</span> <span class="o">=</span> <span class="mi">13</span>     <span class="c"># Carriage Return</span>
    <span class="n">ASCII_SO</span> <span class="o">=</span> <span class="mi">14</span>     <span class="c"># Ctrl-N; Shift out (switches to the G0 charset)</span>
    <span class="n">ASCII_SI</span> <span class="o">=</span> <span class="mi">15</span>     <span class="c"># Ctrl-O; Shift in (switches to the G1 charset)</span>
    <span class="n">ASCII_XON</span> <span class="o">=</span> <span class="mi">17</span>    <span class="c"># Resume Transmission</span>
    <span class="n">ASCII_XOFF</span> <span class="o">=</span> <span class="mi">19</span>   <span class="c"># Stop Transmission or Ignore Characters</span>
    <span class="n">ASCII_CAN</span> <span class="o">=</span> <span class="mi">24</span>    <span class="c"># Cancel Escape Sequence</span>
    <span class="n">ASCII_SUB</span> <span class="o">=</span> <span class="mi">26</span>    <span class="c"># Substitute: Cancel Escape Sequence and replace with ?</span>
    <span class="n">ASCII_ESC</span> <span class="o">=</span> <span class="mi">27</span>    <span class="c"># Escape</span>
    <span class="n">ASCII_CSI</span> <span class="o">=</span> <span class="mi">155</span>   <span class="c"># Control Sequence Introducer (that nothing uses)</span>
    <span class="n">ASCII_HTS</span> <span class="o">=</span> <span class="mi">210</span>   <span class="c"># Horizontal Tab Stop (HTS)</span>

    <span class="n">charsets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;B&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="c"># Default is USA (aka &#39;B&#39;)</span>
        <span class="s">&#39;0&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="c"># Line drawing mode</span>
            <span class="mi">95</span><span class="p">:</span> <span class="s">u&#39; &#39;</span><span class="p">,</span>
            <span class="mi">96</span><span class="p">:</span> <span class="s">u&#39;◆&#39;</span><span class="p">,</span>
            <span class="mi">97</span><span class="p">:</span> <span class="s">u&#39;▒&#39;</span><span class="p">,</span>
            <span class="mi">98</span><span class="p">:</span> <span class="s">u&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">99</span><span class="p">:</span> <span class="s">u&#39;</span><span class="se">\x0c</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">:</span> <span class="s">u&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">101</span><span class="p">:</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">102</span><span class="p">:</span> <span class="s">u&#39;°&#39;</span><span class="p">,</span>
            <span class="mi">103</span><span class="p">:</span> <span class="s">u&#39;±&#39;</span><span class="p">,</span>
            <span class="mi">104</span><span class="p">:</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">105</span><span class="p">:</span> <span class="s">u&#39;</span><span class="se">\x0b</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">106</span><span class="p">:</span> <span class="s">u&#39;┘&#39;</span><span class="p">,</span>
            <span class="mi">107</span><span class="p">:</span> <span class="s">u&#39;┐&#39;</span><span class="p">,</span>
            <span class="mi">108</span><span class="p">:</span> <span class="s">u&#39;┌&#39;</span><span class="p">,</span>
            <span class="mi">109</span><span class="p">:</span> <span class="s">u&#39;└&#39;</span><span class="p">,</span>
            <span class="mi">110</span><span class="p">:</span> <span class="s">u&#39;┼&#39;</span><span class="p">,</span>
            <span class="mi">111</span><span class="p">:</span> <span class="s">u&#39;⎺&#39;</span><span class="p">,</span> <span class="c"># All these bars and not a drink!</span>
            <span class="mi">112</span><span class="p">:</span> <span class="s">u&#39;⎻&#39;</span><span class="p">,</span>
            <span class="mi">113</span><span class="p">:</span> <span class="s">u&#39;─&#39;</span><span class="p">,</span>
            <span class="mi">114</span><span class="p">:</span> <span class="s">u&#39;⎼&#39;</span><span class="p">,</span>
            <span class="mi">115</span><span class="p">:</span> <span class="s">u&#39;⎽&#39;</span><span class="p">,</span>
            <span class="mi">116</span><span class="p">:</span> <span class="s">u&#39;├&#39;</span><span class="p">,</span>
            <span class="mi">117</span><span class="p">:</span> <span class="s">u&#39;┤&#39;</span><span class="p">,</span>
            <span class="mi">118</span><span class="p">:</span> <span class="s">u&#39;┴&#39;</span><span class="p">,</span>
            <span class="mi">119</span><span class="p">:</span> <span class="s">u&#39;┬&#39;</span><span class="p">,</span>
            <span class="mi">120</span><span class="p">:</span> <span class="s">u&#39;│&#39;</span><span class="p">,</span>
            <span class="mi">121</span><span class="p">:</span> <span class="s">u&#39;≤&#39;</span><span class="p">,</span>
            <span class="mi">122</span><span class="p">:</span> <span class="s">u&#39;≥&#39;</span><span class="p">,</span>
            <span class="mi">123</span><span class="p">:</span> <span class="s">u&#39;π&#39;</span><span class="p">,</span>
            <span class="mi">124</span><span class="p">:</span> <span class="s">u&#39;≠&#39;</span><span class="p">,</span>
            <span class="mi">125</span><span class="p">:</span> <span class="s">u&#39;£&#39;</span><span class="p">,</span>
            <span class="mi">126</span><span class="p">:</span> <span class="s">u&#39;·&#39;</span> <span class="c"># Centered dot--who comes up with this stuff?!?</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">RE_CSI_ESC_SEQ</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\x1B\[([?A-Za-z0-9&gt;;@:\!]*)([A-Za-z@_])&#39;</span><span class="p">)</span>
    <span class="n">RE_ESC_SEQ</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\x1b(.*\x1b</span><span class="se">\\</span><span class="s">|[ABCDEFGHIJKLMNOQRSTUVWXYZa-z0-9=&lt;&gt;]|[()# %*+].)&#39;</span><span class="p">)</span>
    <span class="n">RE_TITLE_SEQ</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\x1b\][0-2]\;(.*?)(\x07|\x1b</span><span class="se">\\</span><span class="s">)&#39;</span><span class="p">)</span>
    <span class="c"># The below regex is used to match our optional (non-standard) handler</span>
    <span class="n">RE_OPT_SEQ</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\x1b\]_\;(.+?)(\x07|\x1b</span><span class="se">\\</span><span class="s">)&#39;</span><span class="p">)</span>
    <span class="n">RE_NUMBERS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;\d*&#39;</span><span class="p">)</span> <span class="c"># Matches any number</span>
    <span class="n">RE_SIGINT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;.*\^C&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">em_dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">temppath</span><span class="o">=</span><span class="s">&#39;/tmp&#39;</span><span class="p">,</span>
        <span class="n">linkpath</span><span class="o">=</span><span class="s">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">icondir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the terminal by calling *self.initialize(rows, cols)*.  This</span>
<span class="sd">        is so we can have an equivalent function in situations where __init__()</span>
<span class="sd">        gets overridden.</span>

<span class="sd">        If *em_dimensions* are provided they will be used to determine how many</span>
<span class="sd">        lines images will take when they&#39;re drawn in the terminal.  This is to</span>
<span class="sd">        prevent images that are written to the top of the screen from having</span>
<span class="sd">        their tops cut off.  *em_dimensions* should be a dict in the form of::</span>

<span class="sd">            {&#39;height&#39;: &lt;px&gt;, &#39;width&#39;: &lt;px&gt;}</span>

<span class="sd">        The *temppath* will be used to store files that are captured/saved by</span>
<span class="sd">        the terminal emulator.  In conjunction with this is the *linkpath* which</span>
<span class="sd">        will be used when creating links to these temporary files.  For example,</span>
<span class="sd">        a web-based application may wish to have the terminal emulator store</span>
<span class="sd">        temporary files in /tmp but give clients a completely unrelated URL to</span>
<span class="sd">        retrieve these files (for security or convenience reasons).  Here&#39;s a</span>
<span class="sd">        real world example of how it works::</span>

<span class="sd">            &gt;&gt;&gt; term = Terminal(rows=10, cols=40, temppath=&#39;/var/tmp&#39;, linkpath=&#39;/terminal&#39;)</span>
<span class="sd">            &gt;&gt;&gt; term.write(&#39;About to write a PDF\\n&#39;)</span>
<span class="sd">            &gt;&gt;&gt; pdf = open(&#39;/path/to/somefile.pdf&#39;).read()</span>
<span class="sd">            &gt;&gt;&gt; term.write(pdf)</span>
<span class="sd">            &gt;&gt;&gt; term.dump_html()</span>
<span class="sd">            ([u&#39;About to write a PDF                    &#39;,</span>
<span class="sd">            # &lt;unnecessary lines of whitespace have been removed for this example&gt;</span>
<span class="sd">            u&#39;&lt;a target=&quot;_blank&quot; href=&quot;/terminal/tmpZoOKVM.pdf&quot;&gt;PDF Document&lt;/a&gt;&#39;])</span>

<span class="sd">        The PDF file in question will reside in `/var/tmp` but the link was</span>
<span class="sd">        created as `href=&quot;/terminal/tmpZoOKVM.pdf&quot;`.  As long as your web app</span>
<span class="sd">        knows to look in /var/tmp for incoming &#39;/terminal&#39; requests users should</span>
<span class="sd">        be able to retrieve their documents.</span>

<span class="sd">            http://yourapp.company.com/terminal/tmpZoOKVM.pdf</span>

<span class="sd">        The *icondir* parameter, if given, will be used to provide a relevant</span>
<span class="sd">        icon when outputing a link to a file.  When a supported</span>
<span class="sd">        :class:`FileType` is captured the instance will be given the *icondir*</span>
<span class="sd">        as a parameter in a manner similar to this::</span>

<span class="sd">            filetype_instance = filetype_class(icondir=self.icondir)</span>

<span class="sd">        That way when filetype_instance.html() is called it can display a nice</span>
<span class="sd">        icon to the user...  if that particular :class:`FileType` supports icons</span>
<span class="sd">        and the icon it is looking for happens to be available at *icondir*.</span>

<span class="sd">        If *debug* is True, the root logger will have its level set to DEBUG.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temppath</span> <span class="o">=</span> <span class="n">temppath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkpath</span> <span class="o">=</span> <span class="n">linkpath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icondir</span> <span class="o">=</span> <span class="n">icondir</span>
        <span class="c"># This controls how often we send a message to the client when capturing</span>
        <span class="c"># a special file type.  The default is to update the user of progress</span>
        <span class="c"># once every 1.5 seconds.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_interval</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notified</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Used to tell if we have notified the user before</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_capture</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">em_dimensions</span><span class="p">)</span>

<div class="viewcode-block" id="Terminal.initialize"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">em_dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the terminal (the actual equivalent to :meth:`__init__`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">em_dimensions</span> <span class="o">=</span> <span class="n">em_dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_renditions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Gate One&quot;</span>
        <span class="c"># This variable can be referenced by programs implementing Terminal() to</span>
        <span class="c"># determine if anything has changed since the last dump*()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_echo</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_mode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># For holding escape sequences as they&#39;re typed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_cursor</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_home</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c"># Should always be reset ([0])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_screen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_renditions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_G0_charset</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_G1_charset</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_g0_charset</span><span class="p">()</span>
        <span class="c"># Set the default window margins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout_capture</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specials</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_NUL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_BEL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bell</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_BS</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backspace</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_HT</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_tab</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_LF</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_VT</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_FF</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_CR</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriage_return</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_SO</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_g1_charset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_SI</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_g0_charset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_XON</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xon</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_CAN</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_esc_sequence</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_XOFF</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xoff</span><span class="p">,</span>
            <span class="c">#self.ASCII_ESC: self._sub_esc_sequence,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_ESC</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASCII_CSI</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csi</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c"># TODO: Make a different set of these for each respective emulation mode (VT-52, VT-100, VT-200, etc etc)</span>
            <span class="s">&#39;#&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_line_params</span><span class="p">,</span> <span class="c"># Varies</span>
            <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_terminator</span><span class="p">,</span> <span class="c"># ST</span>
            <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen</span><span class="p">,</span> <span class="c"># Reset terminal</span>
            <span class="s">&#39;D&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Move/scroll window up one line    IND</span>
            <span class="s">&#39;M&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_linefeed</span><span class="p">,</span> <span class="c"># Move/scroll window down one line RI</span>
            <span class="s">&#39;E&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_line</span><span class="p">,</span> <span class="c"># Move to next line NEL</span>
            <span class="s">&#39;F&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Enter Graphics Mode</span>
            <span class="s">&#39;G&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_line</span><span class="p">,</span> <span class="c"># Exit Graphics Mode</span>
            <span class="s">&#39;6&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dsr_get_cursor_position</span><span class="p">,</span> <span class="c"># Get cursor position   DSR</span>
            <span class="s">&#39;7&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_cursor_position</span><span class="p">,</span> <span class="c"># Save cursor position and attributes   DECSC</span>
            <span class="s">&#39;8&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_cursor_position</span><span class="p">,</span> <span class="c"># Restore cursor position and attributes   DECSC</span>
            <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_tabstop</span><span class="p">,</span> <span class="c"># Set a tab at the current column   HTS</span>
            <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_linefeed</span><span class="p">,</span>
            <span class="s">&#39;(&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_G0_charset</span><span class="p">,</span> <span class="c"># Designate G0 Character Set</span>
            <span class="s">&#39;)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_G1_charset</span><span class="p">,</span> <span class="c"># Designate G1 Character Set</span>
            <span class="s">&#39;N&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set single shift 2    SS2</span>
            <span class="s">&#39;O&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set single shift 3    SS3</span>
            <span class="s">&#39;5&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device_status_report</span><span class="p">,</span> <span class="c"># Request: Device status report DSR</span>
            <span class="s">&#39;0&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Response: terminal is OK  DSR</span>
            <span class="s">&#39;P&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dcs_handler</span><span class="p">,</span> <span class="c"># Device Control String  DCS</span>
            <span class="c"># NOTE: = and &gt; are ignored because the user can override/control</span>
            <span class="c"># them via the numlock key on their keyboard.  To do otherwise would</span>
            <span class="c"># just confuse people.</span>
            <span class="s">&#39;=&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Application Keypad  DECPAM</span>
            <span class="s">&#39;&gt;&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Exit alternate keypad mode</span>
            <span class="s">&#39;&lt;&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Exit VT-52 mode</span>
            <span class="s">&#39;Z&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csi_device_identification</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csi_handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;A&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_up</span><span class="p">,</span>
            <span class="s">&#39;B&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_down</span><span class="p">,</span>
            <span class="s">&#39;C&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_right</span><span class="p">,</span>
            <span class="s">&#39;D&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_left</span><span class="p">,</span>
            <span class="s">&#39;E&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_next_line</span><span class="p">,</span> <span class="c"># NOTE: Not the same as next_line()</span>
            <span class="s">&#39;F&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_previous_line</span><span class="p">,</span>
            <span class="s">&#39;G&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_horizontal_absolute</span><span class="p">,</span>
            <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_position</span><span class="p">,</span>
            <span class="s">&#39;L&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_line</span><span class="p">,</span>
            <span class="s">&#39;M&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_line</span><span class="p">,</span>
            <span class="c">#&#39;b&#39;: self.repeat_last_char, # TODO</span>
            <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csi_device_identification</span><span class="p">,</span> <span class="c"># Device status report (DSR)</span>
            <span class="s">&#39;g&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># TODO: Tab clear</span>
            <span class="s">&#39;h&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_expanded_mode</span><span class="p">,</span>
            <span class="s">&#39;i&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># ESC[5i is &quot;redirect to printer&quot;, ESC[4i ends it</span>
            <span class="s">&#39;l&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset_expanded_mode</span><span class="p">,</span>
            <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_position</span><span class="p">,</span>
            <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_position_vertical</span><span class="p">,</span> <span class="c"># Vertical Line Position Absolute (VPA)</span>
            <span class="c">#&#39;e&#39;: self.cursor_position_vertical_relative, # VPR TODO</span>
            <span class="s">&#39;J&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen_from_cursor</span><span class="p">,</span>
            <span class="s">&#39;K&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_from_cursor</span><span class="p">,</span>
            <span class="s">&#39;S&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_up</span><span class="p">,</span>
            <span class="s">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_down</span><span class="p">,</span>
            <span class="s">&#39;s&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_cursor_position</span><span class="p">,</span>
            <span class="s">&#39;u&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_cursor_position</span><span class="p">,</span>
            <span class="s">&#39;m&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_rendition</span><span class="p">,</span>
            <span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csi_device_status_report</span><span class="p">,</span> <span class="c"># &lt;ESC&gt;[6n is the only one I know of (request cursor position)</span>
            <span class="s">&#39;p&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">,</span> <span class="c"># TODO: &quot;!p&quot; is &quot;Soft terminal reset&quot;.  Also, &quot;Set conformance level&quot; (VT100, VT200, or VT300)</span>
            <span class="s">&#39;r&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_top_bottom</span><span class="p">,</span> <span class="c"># DECSTBM (used by many apps)</span>
            <span class="s">&#39;q&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_led_state</span><span class="p">,</span> <span class="c"># Seems a bit silly but you never know</span>
            <span class="s">&#39;P&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_characters</span><span class="p">,</span> <span class="c"># DCH Deletes the specified number of chars</span>
            <span class="s">&#39;X&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_erase_characters</span><span class="p">,</span> <span class="c"># ECH Same as DCH but also deletes renditions</span>
            <span class="s">&#39;Z&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_characters</span><span class="p">,</span> <span class="c"># Inserts the specified number of chars</span>
            <span class="s">&#39;@&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_characters</span><span class="p">,</span> <span class="c"># Inserts the specified number of chars</span>
            <span class="c">#&#39;`&#39;: self._char_position_row, # Position cursor (row only)</span>
            <span class="c">#&#39;t&#39;: self.window_manipulation, # TODO</span>
            <span class="c">#&#39;z&#39;: self.locator, # TODO: DECELR &quot;Enable locator reporting&quot;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expanded_modes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c"># Expanded modes take a True/False argument for set/reset</span>
            <span class="s">&#39;1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_application_mode</span><span class="p">,</span>
            <span class="s">&#39;2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># DECANM and set VT100 mode (also: lock keyboard)</span>
            <span class="s">&#39;3&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># 132 Column Mode (DECCOLM)</span>
            <span class="s">&#39;4&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Smooth (Slow) Scroll (DECSCLM)</span>
            <span class="s">&#39;5&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Reverse video (might support in future)</span>
            <span class="s">&#39;6&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Origin Mode (DECOM)</span>
            <span class="s">&#39;7&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_autowrap</span><span class="p">,</span> <span class="c"># Wraparound Mode (DECAWM)</span>
            <span class="s">&#39;8&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Auto-repeat Keys (DECARM)</span>
            <span class="s">&#39;9&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Send Mouse X &amp; Y on button press (maybe)</span>
            <span class="s">&#39;12&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_receive_mode</span><span class="p">,</span> <span class="c"># SRM</span>
            <span class="s">&#39;18&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Print form feed (DECPFF)</span>
            <span class="s">&#39;19&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set print extent to full screen (DECPEX)</span>
            <span class="s">&#39;25&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_hide_cursor</span><span class="p">,</span>
            <span class="s">&#39;38&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Enter Tektronix Mode (DECTEK)</span>
            <span class="s">&#39;41&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># more(1) fix (whatever that is)</span>
            <span class="s">&#39;42&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Enable Nation Replacement Character sets (DECNRCM)</span>
            <span class="s">&#39;44&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Turn On Margin Bell</span>
            <span class="s">&#39;45&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Reverse-wraparound Mode</span>
            <span class="s">&#39;46&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Start Logging (Hmmm)</span>
            <span class="s">&#39;47&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_alternate_screen_buffer</span><span class="p">,</span> <span class="c"># Use Alternate Screen Buffer</span>
            <span class="s">&#39;66&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Application keypad (DECNKM)</span>
            <span class="s">&#39;67&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Backarrow key sends delete (DECBKM)</span>
            <span class="s">&#39;1000&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Send Mouse X/Y on button press and release</span>
            <span class="s">&#39;1001&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Use Hilite Mouse Tracking</span>
            <span class="s">&#39;1002&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Use Cell Motion Mouse Tracking</span>
            <span class="s">&#39;1003&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Use All Motion Mouse Tracking</span>
            <span class="s">&#39;1010&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Scroll to bottom on tty output</span>
            <span class="s">&#39;1011&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Scroll to bottom on key press</span>
            <span class="s">&#39;1035&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Enable special modifiers for Alt and NumLock keys</span>
            <span class="s">&#39;1036&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Send ESC when Meta modifies a key</span>
            <span class="s">&#39;1037&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Send DEL from the editing-keypad Delete key</span>
            <span class="s">&#39;1047&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Use Alternate Screen Buffer</span>
            <span class="s">&#39;1048&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Save cursor as in DECSC</span>
            <span class="s">&#39;1049&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_alternate_screen_buffer_cursor</span><span class="p">,</span> <span class="c"># Save cursor as in DECSC and use Alternate Screen Buffer, clearing it first</span>
            <span class="s">&#39;1051&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set Sun function-key mode</span>
            <span class="s">&#39;1052&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set HP function-key mode</span>
            <span class="s">&#39;1060&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set legacy keyboard emulation (X11R6)</span>
            <span class="s">&#39;1061&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ignore</span><span class="p">,</span> <span class="c"># Set Sun/PC keyboard emulation of VT220 keyboard</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">CALLBACK_SCROLL_UP</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_CHANGED</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_CURSOR_POS</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_DSR</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_TITLE</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_BELL</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_OPT</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_MODE</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_RESET</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_LEDS</span><span class="p">:</span> <span class="p">{},</span>
            <span class="n">CALLBACK_MESSAGE</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="c"># supported_magic gets assigned via self.add_magic() below</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Dict for magic &quot;numbers&quot; so we can tell when a particular type of</span>
        <span class="c"># file begins and ends (so we can capture it in binary form and</span>
        <span class="c"># later dump it out via dump_html())</span>
        <span class="c"># The format is &#39;beginning&#39;: &#39;whole&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="c"># magic_map is like magic except it is in the format of:</span>
        <span class="c">#   &#39;beginning&#39;: &lt;filetype class&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Supported magic (defaults)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_magic</span><span class="p">(</span><span class="n">PDFFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_magic</span><span class="p">(</span><span class="n">PNGFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_magic</span><span class="p">(</span><span class="n">JPEGFile</span><span class="p">)</span>
        <span class="c"># NOTE:  The order matters!  Some file formats are containers that can</span>
        <span class="c"># hold other file formats.  For example, PDFs can contain JPEGs.  So if</span>
        <span class="c"># we match JPEGs before PDFs we might make a match when we really wanted</span>
        <span class="c"># to match the overall container (the PDF).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># These are for saving self.screen and self.renditions so we can support</span>
        <span class="c"># an &quot;alternate buffer&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_renditions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autowrap</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_rendition</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application_keys</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_counter</span> <span class="o">=</span> <span class="n">pua_counter</span><span class="p">()</span>
        <span class="c"># This is for creating a new point of reference every time there&#39;s a new</span>
        <span class="c"># unique rendition at a given coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rend_counter</span> <span class="o">=</span> <span class="n">unicode_counter</span><span class="p">()</span>
        <span class="c"># Used for mapping unicode chars to acutal renditions (to save memory):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">u&#39; &#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="c"># Nada, nothing, no rendition.  Not the same as below</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rend_counter</span><span class="o">.</span><span class="n">next</span><span class="p">():</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Default is actually reset</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># A cache to speed things up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Ditto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Ditto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watcher</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Placeholder for the file watcher thread (if used)</span>
</div>
<div class="viewcode-block" id="Terminal.add_magic"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.add_magic">[docs]</a>    <span class="k">def</span> <span class="nf">add_magic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the given *filetype* to :attr:`self.supported_magic` and generates</span>
<span class="sd">        the necessary bits in :attr:`self.magic` and :attr:`self.magic_map`.</span>

<span class="sd">        *filetype* is expected to be a subclass of :class:`FileType`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">:</span>
            <span class="k">return</span> <span class="c"># Nothing to do; it&#39;s already there</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span>
        <span class="c"># Wand ready...</span>
        <span class="k">for</span> <span class="n">Type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magic</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">Type</span><span class="o">.</span><span class="n">re_header</span><span class="p">:</span> <span class="n">Type</span><span class="o">.</span><span class="n">re_capture</span><span class="p">})</span>
        <span class="c"># magic_map is just a convenient way of performing magic, er, I</span>
        <span class="c"># mean referencing filetypes that match the supported magic numbers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">Type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">Type</span><span class="o">.</span><span class="n">re_header</span><span class="p">:</span> <span class="n">Type</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="Terminal.remove_magic"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.remove_magic">[docs]</a>    <span class="k">def</span> <span class="nf">remove_magic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the given *filetype* from :attr:`self.supported_magic`,</span>
<span class="sd">        :attr:`self.magic`, and :attr:`self.magic_map`.</span>

<span class="sd">        *filetype* may be the specific filetype class or a string that can be</span>
<span class="sd">        either a filetype.name or filetype.mimetype.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filetype</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">Type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">filetype</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">Type</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">Type</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">==</span> <span class="n">filetype</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">Type</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">Type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="n">filetype</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">Type</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> not found in supported magic&quot;</span> <span class="o">%</span> <span class="n">filetype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">Type</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic</span><span class="p">[</span><span class="n">Type</span><span class="o">.</span><span class="n">re_header</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span><span class="p">[</span><span class="n">Type</span><span class="o">.</span><span class="n">re_header</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Terminal.update_magic"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.update_magic">[docs]</a>    <span class="k">def</span> <span class="nf">update_magic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetype</span><span class="p">,</span> <span class="n">mimetype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces an existing FileType with the given *mimetype* in</span>
<span class="sd">        :attr:`self.supported_magic` with the given *filetype*.  Example::</span>

<span class="sd">            &gt;&gt;&gt; import terminal</span>
<span class="sd">            &gt;&gt;&gt; term = terminal.Terminal()</span>
<span class="sd">            &gt;&gt;&gt; class NewPDF = class(terminal.PDFile)</span>
<span class="sd">            &gt;&gt;&gt; # Open PDFs immediately in a new window</span>
<span class="sd">            &gt;&gt;&gt; NewPDF.html_template = &quot;&lt;script&gt;window.open({link})&lt;/script&gt;&quot;</span>
<span class="sd">            &gt;&gt;&gt; NewPDF.html_icon_template = NewPDF.html_template # Ignore icon</span>
<span class="sd">            &gt;&gt;&gt; term.update_magic(NewPDF, mimetype=&quot;application/pdf&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Find the matching magic filetype</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">Type</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">==</span> <span class="n">mimetype</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c"># Replace self.magic and self.magic_map</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic</span><span class="p">[</span><span class="n">Type</span><span class="o">.</span><span class="n">re_header</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span><span class="p">[</span><span class="n">Type</span><span class="o">.</span><span class="n">re_header</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">filetype</span><span class="o">.</span><span class="n">re_header</span><span class="p">:</span> <span class="n">filetype</span><span class="o">.</span><span class="n">re_capture</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">filetype</span><span class="o">.</span><span class="n">re_header</span><span class="p">:</span> <span class="n">filetype</span><span class="p">})</span>
        <span class="c"># Finally replace the existing filetype in supported_magic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_magic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">filetype</span>
</div>
<div class="viewcode-block" id="Terminal.init_screen"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.init_screen">[docs]</a>    <span class="k">def</span> <span class="nf">init_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills :attr:`screen` with empty lines of (unicode) spaces using</span>
<span class="sd">        :attr:`self.cols` and :attr:`self.rows` for the dimensions.</span>

<span class="sd">        .. note:: Just because each line starts out with a uniform length does not mean it will stay that way.  Processing of escape sequences is handled when an output function is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;init_screen()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)]</span>
        <span class="c"># Tabstops</span>
        <span class="n">tabs</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c"># Default is every 8 chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">tabs</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Fix the first tabstop (which will be -1)</span>
        <span class="c"># Base cursor position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rendition_set</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Force a full dump with an init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Force this to be reset as well</span>
</div>
<div class="viewcode-block" id="Terminal.init_renditions"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.init_renditions">[docs]</a>    <span class="k">def</span> <span class="nf">init_renditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rendition</span><span class="o">=</span><span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)):</span> <span class="c"># Match unicode_counter</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces :attr:`self.renditions` with arrays of *rendition* (characters)</span>
<span class="sd">        using :attr:`self.cols` and :attr:`self.rows` for the dimenions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;init_renditions(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">rendition</span><span class="p">))</span>
        <span class="c"># The actual renditions at various coordinates:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="n">rendition</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Terminal.init_scrollback"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.init_scrollback">[docs]</a>    <span class="k">def</span> <span class="nf">init_scrollback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Empties the scrollback buffers (:attr:`self.scrollback_buf` and</span>
<span class="sd">        :attr:`self.scrollback_renditions`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_renditions</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Terminal.add_callback"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.add_callback">[docs]</a>    <span class="k">def</span> <span class="nf">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attaches the given *callback* to the given *event*.  If given,</span>
<span class="sd">        *identifier* can be used to reference this callback leter (e.g. when you</span>
<span class="sd">        want to remove it).  Otherwise an identifier will be generated</span>
<span class="sd">        automatically.  If the given *identifier* is already attached to a</span>
<span class="sd">        callback at the given event that callback will be replaced with</span>
<span class="sd">        *callback*.</span>

<span class="sd">            :event: The numeric ID of the event you&#39;re attaching *callback* to. The :ref:`callback constants &lt;callback_constants&gt;` should be used as the numerical IDs.</span>
<span class="sd">            :callback: The function you&#39;re attaching to the *event*.</span>
<span class="sd">            :identifier: A string or number to be used as a reference point should you wish to remove or update this callback later.</span>

<span class="sd">        Returns the identifier of the callback.  to Example::</span>

<span class="sd">            &gt;&gt;&gt; term = Terminal()</span>
<span class="sd">            &gt;&gt;&gt; def somefunc(): pass</span>
<span class="sd">            &gt;&gt;&gt; id = &quot;myref&quot;</span>
<span class="sd">            &gt;&gt;&gt; ref = term.add_callback(term.CALLBACK_BELL, somefunc, id)</span>

<span class="sd">        .. note:: This allows the controlling program to have multiple callbacks for the same event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="n">callback</span><span class="o">.</span><span class="n">__hash__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="k">return</span> <span class="n">identifier</span>
</div>
<div class="viewcode-block" id="Terminal.remove_callback"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.remove_callback">[docs]</a>    <span class="k">def</span> <span class="nf">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the callback referenced by *identifier* that is attached to the</span>
<span class="sd">        given *event*.  Example::</span>

<span class="sd">            &gt;&gt;&gt; term.remove_callback(CALLBACK_BELL, &quot;myref&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="n">identifier</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Terminal.remove_all_callbacks"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.remove_all_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">remove_all_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all callbacks associated with *identifier*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">identifiers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="n">identifier</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c"># No match, no biggie</span>
</div>
<div class="viewcode-block" id="Terminal.send_message"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.send_message">[docs]</a>    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A convenience function for calling all CALLBACK_MESSAGE callbacks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;send_message(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_MESSAGE</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.send_update"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.send_update">[docs]</a>    <span class="k">def</span> <span class="nf">send_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A convenience function for calling all CALLBACK_CHANGED callbacks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;send_update()&#39;)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CHANGED</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.send_cursor_update"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.send_cursor_update">[docs]</a>    <span class="k">def</span> <span class="nf">send_cursor_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A convenience function for calling all CALLBACK_CURSOR_POS callbacks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;send_cursor_update()&#39;)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.reset"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the terminal back to an empty screen with all defaults.  Calls</span>
<span class="sd">        :meth:`Terminal.callbacks[CALLBACK_RESET]` when finished.</span>

<span class="sd">        .. note:: If terminal output has been suspended (e.g. via ctrl-s) this will not un-suspend it (you need to issue ctrl-q to the underlying program to do that).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;reset()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_echo</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Gate One&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_cursor</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_mode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rendition_set</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_G0_charset</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_G1_charset</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_g0_charset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_renditions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autowrap</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_rendition</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application_keys</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_screen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_renditions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_scrollback</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_RESET</span><span class="p">]()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
    <span class="k">def</span> <span class="nf">__ignore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does nothing (on purpose!).  Used as a placeholder for unimplemented</span>
<span class="sd">        functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Terminal.resize"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">em_dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resizes the terminal window, adding or removing *rows* or *cols* as</span>
<span class="sd">        needed.  If *em_dimensions* are provided they will be stored in</span>
<span class="sd">        *self.em_dimensions* (which is currently only used by image output).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;resize(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">em_dimensions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">em_dimensions</span> <span class="o">=</span> <span class="n">em_dimensions</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="ow">and</span> <span class="n">cols</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="k">return</span> <span class="c"># Nothing to do--don&#39;t mess with the margins or the cursor</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span> <span class="c"># Remove rows from the top</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="n">rows</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c"># Add it to the scrollback buffer so it isn&#39;t lost forever</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">rend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rend</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rows</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span> <span class="c"># Add rows at the bottom</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
                <span class="n">renditions</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">renditions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c"># Fix the cursor location:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cols</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span> <span class="c"># Add cols to the right</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39; &#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>

        <span class="c"># Fix the cursor location:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rendition_set</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Terminal._set_top_bottom"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._set_top_bottom">[docs]</a>    <span class="k">def</span> <span class="nf">_set_top_bottom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DECSTBM - Sets :attr:`self.top_margin` and :attr:`self.bottom_margin`</span>
<span class="sd">        using the provided settings in the form of &#39;&lt;top_margin&gt;;&lt;bottom_margin&gt;&#39;.</span>

<span class="sd">        .. note:: This also handles restore/set &quot;DEC Private Mode Values&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;_set_top_bottom(%s)&quot; % settings)</span>
        <span class="c"># NOTE: Used by screen and vi so this needs to work and work well!</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
                <span class="c"># This is a set/restore DEC PMV sequence</span>
                <span class="k">return</span> <span class="c"># Ignore (until I figure out what this should do)</span>
            <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># These are 0-based</span>
            <span class="k">if</span> <span class="n">bottom</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottom</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Reset to defaults (full screen margins)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Terminal.get_cursor_position"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.get_cursor_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current cursor positition as a tuple::</span>

<span class="sd">            (row, col)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.set_title"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.set_title">[docs]</a>    <span class="k">def</span> <span class="nf">set_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets :attr:`self.title` to *title* and executes</span>
<span class="sd">        :meth:`Terminal.callbacks[CALLBACK_TITLE]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_TITLE</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Got TypeError on CALLBACK_TITLE...&quot;</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_TITLE</span><span class="p">]))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.get_title"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.get_title">[docs]</a>    <span class="k">def</span> <span class="nf">get_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns :attr:`self.title`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

<span class="c"># TODO: put some logic in these save/restore functions to walk the current</span>
<span class="c"># rendition line to come up with a logical rendition for that exact spot.</span></div>
<div class="viewcode-block" id="Terminal.save_cursor_position"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.save_cursor_position">[docs]</a>    <span class="k">def</span> <span class="nf">save_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the cursor position and current rendition settings to</span>
<span class="sd">        :attr:`self.saved_cursorX`, :attr:`self.saved_cursorY`, and</span>
<span class="sd">        :attr:`self.saved_rendition`</span>

<span class="sd">        .. note:: Also handles the set/restore &quot;Private Mode Settings&quot; sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span><span class="p">:</span> <span class="c"># Set DEC private mode</span>
            <span class="c"># TODO: Need some logic here to save the current expanded mode</span>
            <span class="c">#       so we can restore it in _set_top_bottom().</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_expanded_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="c"># NOTE: args and kwargs are here to make sure we don&#39;t get an exception</span>
        <span class="c">#       when we&#39;re called via escape sequences.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_rendition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span>
</div>
<div class="viewcode-block" id="Terminal.restore_cursor_position"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.restore_cursor_position">[docs]</a>    <span class="k">def</span> <span class="nf">restore_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restores the cursor position and rendition settings from</span>
<span class="sd">        :attr:`self.saved_cursorX`, :attr:`self.saved_cursorY`, and</span>
<span class="sd">        :attr:`self.saved_rendition` (if they&#39;re set).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorX</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorX</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_cursorY</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_rendition</span>
</div>
<div class="viewcode-block" id="Terminal._dsr_get_cursor_position"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._dsr_get_cursor_position">[docs]</a>    <span class="k">def</span> <span class="nf">_dsr_get_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current cursor positition as a DSR response in the form of::</span>

<span class="sd">            &#39;\x1b&lt;self.cursorY&gt;;&lt;self.cursorX&gt;R&#39;</span>

<span class="sd">        Also executes CALLBACK_DSR with the same output as the first argument.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.callbacks[CALLBACK_DSR](&#39;\x1b20;123R&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">esc_cursor_pos</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1b</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">R&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_DSR</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">esc_cursor_pos</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">esc_cursor_pos</span>
</div>
<div class="viewcode-block" id="Terminal._dcs_handler"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._dcs_handler">[docs]</a>    <span class="k">def</span> <span class="nf">_dcs_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles Device Control String sequences.  Unimplemented.  Probablye not</span>
<span class="sd">        appropriate for Gate One.  If you believe this to be false please open</span>
<span class="sd">        a ticket in the issue tracker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
        <span class="c">#print(&quot;TODO: Handle this DCS: %s&quot; % string)</span>
</div>
<div class="viewcode-block" id="Terminal._set_line_params"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._set_line_params">[docs]</a>    <span class="k">def</span> <span class="nf">_set_line_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function handles the control sequences that set double and single</span>
<span class="sd">        line heights and widths.  It also handles the &quot;screen alignment test&quot; (</span>
<span class="sd">        fill the screen with Es).</span>

<span class="sd">        .. note:: Double-line height text is currently unimplemented (does anything actually use it?).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t handle escape sequence #</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="c"># Screen alignment test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_renditions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39;E&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)]</span>
        <span class="c"># TODO: Get this handling double line height stuff...  For kicks</span>
</div>
<div class="viewcode-block" id="Terminal.set_G0_charset"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.set_G0_charset">[docs]</a>    <span class="k">def</span> <span class="nf">set_G0_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the terminal&#39;s G0 (default) charset to the type specified by</span>
<span class="sd">        *char*.</span>

<span class="sd">        Here&#39;s the possibilities::</span>

<span class="sd">            0    DEC Special Character and Line Drawing Set</span>
<span class="sd">            A    United Kingdom (UK)</span>
<span class="sd">            B    United States (USASCII)</span>
<span class="sd">            4    Dutch</span>
<span class="sd">            C    Finnish</span>
<span class="sd">            5    Finnish</span>
<span class="sd">            R    French</span>
<span class="sd">            Q    French Canadian</span>
<span class="sd">            K    German</span>
<span class="sd">            Y    Italian</span>
<span class="sd">            E    Norwegian/Danish</span>
<span class="sd">            6    Norwegian/Danish</span>
<span class="sd">            Z    Spanish</span>
<span class="sd">            H    Swedish</span>
<span class="sd">            7    Swedish</span>
<span class="sd">            =    Swiss</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;Setting G0 charset to %s&quot; % repr(char))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G0_charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charsets</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G0_charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charsets</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G0_charset</span>
</div>
<div class="viewcode-block" id="Terminal.set_G1_charset"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.set_G1_charset">[docs]</a>    <span class="k">def</span> <span class="nf">set_G1_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the terminal&#39;s G1 (alt) charset to the type specified by *char*.</span>

<span class="sd">        Here&#39;s the possibilities::</span>

<span class="sd">            0    DEC Special Character and Line Drawing Set</span>
<span class="sd">            A    United Kingdom (UK)</span>
<span class="sd">            B    United States (USASCII)</span>
<span class="sd">            4    Dutch</span>
<span class="sd">            C    Finnish</span>
<span class="sd">            5    Finnish</span>
<span class="sd">            R    French</span>
<span class="sd">            Q    French Canadian</span>
<span class="sd">            K    German</span>
<span class="sd">            Y    Italian</span>
<span class="sd">            E    Norwegian/Danish</span>
<span class="sd">            6    Norwegian/Danish</span>
<span class="sd">            Z    Spanish</span>
<span class="sd">            H    Swedish</span>
<span class="sd">            7    Swedish</span>
<span class="sd">            =    Swiss</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;Setting G1 charset to %s&quot; % repr(char))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G1_charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charsets</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G1_charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charsets</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G1_charset</span>
</div>
<div class="viewcode-block" id="Terminal.use_g0_charset"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.use_g0_charset">[docs]</a>    <span class="k">def</span> <span class="nf">use_g0_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current charset to G0.  This should get called when ASCII_SO</span>
<span class="sd">        is encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(</span>
            <span class="c">#&quot;Switching to G0 charset (which is %s)&quot; % repr(self.G0_charset))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G0_charset</span>
</div>
<div class="viewcode-block" id="Terminal.use_g1_charset"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.use_g1_charset">[docs]</a>    <span class="k">def</span> <span class="nf">use_g1_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current charset to G1.  This should get called when ASCII_SI</span>
<span class="sd">        is encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(</span>
            <span class="c">#&quot;Switching to G1 charset (which is %s)&quot; % repr(self.G1_charset))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G1_charset</span>
</div>
<div class="viewcode-block" id="Terminal.abort_capture"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.abort_capture">[docs]</a>    <span class="k">def</span> <span class="nf">abort_capture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A convenience function that takes care of canceling a file capture and</span>
<span class="sd">        cleaning up the output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;abort_capture()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_capture</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span> <span class="c"># This won&#39;t actually get written</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;File capture aborted.&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Terminal.write"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="p">,</span> <span class="n">special_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write *chars* to the terminal at the current cursor position advancing</span>
<span class="sd">        the cursor as it does so.  If *chars* is not unicode, it will be</span>
<span class="sd">        converted to unicode before being stored in self.screen.</span>

<span class="sd">        if *special_checks* is True (default), Gate One will perform checks for</span>
<span class="sd">        special things like image files coming in via *chars*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># NOTE: This is the slowest function in all of Gate One.  All</span>
        <span class="c"># suggestions on how to speed it up are welcome!</span>

        <span class="c"># Speedups (don&#39;t want dots in loops if they can be avoided)</span>
        <span class="n">specials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specials</span>
        <span class="n">esc_handlers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">esc_handlers</span>
        <span class="n">csi_handlers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csi_handlers</span>
        <span class="n">RE_ESC_SEQ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RE_ESC_SEQ</span>
        <span class="n">RE_CSI_ESC_SEQ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RE_CSI_ESC_SEQ</span>
        <span class="n">magic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic</span>
        <span class="n">magic_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c">#logging.debug(&#39;handling chars: %s&#39; % repr(chars))</span>
        <span class="k">if</span> <span class="n">special_checks</span><span class="p">:</span>
            <span class="n">before_chars</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">after_chars</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">magic_header</span> <span class="ow">in</span> <span class="n">magic</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">magic_header</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">chars</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span> <span class="o">=</span> <span class="n">magic_header</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">capture_regex</span> <span class="o">=</span> <span class="n">magic</span><span class="p">[</span><span class="n">magic_header</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">timeout_capture</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">progress_timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                            <span class="k">break</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                        <span class="c"># Gibberish; drop it and pretend it never happened</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                        <span class="c"># Make it so it won&#39;t barf below</span>
                        <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">capture</span> <span class="o">+=</span> <span class="n">chars</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_capture</span><span class="p">:</span>
                    <span class="c"># Try to split the garbage from the post-ctrl-c output</span>
                    <span class="n">split_capture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RE_SIGINT</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">)</span>
                    <span class="n">after_chars</span> <span class="o">=</span> <span class="n">split_capture</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">capture</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cancel_capture</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&#39;^C</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">special_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">after_chars</span><span class="p">,</span> <span class="n">special_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_timer</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_interval</span><span class="p">:</span>
                    <span class="c"># Send an update of the progress to the user</span>
                    <span class="c"># NOTE: This message will only get sent if it takes longer</span>
                    <span class="c"># than self.message_interval to capture a file.  So it is</span>
                    <span class="c"># nice and user friendly:  Small things output instantly</span>
                    <span class="c"># without notifications while larger files that take longer</span>
                    <span class="c"># to capture will keep the user abreast of the progress.</span>
                    <span class="n">ft</span> <span class="o">=</span> <span class="n">magic_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">indicator</span> <span class="o">=</span> <span class="s">&#39;K&#39;</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">))</span><span class="o">/</span><span class="mi">1024</span> <span class="c"># Kb</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span> <span class="c"># Switch to Mb</span>
                        <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">/</span><span class="mi">1024</span>
                        <span class="n">indicator</span> <span class="o">=</span> <span class="s">&#39;M&#39;</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span>
                        <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%.2f%s</span><span class="s"> captured...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ft</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">indicator</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">notified</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress_timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s">&quot;Matched </span><span class="si">%s</span><span class="s"> format.  Capturing...&quot;</span> <span class="o">%</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">split_capture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_regex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">)</span>
                    <span class="n">before_chars</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split_capture</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">after_chars</span> <span class="o">=</span> <span class="n">split_capture</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">after_chars</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">after_chars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                        <span class="c"># Could be more to this file.  Let&#39;s wait until output</span>
                        <span class="c"># slows down before attempting to perform a match</span>
                        <span class="k">return</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># These needs to be written before the capture so that</span>
                        <span class="c"># the FileType.capture() method can position things</span>
                        <span class="c"># appropriately.</span>
                        <span class="k">if</span> <span class="n">before_chars</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">before_chars</span><span class="p">,</span> <span class="n">special_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                        <span class="c"># Perform the capture and start anew</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">capture</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_capture_file</span><span class="p">()</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notified</span><span class="p">:</span>
                            <span class="c"># Send a final notice of how big the file was (just</span>
                            <span class="c"># to keep things consistent).</span>
                            <span class="n">ft</span> <span class="o">=</span> <span class="n">magic_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                            <span class="n">indicator</span> <span class="o">=</span> <span class="s">&#39;K&#39;</span>
                            <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">))</span><span class="o">/</span><span class="mi">1024</span> <span class="c"># Kb</span>
                            <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span> <span class="c"># Switch to Mb</span>
                                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">/</span><span class="mi">1024</span>
                                <span class="n">indicator</span> <span class="o">=</span> <span class="s">&#39;M&#39;</span>
                            <span class="n">message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span>
                                <span class="s">&quot;</span><span class="si">%s</span><span class="s">: Capture complete (</span><span class="si">%.2f%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">ft</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">indicator</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">notified</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                        <span class="c">#self.cursorX += 1 # So it doesn&#39;t get overwritten</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">capture</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="c"># Empty it now that is is captured</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">matched_header</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Ditto</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">after_chars</span><span class="p">,</span> <span class="n">special_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">return</span>
        <span class="c"># Have to convert to unicode</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s">&quot;handle_special&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="c"># Just in case</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="n">_</span><span class="p">(</span><span class="s">&quot;Double UnicodeDecodeError in terminal.Terminal.&quot;</span><span class="p">))</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c"># In Python 3 strings don&#39;t have .decode()</span>
            <span class="k">pass</span> <span class="c"># Already Unicode</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="n">charnum</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">charnum</span> <span class="ow">in</span> <span class="n">specials</span><span class="p">:</span>
                <span class="n">specials</span><span class="p">[</span><span class="n">charnum</span><span class="p">]()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Now handle the regular characters and escape sequences</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="p">:</span> <span class="c"># We&#39;ve got an escape sequence going on...</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">+=</span> <span class="n">char</span>
                        <span class="c"># First try to handle non-CSI ESC sequences (the basics)</span>
                        <span class="n">match_obj</span> <span class="o">=</span> <span class="n">RE_ESC_SEQ</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">match_obj</span><span class="p">:</span>
                            <span class="n">seq_type</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># &#39;\x1bA&#39; -&gt; &#39;A&#39;</span>
                            <span class="c"># Call the matching ESC handler</span>
                            <span class="c">#logging.debug(&#39;ESC seq: %s&#39; % seq_type)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># Single-character sequnces</span>
                                <span class="n">esc_handlers</span><span class="p">[</span><span class="n">seq_type</span><span class="p">]()</span>
                            <span class="k">else</span><span class="p">:</span> <span class="c"># Multi-character stuff like &#39;\x1b)B&#39;</span>
                                <span class="n">esc_handlers</span><span class="p">[</span><span class="n">seq_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="n">seq_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># All done with this one</span>
                            <span class="k">continue</span>
                        <span class="c"># Next try to handle CSI ESC sequences</span>
                        <span class="n">match_obj</span> <span class="o">=</span> <span class="n">RE_CSI_ESC_SEQ</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">match_obj</span><span class="p">:</span>
                            <span class="n">csi_values</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># e.g. &#39;0;1;37&#39;</span>
                            <span class="n">csi_type</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># e.g. &#39;m&#39;</span>
                            <span class="c">#logging.debug(</span>
                                <span class="c">#&#39;CSI: %s, %s&#39; % (csi_type, csi_values))</span>
                            <span class="c"># Call the matching CSI handler</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">csi_handlers</span><span class="p">[</span><span class="n">csi_type</span><span class="p">](</span><span class="n">csi_values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="c"># Commented this out because it can be super noisy</span>
                                <span class="c">#logging.error(_(</span>
                                    <span class="c">#&quot;CSI Handler Error: Type: %s, Values: %s&quot; %</span>
                                    <span class="c">#(csi_type, csi_values)</span>
                                <span class="c">#))</span>
                                <span class="k">pass</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                            <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="c"># No handler for this, try some alternatives</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x1b\\</span><span class="s">&#39;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_osc_handler</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
                                <span class="s">&quot;Warning: No ESC sequence handler for </span><span class="si">%s</span><span class="s">&quot;</span>
                                <span class="o">%</span> <span class="sb">`self.esc_buffer`</span>
                            <span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">continue</span> <span class="c"># We&#39;re done here</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
                    <span class="c"># Non-autowrap has been disabled due to issues with browser</span>
                    <span class="c"># wrapping.</span>
                    <span class="c">#if self.autowrap:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
                    <span class="c">#else:</span>
                        <span class="c">#self.screen[self.cursorY].append(u&#39; &#39;) # Make room</span>
                        <span class="c">#self.renditions[self.cursorY].append(u&#39; &#39;)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_mode</span><span class="p">:</span>
                        <span class="c"># Insert mode dictates that we move everything to the</span>
                        <span class="c"># right for every character we insert.  Normally the</span>
                        <span class="c"># program itself will take care of this but older</span>
                        <span class="c"># programs and shells will simply set call ESC[4h,</span>
                        <span class="c"># insert the character, then call ESC[4i to return the</span>
                        <span class="c"># terminal to its regular state.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">insert_characters</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">charnum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">:</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">[</span><span class="n">charnum</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">char</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># Double check this isn&#39;t a unicode diacritic (accent)</span>
                        <span class="c"># which simply modifies the character before it</span>
                        <span class="k">if</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">combining</span><span class="p">(</span><span class="n">char</span><span class="p">):</span>
                            <span class="c"># This is a diacritic.  Combine it with existing:</span>
                            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span>
                            <span class="n">combined</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
                                <span class="s">&#39;NFC&#39;</span><span class="p">,</span> <span class="s">u&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">char</span><span class="p">))</span>
                            <span class="c"># Sometimes a joined combining char can still result</span>
                            <span class="c"># a string of length &gt; 1.  So we need to handle that</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combined</span><span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c"># Normal character</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">char</span>
                <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c"># This can happen when escape sequences go haywire</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
                        <span class="s">&quot;IndexError in write(): </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">))</span>
                    <span class="kn">import</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">sys</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c"># Execute our callbacks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_cursor_update</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Terminal.flush"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only here to make Terminal compatible with programs that want to use</span>
<span class="sd">        file-like methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.scroll_up"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.scroll_up">[docs]</a>    <span class="k">def</span> <span class="nf">scroll_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scrolls up the terminal screen by *n* lines (default: 1). The callbacks</span>
<span class="sd">        CALLBACK_CHANGED and CALLBACK_SCROLL_UP are called after scrolling the</span>
<span class="sd">        screen.</span>

<span class="sd">        .. note:: This will only scroll up the region within self.top_margin and self.bottom_margin (if set).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;scroll_up(%s)&quot; % n)</span>
        <span class="n">empty_line</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="c"># Line full of spaces</span>
        <span class="n">empty_rend</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span><span class="p">)</span> <span class="c"># Remove the top line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="c"># Add it to the scrollback buffer</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="c"># 1000 lines ought to be enough for anybody</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_scrollback</span><span class="p">()</span>
                <span class="c"># NOTE:  This would only be if 1000 lines piled up before the</span>
                <span class="c"># next dump_html() or dump().</span>
            <span class="c"># Add it to the bottom of the window:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">,</span> <span class="n">empty_line</span><span class="p">[:])</span> <span class="c"># A copy</span>
            <span class="c"># Remove top line&#39;s rendition information</span>
            <span class="n">rend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rend</span><span class="p">)</span>
            <span class="c"># Insert a new empty rendition as well:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">,</span> <span class="n">empty_rend</span><span class="p">[:])</span>
        <span class="c"># Execute our callback indicating lines have been updated</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CHANGED</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># Execute our callback to scroll up the screen</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_SCROLL_UP</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.scroll_down"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.scroll_down">[docs]</a>    <span class="k">def</span> <span class="nf">scroll_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scrolls down the terminal screen by *n* lines (default: 1). The</span>
<span class="sd">        callbacks CALLBACK_CHANGED and CALLBACK_SCROLL_DOWN are called after</span>
<span class="sd">        scrolling the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;scroll_down(%s)&quot; % n)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">)</span> <span class="c"># Remove the bottom line</span>
            <span class="n">empty_line</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="c"># Line full of spaces</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span><span class="p">,</span> <span class="n">empty_line</span><span class="p">)</span> <span class="c"># Add it to the top</span>
            <span class="c"># Remove bottom line&#39;s style information:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">)</span>
            <span class="c"># Insert a new empty one:</span>
            <span class="n">empty_line</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span><span class="p">,</span> <span class="n">empty_line</span><span class="p">)</span>
        <span class="c"># Execute our callback indicating lines have been updated</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CHANGED</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># Execute our callback to scroll up the screen</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_SCROLL_UP</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.insert_line"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.insert_line">[docs]</a>    <span class="k">def</span> <span class="nf">insert_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts *n* lines at the current cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;insert_line(%s)&quot; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span> <span class="c"># Takes care of an empty string</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">)</span> <span class="c"># Remove the bottom line</span>
            <span class="c"># Remove bottom line&#39;s style information as well:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">)</span>
            <span class="n">empty_line</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="c"># Line full of spaces</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">,</span> <span class="n">empty_line</span><span class="p">)</span> <span class="c"># Insert at cursor</span>
            <span class="c"># Insert a new empty rendition as well:</span>
            <span class="n">empty_rend</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">,</span> <span class="n">empty_rend</span><span class="p">)</span> <span class="c"># Insert at cursor</span>
</div>
<div class="viewcode-block" id="Terminal.delete_line"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.delete_line">[docs]</a>    <span class="k">def</span> <span class="nf">delete_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes *n* lines at the current cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;delete_line(%s)&quot; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span> <span class="c"># Takes care of an empty string</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">)</span> <span class="c"># Remove the line at the cursor</span>
            <span class="c"># Remove the line&#39;s style information as well:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">)</span>
            <span class="c"># Now add an empty line and empty set of renditions to the bottom of</span>
            <span class="c"># the view</span>
            <span class="n">empty_line</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="c"># Line full of spaces</span>
            <span class="c"># Add it to the bottom of the view:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">,</span> <span class="n">empty_line</span><span class="p">)</span> <span class="c"># Insert at bottom</span>
            <span class="c"># Insert a new empty rendition as well:</span>
            <span class="n">empty_rend</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">,</span> <span class="n">empty_rend</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.backspace"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.backspace">[docs]</a>    <span class="k">def</span> <span class="nf">backspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute a backspace (\\x08)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_left</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.horizontal_tab"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.horizontal_tab">[docs]</a>    <span class="k">def</span> <span class="nf">horizontal_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute horizontal tab (\\x09)&quot;&quot;&quot;</span>
        <span class="n">next_tabstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">tabstop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tabstop</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">:</span>
                <span class="n">next_tabstop</span> <span class="o">=</span> <span class="n">tabstop</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="n">next_tabstop</span>
</div>
<div class="viewcode-block" id="Terminal._set_tabstop"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._set_tabstop">[docs]</a>    <span class="k">def</span> <span class="nf">_set_tabstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a tabstop at the current position of :attr:`self.cursorX`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tabstop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">&gt;</span> <span class="n">tabstop</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c"># Put them in order :)</span>
                    <span class="k">break</span>
</div>
<div class="viewcode-block" id="Terminal.linefeed"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.linefeed">[docs]</a>    <span class="k">def</span> <span class="nf">linefeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        LF - Executes a line feed.</span>

<span class="sd">        .. note:: This actually just calls :meth:`Terminal.newline`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Terminal.next_line"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.next_line">[docs]</a>    <span class="k">def</span> <span class="nf">next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CNL - Moves the cursor down one line to the home position.  Will not</span>
<span class="sd">        result in a scrolling event like newline() does.</span>

<span class="sd">        .. note:: This is not the same thing as :meth:`Terminal.cursor_next_line` which preserves the cursor&#39;s column position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_home</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Terminal.reverse_linefeed"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.reverse_linefeed">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_linefeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RI - Executes a reverse line feed: Move the cursor up one line to the</span>
<span class="sd">        home position.  If the cursor move would result in going past the top</span>
<span class="sd">        margin of the screen (upwards) this will execute a scroll_down() event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_down</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_margin</span>
</div>
<div class="viewcode-block" id="Terminal.newline"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.newline">[docs]</a>    <span class="k">def</span> <span class="nf">newline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increases :attr:`self.cursorY` by 1 and calls :meth:`Terminal.scroll_up`</span>
<span class="sd">        if that action will move the curor past :attr:`self.bottom_margin`</span>
<span class="sd">        (usually the bottom of the screen).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_margin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_line</span><span class="p">()</span>
        <span class="c"># Shorten the line if it is longer than the number of columns</span>
        <span class="c"># NOTE: This lets us keep the width of existing lines even if the number</span>
        <span class="c"># of columns is reduced while at the same time accounting for apps like</span>
        <span class="c"># &#39;top&#39; that merely overwrite existing lines.  If we didn&#39;t do this</span>
        <span class="c"># the output from &#39;top&#39; would get all messed up from leftovers at the</span>
        <span class="c"># tail end of every line when self.cols had a larger value.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">cols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][:</span><span class="n">cols</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][:</span><span class="n">cols</span><span class="p">]</span>
        <span class="c"># NOTE: The above logic is placed inside of this function instead of</span>
        <span class="c"># inside self.write() in order to reduce CPU utilization.  There&#39;s no</span>
        <span class="c"># point in performing a conditional check for every incoming character</span>
        <span class="c"># when the only time it will matter is when a newline is being written.</span>
</div>
<div class="viewcode-block" id="Terminal.carriage_return"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.carriage_return">[docs]</a>    <span class="k">def</span> <span class="nf">carriage_return</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes a carriage return (sets :attr:`self.cursorX` to 0).  In other</span>
<span class="sd">        words it moves the cursor back to position 0 on the line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This autowrap magic stuff doesn&#39;t work so well so autowrap is now</span>
        <span class="c"># explicit until I figure out a way to differentiate between the type of</span>
        <span class="c"># long line output by something like &#39;ps axwww&#39; and the type that gets</span>
        <span class="c"># output by, say, bash when you type a really long command.</span>
        <span class="c">#if self.cursorX &gt;= self.cols and self.cursorX != self.cols:</span>
            <span class="c">#self.newline()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Terminal._xon"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._xon">[docs]</a>    <span class="k">def</span> <span class="nf">_xon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the XON character (stop ignoring).</span>

<span class="sd">        .. note:: Doesn&#39;t actually do anything (this feature was probably meant for the underlying terminal program).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;_xon()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_echo</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Terminal._xoff"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._xoff">[docs]</a>    <span class="k">def</span> <span class="nf">_xoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the XOFF character (start ignoring)</span>

<span class="sd">        .. note:: Doesn&#39;t actually do anything (this feature was probably meant for the underlying terminal program).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;_xoff()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_echo</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Terminal._cancel_esc_sequence"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._cancel_esc_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">_cancel_esc_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels any escape sequence currently being processed.  In other words</span>
<span class="sd">        it empties :attr:`self.esc_buffer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="Terminal._sub_esc_sequence"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._sub_esc_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">_sub_esc_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels any escape sequence currently in progress and replaces</span>
<span class="sd">        :attr:`self.esc_buffer` with single question mark (?).</span>

<span class="sd">        .. note:: Nothing presently uses this function and I can&#39;t remember what it was supposed to be part of (LOL!).  Obviously it isn&#39;t very important.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal._escape"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._escape">[docs]</a>    <span class="k">def</span> <span class="nf">_escape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the escape character as well as escape sequences that may end</span>
<span class="sd">        with an escape character.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span>
        <span class="k">if</span> <span class="n">buf</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x1b</span><span class="s">P&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">buf</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x1b</span><span class="s">]&#39;</span><span class="p">):</span>
            <span class="c"># CSRs and OSCs are special</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\x1b</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Get rid of whatever&#39;s there since we obviously didn&#39;t know what to</span>
            <span class="c"># do with it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1b</span><span class="s">&#39;</span>
</div>
<div class="viewcode-block" id="Terminal._csi"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._csi">[docs]</a>    <span class="k">def</span> <span class="nf">_csi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Marks the start of a CSI escape sequence (which is itself a character)</span>
<span class="sd">        by setting :attr:`self.esc_buffer` to &#39;\\\\x1b[&#39; (which is the CSI</span>
<span class="sd">        escape sequence).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1b</span><span class="s">[&#39;</span>
</div>
<div class="viewcode-block" id="Terminal._capture_file"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._capture_file">[docs]</a>    <span class="k">def</span> <span class="nf">_capture_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function gets called by :meth:`Terminal.write` when the incoming</span>
<span class="sd">        character stream matches a value in :attr:`self.magic`.  It will call</span>
<span class="sd">        whatever function is associated with the matching regex in</span>
<span class="sd">        :attr:`self.magic_map`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;_capture_file()&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">magic_header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">magic_header</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">):</span>
                <span class="c"># Create a reference point we can use to retrieve the file later</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_counter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="c"># Before doing anything else we need to mark the current cursor</span>
                <span class="c"># location as belonging to our file</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
                <span class="c"># Create an instance of the filetype we can reference</span>
                <span class="n">filetype_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic_map</span><span class="p">[</span><span class="n">magic_header</span><span class="p">](</span>
                    <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temppath</span><span class="p">,</span>
                    <span class="n">linkpath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linkpath</span><span class="p">,</span>
                    <span class="n">icondir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">icondir</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">filetype_instance</span>
                <span class="n">filetype_instance</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="c"># Start up an open file watcher so leftover file objects get</span>
                <span class="c"># closed when they&#39;re no longer being used</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">watcher</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">watcher</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
                    <span class="kn">import</span> <span class="nn">threading</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">watcher</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;watcher&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_captured_fd_watcher</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">watcher</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">watcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">return</span>
</div>
<div class="viewcode-block" id="Terminal._captured_fd_watcher"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._captured_fd_watcher">[docs]</a>    <span class="k">def</span> <span class="nf">_captured_fd_watcher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Meant to be run inside of a thread, calls close_captured_fds() until there</span>
<span class="sd">        are no more open image file descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;starting _captured_fd_watcher()&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="n">quitting</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">quitting</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_captured_fds</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">quitting</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;_captured_fd_watcher() quitting: No more images.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.close_captured_fds"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.close_captured_fds">[docs]</a>    <span class="k">def</span> <span class="nf">close_captured_fds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the file descriptors of any captured files that are no longer on</span>
<span class="sd">        the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;close_captured_fds()&#39;) # Commented because it&#39;s kinda noisy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                    <span class="c">#self.captured_files[ref].close()</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Terminal._string_terminator"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._string_terminator">[docs]</a>    <span class="k">def</span> <span class="nf">_string_terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the string terminator (ST).</span>

<span class="sd">        .. note:: Doesn&#39;t actually do anything at the moment.  Probably not needed since :meth:`Terminal._escape` and/or :meth:`Terminal.bell` will end up handling any sort of sequence that would end in an ST anyway.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># NOTE: Might this just call _cancel_esc_sequence?  I need to double-check.</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal._osc_handler"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._osc_handler">[docs]</a>    <span class="k">def</span> <span class="nf">_osc_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles Operating System Command (OSC) escape sequences which need</span>
<span class="sd">        special care since they are of indeterminiate length and end with</span>
<span class="sd">        either a bell (\\\\x07) or a sequence terminator (\\\\x9c aka ST).  This</span>
<span class="sd">        will usually be called from :meth:`Terminal.bell` to set the title of</span>
<span class="sd">        the terminal (just like an xterm) but it is also possible to be called</span>
<span class="sd">        directly whenever an ST is encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Try the title sequence first</span>
        <span class="n">match_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RE_TITLE_SEQ</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_obj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="c"># Sets self.title</span>
            <span class="k">return</span>
        <span class="c"># Next try our special optional handler sequence</span>
        <span class="n">match_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RE_OPT_SEQ</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_obj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_opt_handler</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c"># At this point we&#39;ve encountered something unusual</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Warning: No special ESC sequence handler for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
            <span class="sb">`self.esc_buffer`</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="Terminal.bell"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.bell">[docs]</a>    <span class="k">def</span> <span class="nf">bell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the bell character and executes</span>
<span class="sd">        :meth:`Terminal.callbacks[CALLBACK_BELL]` (if we are not in the middle</span>
<span class="sd">        of an escape sequence that ends with a bell character =).  If we *are*</span>
<span class="sd">        in the middle of an escape sequence, calls :meth:`self._osc_handler`</span>
<span class="sd">        since we can be nearly certain that we&#39;re simply terminating an OSC</span>
<span class="sd">        sequence. Isn&#39;t terminal emulation grand? ⨀_⨀</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># NOTE: A little explanation is in order: The bell character (\x07) by</span>
        <span class="c">#       itself should play a bell (pretty straighforward).  However, if</span>
        <span class="c">#       the bell character is at the tail end of a particular escape</span>
        <span class="c">#       sequence (string starting with \x1b]0;) this indicates an xterm</span>
        <span class="c">#       title (everything between \x1b]0;...\x07).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span><span class="p">:</span> <span class="c"># We&#39;re not in the middle of an esc sequence</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Regular bell&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_BELL</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">callback</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># We&#39;re (likely) setting a title</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">esc_buffer</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\x07</span><span class="s">&#39;</span> <span class="c"># Add the bell char so we don&#39;t lose it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_osc_handler</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Terminal._device_status_report"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._device_status_report">[docs]</a>    <span class="k">def</span> <span class="nf">_device_status_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns &#39;\\\\x1b[0n&#39; (terminal OK) and executes:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.callbacks[CALLBACK_DSR](&quot;\\x1b[0n&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;_device_status_report()&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\x1b</span><span class="s">[0n&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_DSR</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">response</span>
</div>
<div class="viewcode-block" id="Terminal._csi_device_identification"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._csi_device_identification">[docs]</a>    <span class="k">def</span> <span class="nf">_csi_device_identification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If we&#39;re responding to ^[Z, ^[c, or ^[0c, returns &#39;\\\\x1b[1;2c&#39;</span>
<span class="sd">        (Meaning: I&#39;m a vt220 terminal, version 1.0) and</span>
<span class="sd">        executes:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.callbacks[self.CALLBACK_DSR](&quot;\\x1b[1;2c&quot;)</span>

<span class="sd">        If we&#39;re responding to ^[&gt;c or ^[&gt;0c, executes:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.callbacks[self.CALLBACK_DSR](&quot;\\x1b[&gt;0;271;0c&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;_csi_device_identification(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span> <span class="ow">and</span> <span class="s">u&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\x1b</span><span class="s">[&gt;0;271;0c&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\x1b</span><span class="s">[?1;2c&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_DSR</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">response</span>
</div>
<div class="viewcode-block" id="Terminal._csi_device_status_report"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._csi_device_status_report">[docs]</a>    <span class="k">def</span> <span class="nf">_csi_device_status_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`self.callbacks[self.CALLBACK_DSR]` with an appropriate</span>
<span class="sd">        response to the given *request*.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.callbacks[self.CALLBACK_DSR](response)</span>

<span class="sd">        Supported requests and their responses:</span>

<span class="sd">            =============================    ==================</span>
<span class="sd">            Request                          Response</span>
<span class="sd">            =============================    ==================</span>
<span class="sd">            ^[5n (Status Report)             ^[[0n</span>
<span class="sd">            ^[6n (Report Cursor Position)    ^[[&lt;row&gt;;&lt;column&gt;R</span>
<span class="sd">            ^[15n (Printer Ready?)           ^[[10n (Ready)</span>
<span class="sd">            =============================    ==================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;_csi_device_status_report(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">request</span><span class="p">)</span>
        <span class="n">supported_requests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">u&quot;5&quot;</span><span class="p">,</span>
            <span class="s">u&quot;6&quot;</span><span class="p">,</span>
            <span class="s">u&quot;15&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="p">:</span>
            <span class="k">return</span> <span class="c"># Nothing to do</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
            <span class="c"># Get rid of it</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">supported_requests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="s">u&quot;5&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\x1b</span><span class="s">[0n&quot;</span>
            <span class="k">elif</span> <span class="n">request</span> <span class="o">==</span> <span class="s">u&quot;6&quot;</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\x1b</span><span class="s">[</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">R&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">request</span> <span class="o">==</span> <span class="s">u&quot;15&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\x1b</span><span class="s">[10n&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_DSR</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">response</span>
</div>
<div class="viewcode-block" id="Terminal.set_expanded_mode"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.set_expanded_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_expanded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accepts &quot;standard mode&quot; settings.  Typically &#39;\\\\x1b[?25h&#39; to hide cursor.</span>

<span class="sd">        Notes on modes::</span>

<span class="sd">            &#39;?1h&#39; - Application Cursor Keys</span>
<span class="sd">            &#39;?5h&#39; - DECSCNM (default off): Set reverse-video mode.</span>
<span class="sd">            &#39;?7h&#39; - DECAWM: Autowrap mode</span>
<span class="sd">            &#39;?12h&#39; - Local echo (SRM or Send Receive Mode)</span>
<span class="sd">            &#39;?25h&#39; - Hide cursor</span>
<span class="sd">            &#39;?1049h&#39; - Save cursor and screen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: Add support for the following:</span>
        <span class="c"># * 3: 132 column mode (might be &quot;or greater&quot;)</span>
        <span class="c"># * 4: Smooth scroll (for animations and also makes things less choppy)</span>
        <span class="c"># * 5: Reverse video (should be easy: just need some extra CSS)</span>
        <span class="c"># * 6: Origin mode</span>
        <span class="c"># * 7: Wraparound mode</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;set_expanded_mode(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">setting</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">setting</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
            <span class="c"># DEC Private Mode Set</span>
            <span class="n">setting</span> <span class="o">=</span> <span class="n">setting</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c"># Don&#39;t need the ?</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">setting</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expanded_modes</span><span class="p">[</span><span class="n">setting</span><span class="p">](</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="k">pass</span> <span class="c"># Unsupported expanded mode</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_MODE</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># There&#39;s a couple mode settings that are just &quot;[Nh&quot; where N==number</span>
            <span class="c"># [2h Keyboard Action Mode (AM)</span>
            <span class="c"># [4h Insert Mode</span>
            <span class="c"># [12h Send/Receive Mode (SRM)</span>
            <span class="c"># [24h Automatic Newline (LNM)</span>
            <span class="k">if</span> <span class="n">setting</span> <span class="o">==</span> <span class="s">&#39;4&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_mode</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Terminal.reset_expanded_mode"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.reset_expanded_mode">[docs]</a>    <span class="k">def</span> <span class="nf">reset_expanded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accepts &quot;standard mode&quot; settings.  Typically &#39;\\\\x1b[?25l&#39; to show</span>
<span class="sd">        cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;reset_expanded_mode(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">setting</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">setting</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
            <span class="n">setting</span> <span class="o">=</span> <span class="n">setting</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c"># Don&#39;t need the ?</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">setting</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expanded_modes</span><span class="p">[</span><span class="n">setting</span><span class="p">](</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="k">pass</span> <span class="c"># Unsupported expanded mode</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_MODE</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># There&#39;s a couple mode settings that are just &quot;[Nh&quot; where N==number</span>
            <span class="c"># [2h Keyboard Action Mode (AM)</span>
            <span class="c"># [4h Insert Mode</span>
            <span class="c"># [12h Send/Receive Mode (SRM)</span>
            <span class="c"># [24h Automatic Newline (LNM)</span>
            <span class="c"># The only one we care about is 4 (insert mode)</span>
            <span class="k">if</span> <span class="n">setting</span> <span class="o">==</span> <span class="s">&#39;4&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_mode</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Terminal.set_application_mode"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.set_application_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_application_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolean</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets :attr:`self.application_keys` equal to *boolean*.  Literally:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.application_keys = boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application_keys</span> <span class="o">=</span> <span class="n">boolean</span>
</div>
<div class="viewcode-block" id="Terminal.toggle_alternate_screen_buffer"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.toggle_alternate_screen_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_alternate_screen_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If *alt* is True, copy the current screen and renditions to</span>
<span class="sd">        :attr:`self.alt_screen` and :attr:`self.alt_renditions` then re-init</span>
<span class="sd">        :attr:`self.screen` and :attr:`self.renditions`.</span>

<span class="sd">        If *alt* is False, restore the saved screen buffer and renditions then</span>
<span class="sd">        nullify :attr:`self.alt_screen` and :attr:`self.alt_renditions`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;toggle_alternate_screen_buffer(%s)&#39; % alt)</span>
        <span class="k">if</span> <span class="n">alt</span><span class="p">:</span>
            <span class="c"># Save the existing screen and renditions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_renditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[:]</span>
            <span class="c"># Make a fresh one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Restore the screen</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_renditions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span><span class="p">[:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_renditions</span><span class="p">[:]</span>
            <span class="c"># Empty out the alternate buffer (to save memory)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_screen</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_renditions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># These all need to be reset no matter what</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Terminal.toggle_alternate_screen_buffer_cursor"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.toggle_alternate_screen_buffer_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_alternate_screen_buffer_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as :meth:`Terminal.toggle_alternate_screen_buffer` but also</span>
<span class="sd">        saves/restores the cursor location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;toggle_alternate_screen_buffer_cursor(%s)&#39; % alt)</span>
        <span class="k">if</span> <span class="n">alt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorX</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_cursorY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_alternate_screen_buffer</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.toggle_autowrap"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.toggle_autowrap">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_autowrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolean</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets :attr:`self.autowrap` equal to *boolean*.  Literally:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.autowrap = boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;setting autowrap: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boolean</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autowrap</span> <span class="o">=</span> <span class="n">boolean</span>
</div>
<div class="viewcode-block" id="Terminal.show_hide_cursor"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.show_hide_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">show_hide_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolean</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Literally:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.show_cursor = boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_cursor</span> <span class="o">=</span> <span class="n">boolean</span>
</div>
<div class="viewcode-block" id="Terminal.send_receive_mode"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.send_receive_mode">[docs]</a>    <span class="k">def</span> <span class="nf">send_receive_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turns on or off local echo dependong on the value of *onoff*:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            self.local_echo = onoff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;send_receive_mode(%s)&quot; % repr(onoff))</span>
        <span class="c"># This has been disabled because it might only be meant for the</span>
        <span class="c"># underlying program and not the terminal emulator.  Needs research.</span>
        <span class="c">#if onoff:</span>
            <span class="c">#self.local_echo = False</span>
        <span class="c">#else:</span>
            <span class="c">#self.local_echo = True</span>
</div>
<div class="viewcode-block" id="Terminal.insert_characters"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.insert_characters">[docs]</a>    <span class="k">def</span> <span class="nf">insert_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts the specified number of characters at the cursor position.</span>
<span class="sd">        Overwriting whatever is already present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;insert_characters(%s)&quot; % n)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="c"># Take one down, pass it around</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">,</span> <span class="s">u&#39; &#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.delete_characters"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.delete_characters">[docs]</a>    <span class="k">def</span> <span class="nf">delete_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DCH - Deletes (to the left) the specified number of characters at the</span>
<span class="sd">        cursor position.  As characters are deleted, the remaining characters</span>
<span class="sd">        between the cursor and right margin move to the left. Character</span>
<span class="sd">        attributes (renditions) move with the characters.  The terminal adds</span>
<span class="sd">        blank spaces with no visual character attributes at the right margin.</span>
<span class="sd">        DCH has no effect outside the scrolling margins.</span>

<span class="sd">        .. note:: Deletes renditions too.  You&#39;d *think* that would be in one of the VT-* manuals...  Nope!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;delete_characters(%s)&quot; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span> <span class="c"># e.g. n == &#39;&#39;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39; &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="c"># At edge of screen, ignore</span>
                <span class="c">#print(&#39;IndexError in delete_characters(): %s&#39; % e)</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal._erase_characters"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._erase_characters">[docs]</a>    <span class="k">def</span> <span class="nf">_erase_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Erases (to the right) the specified number of characters at the cursor</span>
<span class="sd">        position.</span>

<span class="sd">        .. note:: Deletes renditions too.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;_erase_characters(%s)&quot; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span> <span class="c"># e.g. n == &#39;&#39;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_left"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_left">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnD CUB (Cursor Back)&quot;&quot;&quot;</span>
        <span class="c"># Commented out to save CPU (and the others below too)</span>
        <span class="c">#logging.debug(&#39;cursor_left(%s)&#39; % n)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_right"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_right">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnC CUF (Cursor Forward)&quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;cursor_right(%s)&#39; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_up"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_up">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnA CUU (Cursor Up)&quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;cursor_up(%s)&#39; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_down"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_down">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnB CUD (Cursor Down)&quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;cursor_down(%s)&#39; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_next_line"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_next_line">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnE CNL (Cursor Next Line)&quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;cursor_next_line(%s)&quot; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_previous_line"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_previous_line">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_previous_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnF CPL (Cursor Previous Line)&quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;cursor_previous_line(%s)&quot; % n)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_horizontal_absolute"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_horizontal_absolute">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_horizontal_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ESCnG CHA (Cursor Horizontal Absolute)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="c"># -1 because cols is 0-based</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_position"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_position">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ESCnH CUP (Cursor Position).  Move the cursor to the given coordinates.</span>

<span class="sd">            :coordinates: Should be something like, &#39;row;col&#39; (1-based) but, &#39;row&#39;, &#39;row;&#39;, and &#39;;col&#39; are also valid (assumes 1 on missing value).</span>

<span class="sd">        .. note:: If coordinates is &#39;&#39; (an empty string), the cursor will be moved to the top left (1;1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># NOTE: Since this is 1-based we have to subtract 1 from everything to</span>
        <span class="c">#       match how we store these values internally.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="s">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">coordinates</span>
            <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># These ensure a positive integer while reducing row and col by 1:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="n">col</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.cursor_position_vertical"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.cursor_position_vertical">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_position_vertical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vertical Line Position Absolute (VPA) - Moves the cursor to given line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Terminal.clear_screen"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_screen">[docs]</a>    <span class="k">def</span> <span class="nf">clear_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the screen.  Also used to emulate a terminal reset.</span>

<span class="sd">        .. note:: The current rendition (self.cur_rendition) will be applied to all characters on the screen when this function is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;clear_screen()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_screen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_renditions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Terminal.clear_screen_from_cursor_down"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_screen_from_cursor_down">[docs]</a>    <span class="k">def</span> <span class="nf">clear_screen_from_cursor_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the screen from the cursor down (ESC[J or ESC[0J).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;clear_screen_from_cursor_down()&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">:]</span>
        <span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="c"># Just to save space below</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">:]</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Terminal.clear_screen_from_cursor_up"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_screen_from_cursor_up">[docs]</a>    <span class="k">def</span> <span class="nf">clear_screen_from_cursor_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the screen from the cursor up (ESC[1J).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;clear_screen_from_cursor_up()&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Terminal.clear_screen_from_cursor"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_screen_from_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">clear_screen_from_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CSI *n* J ED (Erase Data).  This escape sequence uses the following rules:</span>

<span class="sd">        ======  =============================   ===</span>
<span class="sd">        Esc[J   Clear screen from cursor down   ED0</span>
<span class="sd">        Esc[0J  Clear screen from cursor down   ED0</span>
<span class="sd">        Esc[1J  Clear screen from cursor up     ED1</span>
<span class="sd">        Esc[2J  Clear entire screen             ED2</span>
<span class="sd">        ======  =============================   ===</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;clear_screen_from_cursor(%s)&#39; % n)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c"># Esc[J</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">clear_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen_from_cursor_down</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen_from_cursor_up</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clear_types</span><span class="p">[</span><span class="n">n</span><span class="p">]()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Error: Unsupported number for escape sequence J&quot;</span><span class="p">))</span>
        <span class="c"># Execute our callbacks</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CHANGED</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.clear_line_from_cursor_right"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_line_from_cursor_right">[docs]</a>    <span class="k">def</span> <span class="nf">clear_line_from_cursor_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the screen from the cursor right (ESC[K or ESC[0K).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;clear_line_from_cursor_right()&quot;)</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span>
        <span class="n">saved_renditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">:]))</span>
        <span class="n">renditions</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">:]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved</span> <span class="o">+</span> <span class="n">spaces</span>
        <span class="c"># Reset the cursor position&#39;s rendition to the end of the line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved_renditions</span> <span class="o">+</span> <span class="n">renditions</span>
</div>
<div class="viewcode-block" id="Terminal.clear_line_from_cursor_left"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_line_from_cursor_left">[docs]</a>    <span class="k">def</span> <span class="nf">clear_line_from_cursor_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the screen from the cursor left (ESC[1K).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;clear_line_from_cursor_left()&quot;)</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">:]</span>
        <span class="n">saved_renditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">:]</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]))</span>
        <span class="n">renditions</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="n">spaces</span> <span class="o">+</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="n">renditions</span> <span class="o">+</span> <span class="n">saved_renditions</span>
</div>
<div class="viewcode-block" id="Terminal.clear_line"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_line">[docs]</a>    <span class="k">def</span> <span class="nf">clear_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the entire line (ESC[2K).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;clear_line()&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Terminal.clear_line_from_cursor"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.clear_line_from_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">clear_line_from_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CSI*n*K EL (Erase in Line).  This escape sequence uses the following</span>
<span class="sd">        rules:</span>

<span class="sd">        ======  ==============================  ===</span>
<span class="sd">        Esc[K   Clear screen from cursor right  EL0</span>
<span class="sd">        Esc[0K  Clear screen from cursor right  EL0</span>
<span class="sd">        Esc[1K  Clear screen from cursor left   EL1</span>
<span class="sd">        Esc[2K  Clear entire line               ED2</span>
<span class="sd">        ======  ==============================  ===</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&#39;clear_line_from_cursor(%s)&#39; % n)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c"># Esc[J</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">clear_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_from_cursor_right</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_from_cursor_left</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_line</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clear_types</span><span class="p">[</span><span class="n">n</span><span class="p">]()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
                <span class="s">&quot;Error: Unsupported number for CSI escape sequence K&quot;</span><span class="p">))</span>
        <span class="c"># Execute our callbacks</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CHANGED</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_CURSOR_POS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal.set_led_state"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.set_led_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_led_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values the dict, self.leds depending on *n* using the following</span>
<span class="sd">        rules:</span>

<span class="sd">        ======  ======================  ======</span>
<span class="sd">        Esc[0q  Turn off all four leds  DECLL0</span>
<span class="sd">        Esc[1q  Turn on LED #1          DECLL1</span>
<span class="sd">        Esc[2q  Turn on LED #2          DECLL2</span>
<span class="sd">        Esc[3q  Turn on LED #3          DECLL3</span>
<span class="sd">        Esc[4q  Turn on LED #4          DECLL4</span>
<span class="sd">        ======  ======================  ======</span>

<span class="sd">        .. note:: These aren&#39;t implemented in Gate One&#39;s GUI (yet) but they certainly kept track of!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;set_led_state(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">leds</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">led</span> <span class="ow">in</span> <span class="n">leds</span><span class="p">:</span>
            <span class="n">led</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">led</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">led</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leds</span><span class="p">[</span><span class="n">led</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_LEDS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">led</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal._set_rendition"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._set_rendition">[docs]</a>    <span class="k">def</span> <span class="nf">_set_rendition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets :attr:`self.renditions[self.cursorY][self.cursorX]` equal to</span>
<span class="sd">        *n.split(&#39;;&#39;)*.</span>

<span class="sd">        *n* is expected to be a string of ECMA-48 rendition numbers separated by</span>
<span class="sd">        semicolons.  Example::</span>

<span class="sd">            &#39;0;1;31&#39;</span>

<span class="sd">        ...will result in::</span>

<span class="sd">            [0, 1, 31]</span>

<span class="sd">        Note that the numbers were converted to integers and the order was</span>
<span class="sd">        preserved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;_set_rendition(%s)&quot; % n)</span>
        <span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span>
        <span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span>
        <span class="k">if</span> <span class="n">cursorX</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span> <span class="c"># We&#39;re at the end of the row</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="n">cursorY</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">cursorX</span><span class="p">:</span>
                    <span class="c"># Make it all longer</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">[</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39; &#39;</span><span class="p">)</span> <span class="c"># Make it longer</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">[</span><span class="n">cursorY</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span> <span class="c"># This needs to match</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="c"># This can happen if the rate limiter kicks in and starts</span>
                <span class="c"># cutting off escape sequences at random.</span>
                <span class="k">return</span> <span class="c"># Don&#39;t bother attempting to process anything else</span>
        <span class="k">if</span> <span class="n">cursorY</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span>
                <span class="s">&quot;cursorY &gt;= self.rows!  This is either a bug or just a symptom &quot;</span>
                <span class="s">&quot;of the rate limiter kicking in.&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="c"># Don&#39;t bother setting renditions past the bottom</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span> <span class="c"># or \x1b[m (reset)</span>
            <span class="c"># First char in PUA Plane 16 is always the default:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c"># Should be reset (e.g. [0])</span>
            <span class="k">return</span> <span class="c"># No need for further processing; save some CPU</span>
        <span class="c"># Convert the string (e.g. &#39;0;1;32&#39;) to a list (e.g. [0,1,32]</span>
        <span class="n">new_renditions</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
        <span class="c"># Handle 256-color renditions by getting rid of the (38|48);5 part and</span>
        <span class="c"># incrementing foregrounds by 1000 and backgrounds by 10000 so we can</span>
        <span class="c"># tell them apart in _spanify_screen().</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">38</span> <span class="ow">in</span> <span class="n">new_renditions</span><span class="p">:</span>
                <span class="n">foreground_index</span> <span class="o">=</span> <span class="n">new_renditions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">38</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_renditions</span><span class="p">[</span><span class="n">foreground_index</span><span class="p">:])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">new_renditions</span><span class="p">[</span><span class="n">foreground_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="c"># This is a valid 256-color rendition (38;5;&lt;num&gt;)</span>
                        <span class="n">new_renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">foreground_index</span><span class="p">)</span> <span class="c"># Goodbye 38</span>
                        <span class="n">new_renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">foreground_index</span><span class="p">)</span> <span class="c"># Goodbye 5</span>
                        <span class="n">new_renditions</span><span class="p">[</span><span class="n">foreground_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1000</span>
            <span class="k">if</span> <span class="mi">48</span> <span class="ow">in</span> <span class="n">new_renditions</span><span class="p">:</span>
                <span class="n">background_index</span> <span class="o">=</span> <span class="n">new_renditions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">48</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_renditions</span><span class="p">[</span><span class="n">background_index</span><span class="p">:])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">new_renditions</span><span class="p">[</span><span class="n">background_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="c"># This is a valid 256-color rendition (48;5;&lt;num&gt;)</span>
                        <span class="n">new_renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">background_index</span><span class="p">)</span> <span class="c"># Goodbye 48</span>
                        <span class="n">new_renditions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">background_index</span><span class="p">)</span> <span class="c"># Goodbye 5</span>
                        <span class="n">new_renditions</span><span class="p">[</span><span class="n">background_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10000</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c"># Likely that the rate limiter has caused all sorts of havoc with</span>
            <span class="c"># escape sequences.  Just ignore it and halt further processing</span>
            <span class="k">return</span>
        <span class="n">out_renditions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rend</span> <span class="ow">in</span> <span class="n">new_renditions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rend</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out_renditions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_renditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rend</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_renditions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># If it starts with 0 there&#39;s no need to combine it with the</span>
            <span class="c"># previous rendition...</span>
            <span class="n">reduced</span> <span class="o">=</span> <span class="n">_reduce_renditions</span><span class="p">(</span><span class="n">out_renditions</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reduced</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">new_ref_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rend_counter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">new_ref_point</span><span class="p">:</span> <span class="n">reduced</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="n">new_ref_point</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># Find the right reference point to use</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">reduced</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">return</span>
        <span class="n">new_renditions</span> <span class="o">=</span> <span class="n">out_renditions</span>
        <span class="n">cur_rendition_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span><span class="p">]</span>
        <span class="n">reduced</span> <span class="o">=</span> <span class="n">_reduce_renditions</span><span class="p">(</span><span class="n">cur_rendition_list</span> <span class="o">+</span> <span class="n">new_renditions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reduced</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">new_ref_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rend_counter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">new_ref_point</span><span class="p">:</span> <span class="n">reduced</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="n">new_ref_point</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># Find the right reference point to use</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">reduced</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_rendition</span> <span class="o">=</span> <span class="n">k</span>
</div>
<div class="viewcode-block" id="Terminal._opt_handler"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._opt_handler">[docs]</a>    <span class="k">def</span> <span class="nf">_opt_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Optional special escape sequence handler for sequences matching</span>
<span class="sd">        RE_OPT_SEQ.  If CALLBACK_OPT is defined it will be called like so::</span>

<span class="sd">            self.callbacks[CALLBACK_OPT](chars)</span>

<span class="sd">        Applications can use this escape sequence to define whatever special</span>
<span class="sd">        handlers they like.  It works like this: If an escape sequence is</span>
<span class="sd">        encountered matching RE_OPT_SEQ this method will be called with the</span>
<span class="sd">        inbetween *chars* (e.g. \x1b]_;&lt;chars&gt;\x07) as the argument.</span>

<span class="sd">        Applications can then do what they wish with *chars*.</span>

<span class="sd">        .. note:: I added this functionality so that plugin authors would have a mechanism to communicate with terminal applications.  See the SSH plugin for an example of how this can be done (there&#39;s channels of communication amongst ssh_connect.py, ssh.js, and ssh.py).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">CALLBACK_OPT</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c"># High likelyhood that nothing is defined.  No biggie.</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Terminal._spanify_screen"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._spanify_screen">[docs]</a>    <span class="k">def</span> <span class="nf">_spanify_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates over the lines in *screen* and *renditions*, applying HTML</span>
<span class="sd">        markup (span tags) where appropriate and returns the result as a list of</span>
<span class="sd">        lines. It also marks the cursor position via a &lt;span&gt; tag at the</span>
<span class="sd">        appropriate location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#logging.debug(&quot;_spanify_screen()&quot;)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># NOTE: Why these duplicates of self.* and globals?  Local variable</span>
        <span class="c"># lookups are faster--especially in loops.</span>
        <span class="n">special</span> <span class="o">=</span> <span class="n">SPECIAL</span>
        <span class="n">rendition_classes</span> <span class="o">=</span> <span class="n">RENDITION_CLASSES</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span>
        <span class="n">renditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span>
        <span class="n">renditions_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span>
        <span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span>
        <span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">screen</span><span class="p">):</span>
            <span class="c"># Fix it to be equal--assume first time/screen reset/resize/etc</span>
            <span class="c"># Just fill it with empty strings (only the length matters here)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">screen</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">screen</span><span class="p">]</span>
        <span class="c"># The html_cache may need to be fixed as well</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">screen</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&#39;&#39;</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">screen</span><span class="p">]</span> <span class="c"># Essentially a reset</span>
        <span class="n">spancount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">prev_rendition</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">foregrounds</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;f0&#39;</span><span class="p">,</span><span class="s">&#39;f1&#39;</span><span class="p">,</span><span class="s">&#39;f2&#39;</span><span class="p">,</span><span class="s">&#39;f3&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">,</span><span class="s">&#39;f5&#39;</span><span class="p">,</span><span class="s">&#39;f6&#39;</span><span class="p">,</span><span class="s">&#39;f7&#39;</span><span class="p">)</span>
        <span class="n">backgrounds</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;b0&#39;</span><span class="p">,</span><span class="s">&#39;b1&#39;</span><span class="p">,</span><span class="s">&#39;b2&#39;</span><span class="p">,</span><span class="s">&#39;b3&#39;</span><span class="p">,</span><span class="s">&#39;b4&#39;</span><span class="p">,</span><span class="s">&#39;b5&#39;</span><span class="p">,</span><span class="s">&#39;b6&#39;</span><span class="p">,</span><span class="s">&#39;b7&#39;</span><span class="p">)</span>
        <span class="n">html_entities</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;&amp;&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">:</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">linecount</span><span class="p">,</span> <span class="n">line_rendition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">izip</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">renditions</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line_rendition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rendition</span> <span class="o">=</span> <span class="n">line_rendition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">linecount</span> <span class="o">!=</span> <span class="n">cursorY</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span><span class="p">[</span><span class="n">linecount</span><span class="p">]</span> <span class="o">==</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;&lt;span class=&quot;cursor&quot;&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span><span class="p">[</span><span class="n">linecount</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span><span class="p">[</span><span class="n">linecount</span><span class="p">]</span> <span class="o">==</span> <span class="n">rendition</span><span class="p">:</span>
                        <span class="c"># No change since the last dump.  Use the cache...</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span><span class="p">[</span><span class="n">linecount</span><span class="p">])</span>
                        <span class="k">continue</span> <span class="c"># Nothing changed so move on to the next line</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">current_classes</span><span class="p">:</span>
                <span class="n">outline</span> <span class="o">+=</span> <span class="s">&#39;&lt;span class=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span>
            <span class="n">charcount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># TODO: Figure out if there&#39;s a faster way to process each character</span>
            <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">rend</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">rendition</span><span class="p">):</span>
                <span class="n">rend</span> <span class="o">=</span> <span class="n">renditions_store</span><span class="p">[</span><span class="n">rend</span><span class="p">]</span> <span class="c"># Get actual rendition</span>
                <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">special</span><span class="p">:</span> <span class="c"># Special stuff =)</span>
                    <span class="c"># Obviously, not really a single character</span>
                    <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">:</span>
                        <span class="n">outline</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">[</span><span class="n">char</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
                        <span class="k">continue</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&quot;&amp;&lt;&gt;&quot;</span><span class="p">:</span>
                    <span class="c"># Have to convert ampersands and lt/gt to HTML entities</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="n">html_entities</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">rend</span> <span class="o">==</span> <span class="n">prev_rendition</span><span class="p">:</span>
                    <span class="c"># Shortcut...  So we can skip all the logic below</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prev_rendition</span> <span class="o">=</span> <span class="n">rend</span>
                <span class="k">if</span> <span class="n">changed</span> <span class="ow">and</span> <span class="n">rend</span><span class="p">:</span>
                    <span class="n">classes</span> <span class="o">=</span> <span class="n">imap</span><span class="p">(</span><span class="n">rendition_classes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">rend</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_class</span> <span class="ow">and</span> <span class="n">_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_classes</span><span class="p">:</span>
                            <span class="c"># Something changed...  Start a new span</span>
                            <span class="k">if</span> <span class="n">spancount</span><span class="p">:</span>
                                <span class="n">outline</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
                                <span class="n">spancount</span> <span class="o">-=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s">&#39;reset&#39;</span> <span class="ow">in</span> <span class="n">_class</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">_class</span> <span class="o">==</span> <span class="s">&#39;reset&#39;</span><span class="p">:</span>
                                    <span class="n">current_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="n">spancount</span><span class="p">:</span>
                                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">spancount</span><span class="p">):</span>
                                            <span class="n">outline</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
                                        <span class="n">spancount</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">reset_class</span> <span class="o">=</span> <span class="n">_class</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;reset&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="n">reset_class</span> <span class="o">==</span> <span class="s">&#39;foreground&#39;</span><span class="p">:</span>
                                        <span class="c"># Remove any foreground classes</span>
                                        <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="n">foregrounds</span>
                                        <span class="p">]</span>
                                    <span class="k">elif</span> <span class="n">reset_class</span> <span class="o">==</span> <span class="s">&#39;background&#39;</span><span class="p">:</span>
                                        <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="n">backgrounds</span>
                                        <span class="p">]</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">try</span><span class="p">:</span>
                                            <span class="n">current_classes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reset_class</span><span class="p">)</span>
                                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                            <span class="c"># Trying to reset something that was</span>
                                            <span class="c"># never set.  Ignore</span>
                                            <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">foregrounds</span><span class="p">:</span>
                                    <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="n">foregrounds</span>
                                    <span class="p">]</span>
                                <span class="k">elif</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">backgrounds</span><span class="p">:</span>
                                    <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="n">backgrounds</span>
                                    <span class="p">]</span>
                                <span class="n">current_classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_class</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">current_classes</span><span class="p">:</span>
                        <span class="n">outline</span> <span class="o">+=</span> <span class="s">&#39;&lt;span class=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span>
                        <span class="n">spancount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">linecount</span> <span class="o">==</span> <span class="n">cursorY</span> <span class="ow">and</span> <span class="n">charcount</span> <span class="o">==</span> <span class="n">cursorX</span><span class="p">:</span> <span class="c"># Cursor position</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cursor</span><span class="p">:</span>
                        <span class="n">outline</span> <span class="o">+=</span> <span class="s">&#39;&lt;span class=&quot;cursor&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="n">char</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">outline</span> <span class="o">+=</span> <span class="n">char</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outline</span> <span class="o">+=</span> <span class="n">char</span>
                <span class="n">charcount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump</span><span class="p">[</span><span class="n">linecount</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_dump_rend</span><span class="p">[</span><span class="n">linecount</span><span class="p">]</span> <span class="o">=</span> <span class="n">rendition</span><span class="p">[:]</span>
            <span class="k">if</span> <span class="n">outline</span><span class="p">:</span>
                <span class="c"># Make sure all renditions terminate at the end of the line</span>
                <span class="k">for</span> <span class="n">whatever</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">spancount</span><span class="p">):</span>
                    <span class="n">outline</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span><span class="p">[</span><span class="n">linecount</span><span class="p">]</span> <span class="o">=</span> <span class="n">outline</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># &#39;null&#39; is shorter than 4 spaces</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">html_cache</span><span class="p">[</span><span class="n">linecount</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="c"># NOTE: The client has been programmed to treat None (aka null in</span>
            <span class="c">#       JavaScript) as blank lines.</span>
        <span class="k">for</span> <span class="n">whatever</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">spancount</span><span class="p">):</span> <span class="c"># Bit of cleanup to be safe</span>
            <span class="n">results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
        <span class="k">return</span> <span class="n">results</span>
</div>
<div class="viewcode-block" id="Terminal._spanify_scrollback"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal._spanify_scrollback">[docs]</a>    <span class="k">def</span> <span class="nf">_spanify_scrollback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spanifies everything inside *screen* using *renditions*.  This differs</span>
<span class="sd">        from _spanify_screen() in that it doesn&#39;t apply any logic to detect the</span>
<span class="sd">        location of the cursor (to make it just a tiny bit faster).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># NOTE: See the comments in _spanify_screen() for details on this logic</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">special</span> <span class="o">=</span> <span class="n">SPECIAL</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span>
        <span class="n">renditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_renditions</span>
        <span class="n">rendition_classes</span> <span class="o">=</span> <span class="n">RENDITION_CLASSES</span>
        <span class="n">renditions_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions_store</span>
        <span class="n">spancount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">prev_rendition</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">foregrounds</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;f0&#39;</span><span class="p">,</span><span class="s">&#39;f1&#39;</span><span class="p">,</span><span class="s">&#39;f2&#39;</span><span class="p">,</span><span class="s">&#39;f3&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">,</span><span class="s">&#39;f5&#39;</span><span class="p">,</span><span class="s">&#39;f6&#39;</span><span class="p">,</span><span class="s">&#39;f7&#39;</span><span class="p">)</span>
        <span class="n">backgrounds</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;b0&#39;</span><span class="p">,</span><span class="s">&#39;b1&#39;</span><span class="p">,</span><span class="s">&#39;b2&#39;</span><span class="p">,</span><span class="s">&#39;b3&#39;</span><span class="p">,</span><span class="s">&#39;b4&#39;</span><span class="p">,</span><span class="s">&#39;b5&#39;</span><span class="p">,</span><span class="s">&#39;b6&#39;</span><span class="p">,</span><span class="s">&#39;b7&#39;</span><span class="p">)</span>
        <span class="n">html_entities</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;&amp;&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">:</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">rendition</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">renditions</span><span class="p">):</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">current_classes</span><span class="p">:</span>
                <span class="n">outline</span> <span class="o">+=</span> <span class="s">&#39;&lt;span class=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">rend</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">rendition</span><span class="p">):</span>
                <span class="n">rend</span> <span class="o">=</span> <span class="n">renditions_store</span><span class="p">[</span><span class="n">rend</span><span class="p">]</span> <span class="c"># Get actual rendition</span>
                <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">special</span><span class="p">:</span> <span class="c"># Special stuff =)</span>
                    <span class="c"># Obviously, not really a single character</span>
                    <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">:</span>
                        <span class="n">outline</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured_files</span><span class="p">[</span><span class="n">char</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
                        <span class="k">continue</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&quot;&amp;&lt;&gt;&quot;</span><span class="p">:</span>
                    <span class="c"># Have to convert ampersands and lt/gt to HTML entities</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="n">html_entities</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">rend</span> <span class="o">==</span> <span class="n">prev_rendition</span><span class="p">:</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prev_rendition</span> <span class="o">=</span> <span class="n">rend</span>
                <span class="k">if</span> <span class="n">changed</span> <span class="ow">and</span> <span class="n">rend</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">classes</span> <span class="o">=</span> <span class="n">imap</span><span class="p">(</span><span class="n">rendition_classes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">rend</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_class</span> <span class="ow">and</span> <span class="n">_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_classes</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">spancount</span><span class="p">:</span>
                                <span class="n">outline</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
                                <span class="n">spancount</span> <span class="o">-=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s">&#39;reset&#39;</span> <span class="ow">in</span> <span class="n">_class</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">_class</span> <span class="o">==</span> <span class="s">&#39;reset&#39;</span><span class="p">:</span>
                                    <span class="n">current_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">reset_class</span> <span class="o">=</span> <span class="n">_class</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;reset&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="n">reset_class</span> <span class="o">==</span> <span class="s">&#39;foreground&#39;</span><span class="p">:</span>
                                        <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="n">foregrounds</span>
                                        <span class="p">]</span>
                                    <span class="k">elif</span> <span class="n">reset_class</span> <span class="o">==</span> <span class="s">&#39;background&#39;</span><span class="p">:</span>
                                        <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                        <span class="n">backgrounds</span>
                                        <span class="p">]</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">try</span><span class="p">:</span>
                                            <span class="n">current_classes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reset_class</span><span class="p">)</span>
                                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                            <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">foregrounds</span><span class="p">:</span>
                                    <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="n">foregrounds</span>
                                    <span class="p">]</span>
                                <span class="k">elif</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">backgrounds</span><span class="p">:</span>
                                    <span class="p">[</span><span class="n">current_classes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span>
                                    <span class="n">backgrounds</span>
                                    <span class="p">]</span>
                                <span class="n">current_classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_class</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">current_classes</span><span class="p">:</span>
                        <span class="n">outline</span> <span class="o">+=</span> <span class="s">&#39;&lt;span class=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_classes</span><span class="p">)</span>
                        <span class="n">spancount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">outline</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="k">if</span> <span class="n">outline</span><span class="p">:</span>
                <span class="c"># Make sure all renditions terminate at the end of the line</span>
                <span class="k">for</span> <span class="n">whatever</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">spancount</span><span class="p">):</span>
                    <span class="n">outline</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">whatever</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">spancount</span><span class="p">):</span> <span class="c"># Bit of cleanup to be safe</span>
            <span class="n">results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&quot;&lt;/span&gt;&quot;</span>
        <span class="k">return</span> <span class="n">results</span>
</div>
<div class="viewcode-block" id="Terminal.dump_html"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.dump_html">[docs]</a>    <span class="k">def</span> <span class="nf">dump_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renditions</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dumps the terminal screen as a list of HTML-formatted lines.  If</span>
<span class="sd">        *renditions* is True (default) then terminal renditions will be</span>
<span class="sd">        converted into HTML &lt;span&gt; elements so they will be displayed properly</span>
<span class="sd">        in a browser.  Otherwise only the cursor &lt;span&gt; will be added to mark</span>
<span class="sd">        its location.</span>

<span class="sd">        .. note:: This places &lt;span class=&quot;cursor&quot;&gt;(current character)&lt;/span&gt; around the cursor location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">renditions</span><span class="p">:</span> <span class="c"># i.e. Use stylized text</span>
            <span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spanify_screen</span><span class="p">()</span>
            <span class="n">scrollback</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span><span class="p">:</span>
                <span class="n">scrollback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spanify_scrollback</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursorX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span>
            <span class="n">cursorY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span>
            <span class="n">screen</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">cursorY</span><span class="p">:</span>
                    <span class="n">cursor_row</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">cursorX</span><span class="p">:</span>
                            <span class="n">cursor_row</span> <span class="o">+=</span> <span class="s">&#39;&lt;span class=&quot;cursor&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="n">c</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">cursor_row</span> <span class="o">+=</span> <span class="n">char</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cursor_row</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="c"># Empty the scrollback buffer:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_scrollback</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">scrollback</span><span class="p">,</span> <span class="n">screen</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.dump_plain"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.dump_plain">[docs]</a>    <span class="k">def</span> <span class="nf">dump_plain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dumps the screen and the scrollback buffer as-is then empties the</span>
<span class="sd">        scrollback buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span>
        <span class="n">scrollback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span>
        <span class="c"># Empty the scrollback buffer:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_scrollback</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">scrollback</span><span class="p">,</span> <span class="n">screen</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.dump_components"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.dump_components">[docs]</a>    <span class="k">def</span> <span class="nf">dump_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dumps the screen and renditions as-is, the scrollback buffer as HTML,</span>
<span class="sd">        and the current cursor coordinates.  Also, empties the scrollback buffer</span>

<span class="sd">        .. note:: This was used in some performance-related experiments but might be useful for other patterns in the future so I&#39;ve left it here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">tounicode</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">]</span>
        <span class="n">scrollback</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span><span class="p">:</span>
            <span class="c"># Process the scrollback buffer into HTML</span>
            <span class="n">scrollback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spanify_scrollback</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_buf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrollback_renditions</span><span class="p">)</span>
        <span class="c"># Empty the scrollback buffer:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_scrollback</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">scrollback</span><span class="p">,</span> <span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">renditions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorX</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Terminal.dump"><a class="viewcode-back" href="../Developer/terminal.html#terminal.Terminal.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns self.screen as a list of strings with no formatting.</span>
<span class="sd">        No scrollback buffer.  No renditions.  It is meant to be used to get a</span>
<span class="sd">        quick glance of what is being displayed (when debugging).</span>

<span class="sd">        .. note:: This method does not empty the scrollback buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">:</span>
            <span class="n">line_out</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># This is an image (or similar)</span>
                    <span class="n">line_out</span> <span class="o">+=</span> <span class="s">u&#39;⬚&#39;</span> <span class="c"># Use a dotted square as a placeholder</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line_out</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="c"># This is here to make it easier for someone to produce an HTML app that uses</span>
<span class="c"># terminal.py</span></div></div>
<div class="viewcode-block" id="css_colors"><a class="viewcode-back" href="../Developer/terminal.html#terminal.css_colors">[docs]</a><span class="k">def</span> <span class="nf">css_colors</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a (long) string containing all the CSS styles in order to support</span>
<span class="sd">    color in an HTML terminal using the dump_html() function.  If *selector* is</span>
<span class="sd">    provided, all styles will be prefixed with said selector like so::</span>

<span class="sd">        ${selector} span.f0 { color: #5C5C5C; }</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; css_colors(&quot;#gateone&quot;).splitlines()[1]</span>
<span class="sd">        &#39;#gateone span.f0 { color: #5C5C5C; } /* Black */&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
    <span class="n">colors_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">CSS_COLORS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colors_template</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="n">selector</span><span class="p">)</span>
</div>
<span class="n">CSS_COLORS</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">/* 8-color Foregrounds */</span>
<span class="s">${selector} span.f0 { color: #5C5C5C; } /* Black */</span>
<span class="s">${selector} span.f1 { color: #D6292C; } /* Red */</span>
<span class="s">${selector} span.f2 { color: #13A110; } /* Green */</span>
<span class="s">${selector} span.f3 { color: #E9E900; } /* Yellow */</span>
<span class="s">${selector} span.f4 { color: #1B4CFF; } /* Blue */</span>
<span class="s">${selector} span.f5 { color: #E01DC6; } /* Magenta */</span>
<span class="s">${selector} span.f6 { color: #28AAA8; } /* Cyan */</span>
<span class="s">${selector} span.f7 { color: #eee; } /* White */</span>
<span class="s">/* 8-color Foregrounds on 8-color Backgrounds */</span>
<span class="s">${selector} span.f0.b0 { color: #444; background-color: #000; } /* Black on Black */</span>
<span class="s">${selector} span.f0.b1 { color: #000; background-color: #B21818; } /* Black on Red */</span>
<span class="s">${selector} span.f0.b2 { color: #000; background-color: green; } /* Black on Green */</span>
<span class="s">${selector} span.f0.b3 { color: #000; background-color: #FFFF00; } /* Black on Yellow */</span>
<span class="s">${selector} span.f0.b4 { color: #000; background-color: #1818B2; } /* Black on Blue */</span>
<span class="s">${selector} span.f0.b5 { color: #000; background-color: #B218B2; } /* Black on Magenta */</span>
<span class="s">${selector} span.f0.b6 { color: #000; background-color: #18B2B2; } /* Black on Cyan */</span>
<span class="s">${selector} span.f0.b7 { color: #000; background-color: #B2B2B2; } /* Black on White */</span>
<span class="s">/* 8-color Foregrounds with &#39;bright&#39; (16-color) Backgrounds */</span>
<span class="s">${selector} span.f0.bb0 { color: #444; background-color: #000; } /* Black on Black */</span>
<span class="s">${selector} span.f0.bb1 { color: #000; background-color: #B21818; } /* Black on Bright Red */</span>
<span class="s">${selector} span.f0.bb2 { color: #000; background-color: #00E40C; } /* Black on Bright Green */</span>
<span class="s">${selector} span.f0.bb3 { color: #000; background-color: #FFFF00; } /* Black on Bright Yellow */</span>
<span class="s">${selector} span.f0.bb4 { color: #000; background-color: #1818B2; } /* Black on Bright Blue */</span>
<span class="s">${selector} span.f0.bb5 { color: #000; background-color: #B218B2; } /* Black on Bright Magenta */</span>
<span class="s">${selector} span.f0.bb6 { color: #000; background-color: #18B2B2; } /* Black on Bright Cyan */</span>
<span class="s">${selector} span.f0.bb7 { color: #000; background-color: #B2B2B2; } /* Black on Bright White */</span>
<span class="s">/* 8-color Backgrounds */</span>
<span class="s">${selector} span.b0  { background-color: #000; } /* Black (used when the rendition is set to 49) */</span>
<span class="s">${selector} span.b1  { background-color: #B21818; } /* Red */</span>
<span class="s">${selector} span.b2  { background-color: green; } /* Green */</span>
<span class="s">${selector} span.b3  { background-color: #FFFF00; } /* Yellow */</span>
<span class="s">${selector} span.b4  { background-color: #1818B2; } /* Blue */</span>
<span class="s">${selector} span.b5  { background-color: #B218B2; } /* Magenta */</span>
<span class="s">${selector} span.b6  { background-color: #18B2B2; } /* Cyan */</span>
<span class="s">${selector} span.b7  { background-color: #B2B2B2; } /* White */</span>
<span class="s">/* Reversed Foregrounds */</span>
<span class="s">${selector} span.reverse { color: #000; background-color: #ccc; } /* Black on White (since this is the &quot;Black&quot; CSS) */</span>
<span class="s">${selector} span.reverse.f0 { color: #444; background-color: #000; } /* Black on Black (#444 so you can still read it)*/</span>
<span class="s">${selector} span.reverse.f1 { color: #000; background-color: #D6292C; } /* Red on Black */</span>
<span class="s">${selector} span.reverse.f2 { color: #000; background-color: green; } /* Green on Black */</span>
<span class="s">${selector} span.reverse.f3 { color: #000; background-color: #BDC000; } /* Yellow on Black */</span>
<span class="s">${selector} span.reverse.f4 { color: #000; background-color: #1B4CFF; } /* Blue on Black */</span>
<span class="s">${selector} span.reverse.f5 { color: #000; background-color: #E01DC6; } /* Magenta on Black */</span>
<span class="s">${selector} span.reverse.f6 { color: #000; background-color: #28AAA8; } /* Cyan on Black */</span>
<span class="s">${selector} span.reverse.f7 { color: #000; background-color: #eee; } /* White on Black */</span>
<span class="s">/* 16-color (&#39;Bright&#39;) Foregrounds */</span>
<span class="s">${selector} span.bf0 { color: #5C5C5C; } /* Bright Black!  I never knew thee existed! */</span>
<span class="s">${selector} span.bf1 { color: #D6292C; } /* Bright Red */</span>
<span class="s">${selector} span.bf2 { color: #13A110; } /* Bright Green */</span>
<span class="s">${selector} span.bf3 { color: #E9E900; } /* Bright Yellow */</span>
<span class="s">${selector} span.bf4 { color: #1B4CFF; } /* Bright Blue */</span>
<span class="s">${selector} span.bf5 { color: #E01DC6; } /* Bright Magenta */</span>
<span class="s">${selector} span.bf6 { color: #28AAA8; } /* Bright Cyan */</span>
<span class="s">${selector} span.bf7 { color: #eee; } /* Bright White (use this on dentures) */</span>
<span class="s">${selector} span.bf0.bb1 { color: #000; background-color: #B21818; } /* Bright Black on Bright Red */</span>
<span class="s">${selector} span.bf0.bb2 { color: #000; background-color: #00E40C; } /* Bright Black on Bright Green */</span>
<span class="s">${selector} span.bf0.bb3 { color: #000; background-color: #FFFF00; } /* Bright Black on Bright Yellow */</span>
<span class="s">${selector} span.bf0.bb4 { color: #000; background-color: #1818B2; } /* Bright Black on Bright Blue */</span>
<span class="s">${selector} span.bf0.bb5 { color: #000; background-color: #B218B2; } /* Bright Black on Bright Magenta */</span>
<span class="s">${selector} span.bf0.bb6 { color: #000; background-color: #18B2B2; } /* Bright Black on Bright Cyan */</span>
<span class="s">${selector} span.bf0.bb7 { color: #000; background-color: #B2B2B2; } /* Bright Black on Bright White */</span>
<span class="s">/* 16-color (&#39;Bright&#39;) Backgrounds */</span>
<span class="s">${selector} span.bb0  { background-color: #000; } /* Bright Black */</span>
<span class="s">${selector} span.bb1  { background-color: #B21818; } /* Bright Red */</span>
<span class="s">${selector} span.bb2  { background-color: #00E40C; } /* Bright Green */</span>
<span class="s">${selector} span.bb3  { background-color: #FFFF00; } /* Bright Yellow */</span>
<span class="s">${selector} span.bb4  { background-color: #1818B2; } /* Bright Blue */</span>
<span class="s">${selector} span.bb5  { background-color: #B218B2; } /* Bright Magenta */</span>
<span class="s">${selector} span.bb6  { background-color: #18B2B2; } /* Bright Cyan */</span>
<span class="s">${selector} span.bb7  { background-color: #B2B2B2; } /* Bright White */</span>
<span class="s">/* Reversed Foregrounds */</span>
<span class="s">${selector} span.reverse { color: #000; background-color: #ccc; } /* Black on White */</span>
<span class="s">${selector} span.reverse.bf0 { color: #000; background-color: #ccc; } /* Black */</span>
<span class="s">${selector} span.reverse.bf1 { color: #000; background-color: #D6292C; } /* Red */</span>
<span class="s">${selector} span.reverse.bf2 { color: #000; background-color: #13A110; } /* Green */</span>
<span class="s">${selector} span.reverse.bf3 { color: #000; background-color: #BDC000; } /* Yellow */</span>
<span class="s">${selector} span.reverse.bf4 { color: #000; background-color: #1B4CFF; } /* Blue */</span>
<span class="s">${selector} span.reverse.bf5 { color: #000; background-color: #E01DC6; } /* Magenta */</span>
<span class="s">${selector} span.reverse.bf6 { color: #000; background-color: #28AAA8; } /* Cyan */</span>
<span class="s">${selector} span.reverse.bf7 { color: #000; background-color: #eee; } /* White */</span>
<span class="s">${selector} span.encircle {</span>
<span class="s">    border: .1em;</span>
<span class="s">    border-radius: .7em;</span>
<span class="s">    -moz-border-radius: 1em;</span>
<span class="s">    display: inline-block;</span>
<span class="s">    margin-right: -0.15em; /* Because we scale it down to make the box normal-sized we have to move it to the left slightly to have it line up properly */</span>
<span class="s">    border-color: #BBB;</span>
<span class="s">    border-style: solid;</span>
<span class="s">    /* WebKit */</span>
<span class="s">    -webkit-transition: -webkit-transform 1s ease-in-out;</span>
<span class="s">    -webkit-transform: scale(.9);</span>
<span class="s">    /* Firefox */</span>
<span class="s">    -moz-transition: -moz-transform 1s ease-in-out;</span>
<span class="s">    -moz-transform: scale(.9);</span>
<span class="s">    /* IE9+ */</span>
<span class="s">    -ms-transition: -ms-transform 1s ease-in-out;</span>
<span class="s">    -ms-transform: scale(.9);</span>
<span class="s">    /* Opera */</span>
<span class="s">    -o-transition: -o-transform 1s ease-in-out;</span>
<span class="s">    -o-transform: scale(.9);</span>
<span class="s">    /* Future CSS3 standard */</span>
<span class="s">    transition: transform 1s ease-in-out;</span>
<span class="s">    transform: scale(.9);</span>
<span class="s">}</span>
<span class="s">${selector} span.rightline {</span>
<span class="s">    border-right: .2em;</span>
<span class="s">    border-top: 0;</span>
<span class="s">    border-bottom: 0;</span>
<span class="s">    border-left: 0;</span>
<span class="s">    border-style: solid;</span>
<span class="s">    margin-right: -0.2em;</span>
<span class="s">    display: inline-block;</span>
<span class="s">    /* WebKit */</span>
<span class="s">    -webkit-transition: -webkit-transform 1s ease-in-out;</span>
<span class="s">    -webkit-transform: scale(.9);</span>
<span class="s">    /* Firefox */</span>
<span class="s">    -moz-transition: -moz-transform 1s ease-in-out;</span>
<span class="s">    -moz-transform: scale(.9);</span>
<span class="s">    /* IE9+ */</span>
<span class="s">    -ms-transition: -ms-transform 1s ease-in-out;</span>
<span class="s">    -ms-transform: scale(.9);</span>
<span class="s">    /* Opera */</span>
<span class="s">    -o-transition: -o-transform 1s ease-in-out;</span>
<span class="s">    -o-transform: scale(.9);</span>
<span class="s">    /* Future CSS3 standard */</span>
<span class="s">    transition: transform 1s ease-in-out;</span>
<span class="s">    transform: scale(.9);</span>
<span class="s">}</span>
<span class="s">${selector} span.rightdoubleline {</span>
<span class="s">    border-right: .3em;</span>
<span class="s">    border-top: 0;</span>
<span class="s">    border-bottom: 0;</span>
<span class="s">    border-left: 0;</span>
<span class="s">    border-style: double;</span>
<span class="s">    margin-right: -0.3em;</span>
<span class="s">    display: inline-block;</span>
<span class="s">    /* WebKit */</span>
<span class="s">    -webkit-transition: -webkit-transform 1s ease-in-out;</span>
<span class="s">    -webkit-transform: scale(.9);</span>
<span class="s">    /* Firefox */</span>
<span class="s">    -moz-transition: -moz-transform 1s ease-in-out;</span>
<span class="s">    -moz-transform: scale(.9);</span>
<span class="s">    /* IE9+ */</span>
<span class="s">    -ms-transition: -ms-transform 1s ease-in-out;</span>
<span class="s">    -ms-transform: scale(.9);</span>
<span class="s">    /* Opera */</span>
<span class="s">    -o-transition: -o-transform 1s ease-in-out;</span>
<span class="s">    -o-transform: scale(.9);</span>
<span class="s">    /* Future CSS3 standard */</span>
<span class="s">    transition: transform 1s ease-in-out;</span>
<span class="s">    transform: scale(.9);</span>
<span class="s">}</span>
<span class="s">${selector} span.leftline {</span>
<span class="s">    border-left: .2em;</span>
<span class="s">    border-top: 0;</span>
<span class="s">    border-bottom: 0;</span>
<span class="s">    border-right: 0;</span>
<span class="s">    border-style: solid;</span>
<span class="s">    margin-right: -0.2em;</span>
<span class="s">    display: inline-block;</span>
<span class="s">    /* WebKit */</span>
<span class="s">    -webkit-transition: -webkit-transform 1s ease-in-out;</span>
<span class="s">    -webkit-transform: scale(.9);</span>
<span class="s">    /* Firefox */</span>
<span class="s">    -moz-transition: -moz-transform 1s ease-in-out;</span>
<span class="s">    -moz-transform: scale(.9);</span>
<span class="s">    /* IE9+ */</span>
<span class="s">    -ms-transition: -ms-transform 1s ease-in-out;</span>
<span class="s">    -ms-transform: scale(.9);</span>
<span class="s">    /* Opera */</span>
<span class="s">    -o-transition: -o-transform 1s ease-in-out;</span>
<span class="s">    -o-transform: scale(.9);</span>
<span class="s">    /* Future CSS3 standard */</span>
<span class="s">    transition: transform 1s ease-in-out;</span>
<span class="s">    transform: scale(.9);</span>
<span class="s">}</span>
<span class="s">${selector} span.leftdoubleline {</span>
<span class="s">    border-left: .3em;</span>
<span class="s">    border-top: 0;</span>
<span class="s">    border-bottom: 0;</span>
<span class="s">    border-right: 0;</span>
<span class="s">    border-style: double;</span>
<span class="s">    margin-right: -0.3em;</span>
<span class="s">    display: inline-block;</span>
<span class="s">    /* WebKit */</span>
<span class="s">    -webkit-transition: -webkit-transform 1s ease-in-out;</span>
<span class="s">    -webkit-transform: scale(.9);</span>
<span class="s">    /* Firefox */</span>
<span class="s">    -moz-transition: -moz-transform 1s ease-in-out;</span>
<span class="s">    -moz-transform: scale(.9);</span>
<span class="s">    /* IE9+ */</span>
<span class="s">    -ms-transition: -ms-transform 1s ease-in-out;</span>
<span class="s">    -ms-transform: scale(.9);</span>
<span class="s">    /* Opera */</span>
<span class="s">    -o-transition: -o-transform 1s ease-in-out;</span>
<span class="s">    -o-transform: scale(.9);</span>
<span class="s">    /* Future CSS3 standard */</span>
<span class="s">    transition: transform 1s ease-in-out;</span>
<span class="s">    transform: scale(.9);</span>
<span class="s">}</span>
<span class="s">${selector} span.bold { font-weight: bold; }</span>
<span class="s">${selector} span.dim { opacity: 0.7; }</span>
<span class="s">${selector} span.hidden { color: transparent !important;}</span>
<span class="s">${selector} span.underline { text-decoration: underline; }</span>
<span class="s">${selector} span.overline { text-decoration: overline; }</span>
<span class="s">${selector} span.italic { font-style: italic; }</span>
<span class="s">${selector} span.strike { text-decoration: line-through; }</span>
<span class="s">${selector} span.frame {</span>
<span class="s">    /* An inset shadow emulates a border without making the box bigger */</span>
<span class="s">    -moz-box-shadow: inset 0.1em 0.1em 0.3em #000;</span>
<span class="s">    -webkit-box-shadow: inset 0.1em 0.1em 0.3em #000;</span>
<span class="s">    box-shadow: inset 0.1em 0.1em 0.3em #000;</span>
<span class="s">}</span>
<span class="s">@-webkit-keyframes blinker {</span>
<span class="s">  from { opacity: 1.0; }</span>
<span class="s">  to { opacity: 0.0; }</span>
<span class="s">}</span>
<span class="s">@-moz-keyframes blinker {</span>
<span class="s">  from { opacity: 1.0; }</span>
<span class="s">  to { opacity: 0.0; }</span>
<span class="s">}</span>
<span class="s">@keyframes blinker {</span>
<span class="s">  from { opacity: 1.0; }</span>
<span class="s">  to { opacity: 0.0; }</span>
<span class="s">}</span>
<span class="s">${selector} span.blink {</span>
<span class="s">    -webkit-animation-name: blinker;</span>
<span class="s">    -webkit-animation-iteration-count: infinite;</span>
<span class="s">    -webkit-animation-timing-function: cubic-bezier(1.0,0,0,1.0);</span>
<span class="s">    -webkit-animation-duration: 1s;</span>
<span class="s">    -moz-animation-iteration-count: infinite;</span>
<span class="s">    -moz-animation-name: blinker;</span>
<span class="s">    -moz-animation-duration: 1s;</span>
<span class="s">    -moz-animation-timing-function: cubic-bezier(1.0,0,0,1.0);</span>
<span class="s">    animation-name: blinker;</span>
<span class="s">    animation-iteration-count: infinite;</span>
<span class="s">    animation-timing-function: cubic-bezier(1.0,0,0,1.0);</span>
<span class="s">    animation-duration: 1s;</span>
<span class="s">}</span>
<span class="s">${selector} span.fastblink {</span>
<span class="s">    -webkit-animation-name: blinker;</span>
<span class="s">    -webkit-animation-iteration-count: infinite;</span>
<span class="s">    -webkit-animation-timing-function: cubic-bezier(1.0,0,0,1.0);</span>
<span class="s">    -webkit-animation-duration: 0.5s;</span>
<span class="s">    -moz-animation-iteration-count: infinite;</span>
<span class="s">    -moz-animation-name: blinker;</span>
<span class="s">    -moz-animation-duration: 0.5s;</span>
<span class="s">    -moz-animation-timing-function: cubic-bezier(1.0,0,0,1.0);</span>
<span class="s">    animation-name: blinker;</span>
<span class="s">    animation-iteration-count: infinite;</span>
<span class="s">    animation-timing-function: cubic-bezier(1.0,0,0,1.0);</span>
<span class="s">    animation-duration: 0.5s;</span>
<span class="s">}</span>
<span class="s">${selector} span.fx0 {color: #000000;} ${selector} span.bx0 {background-color: #000000;}  ${selector} span.reverse.fx0 {background-color: #000000; color: inherit;} ${selector} span.reverse.bx0 {color: #000000; background-color: inherit;}</span>
<span class="s">${selector} span.fx1 {color: #800000;} ${selector} span.bx1 {background-color: #800000;}  ${selector} span.reverse.fx1 {background-color: #800000; color: inherit;} ${selector} span.reverse.bx1 {color: #800000; background-color: inherit;}</span>
<span class="s">${selector} span.fx2 {color: #008000;} ${selector} span.bx2 {background-color: #008000;}  ${selector} span.reverse.fx2 {background-color: #008000; color: inherit;} ${selector} span.reverse.bx2 {color: #008000; background-color: inherit;}</span>
<span class="s">${selector} span.fx3 {color: #808000;} ${selector} span.bx3 {background-color: #808000;}  ${selector} span.reverse.fx3 {background-color: #808000; color: inherit;} ${selector} span.reverse.bx3 {color: #808000; background-color: inherit;}</span>
<span class="s">${selector} span.fx4 {color: #000080;} ${selector} span.bx4 {background-color: #000080;}  ${selector} span.reverse.fx4 {background-color: #000080; color: inherit;} ${selector} span.reverse.bx4 {color: #000080; background-color: inherit;}</span>
<span class="s">${selector} span.fx5 {color: #800080;} ${selector} span.bx5 {background-color: #800080;}  ${selector} span.reverse.fx5 {background-color: #800080; color: inherit;} ${selector} span.reverse.bx5 {color: #800080; background-color: inherit;}</span>
<span class="s">${selector} span.fx6 {color: #008080;} ${selector} span.bx6 {background-color: #008080;}  ${selector} span.reverse.fx6 {background-color: #008080; color: inherit;} ${selector} span.reverse.bx6 {color: #008080; background-color: inherit;}</span>
<span class="s">${selector} span.fx7 {color: #c0c0c0;} ${selector} span.bx7 {background-color: #c0c0c0;}  ${selector} span.reverse.fx7 {background-color: #c0c0c0; color: inherit;} ${selector} span.reverse.bx7 {color: #c0c0c0; background-color: inherit;}</span>
<span class="s">${selector} span.fx8 {color: #808080;} ${selector} span.bx8 {background-color: #808080;}  ${selector} span.reverse.fx8 {background-color: #808080; color: inherit;} ${selector} span.reverse.bx8 {color: #808080; background-color: inherit;}</span>
<span class="s">${selector} span.fx9 {color: #ff0000;} ${selector} span.bx9 {background-color: #ff0000;}  ${selector} span.reverse.fx9 {background-color: #ff0000; color: inherit;} ${selector} span.reverse.bx9 {color: #ff0000; background-color: inherit;}</span>
<span class="s">${selector} span.fx10 {color: #00ff00;} ${selector} span.bx10 {background-color: #00ff00;}  ${selector} span.reverse.fx10 {background-color: #00ff00; color: inherit;} ${selector} span.reverse.bx10 {color: #00ff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx11 {color: #ffff00;} ${selector} span.bx11 {background-color: #ffff00;}  ${selector} span.reverse.fx11 {background-color: #ffff00; color: inherit;} ${selector} span.reverse.bx11 {color: #ffff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx12 {color: #0000ff;} ${selector} span.bx12 {background-color: #0000ff;}  ${selector} span.reverse.fx12 {background-color: #0000ff; color: inherit;} ${selector} span.reverse.bx12 {color: #0000ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx13 {color: #ff00ff;} ${selector} span.bx13 {background-color: #ff00ff;}  ${selector} span.reverse.fx13 {background-color: #ff00ff; color: inherit;} ${selector} span.reverse.bx13 {color: #ff00ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx14 {color: #00ffff;} ${selector} span.bx14 {background-color: #00ffff;}  ${selector} span.reverse.fx14 {background-color: #00ffff; color: inherit;} ${selector} span.reverse.bx14 {color: #00ffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx15 {color: #ffffff;} ${selector} span.bx15 {background-color: #ffffff;}  ${selector} span.reverse.fx15 {background-color: #ffffff; color: inherit;} ${selector} span.reverse.bx15 {color: #ffffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx16 {color: #000000;} ${selector} span.bx16 {background-color: #000000;}  ${selector} span.reverse.fx16 {background-color: #000000; color: inherit;} ${selector} span.reverse.bx16 {color: #000000; background-color: inherit;}</span>
<span class="s">${selector} span.fx17 {color: #00005f;} ${selector} span.bx17 {background-color: #00005f;}  ${selector} span.reverse.fx17 {background-color: #00005f; color: inherit;} ${selector} span.reverse.bx17 {color: #00005f; background-color: inherit;}</span>
<span class="s">${selector} span.fx18 {color: #000087;} ${selector} span.bx18 {background-color: #000087;}  ${selector} span.reverse.fx18 {background-color: #000087; color: inherit;} ${selector} span.reverse.bx18 {color: #000087; background-color: inherit;}</span>
<span class="s">${selector} span.fx19 {color: #0000af;} ${selector} span.bx19 {background-color: #0000af;}  ${selector} span.reverse.fx19 {background-color: #0000af; color: inherit;} ${selector} span.reverse.bx19 {color: #0000af; background-color: inherit;}</span>
<span class="s">${selector} span.fx20 {color: #0000d7;} ${selector} span.bx20 {background-color: #0000d7;}  ${selector} span.reverse.fx20 {background-color: #0000d7; color: inherit;} ${selector} span.reverse.bx20 {color: #0000d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx21 {color: #0000ff;} ${selector} span.bx21 {background-color: #0000ff;}  ${selector} span.reverse.fx21 {background-color: #0000ff; color: inherit;} ${selector} span.reverse.bx21 {color: #0000ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx22 {color: #005f00;} ${selector} span.bx22 {background-color: #005f00;}  ${selector} span.reverse.fx22 {background-color: #005f00; color: inherit;} ${selector} span.reverse.bx22 {color: #005f00; background-color: inherit;}</span>
<span class="s">${selector} span.fx23 {color: #005f5f;} ${selector} span.bx23 {background-color: #005f5f;}  ${selector} span.reverse.fx23 {background-color: #005f5f; color: inherit;} ${selector} span.reverse.bx23 {color: #005f5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx24 {color: #005f87;} ${selector} span.bx24 {background-color: #005f87;}  ${selector} span.reverse.fx24 {background-color: #005f87; color: inherit;} ${selector} span.reverse.bx24 {color: #005f87; background-color: inherit;}</span>
<span class="s">${selector} span.fx25 {color: #005faf;} ${selector} span.bx25 {background-color: #005faf;}  ${selector} span.reverse.fx25 {background-color: #005faf; color: inherit;} ${selector} span.reverse.bx25 {color: #005faf; background-color: inherit;}</span>
<span class="s">${selector} span.fx26 {color: #005fd7;} ${selector} span.bx26 {background-color: #005fd7;}  ${selector} span.reverse.fx26 {background-color: #005fd7; color: inherit;} ${selector} span.reverse.bx26 {color: #005fd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx27 {color: #005fff;} ${selector} span.bx27 {background-color: #005fff;}  ${selector} span.reverse.fx27 {background-color: #005fff; color: inherit;} ${selector} span.reverse.bx27 {color: #005fff; background-color: inherit;}</span>
<span class="s">${selector} span.fx28 {color: #008700;} ${selector} span.bx28 {background-color: #008700;}  ${selector} span.reverse.fx28 {background-color: #008700; color: inherit;} ${selector} span.reverse.bx28 {color: #008700; background-color: inherit;}</span>
<span class="s">${selector} span.fx29 {color: #00875f;} ${selector} span.bx29 {background-color: #00875f;}  ${selector} span.reverse.fx29 {background-color: #00875f; color: inherit;} ${selector} span.reverse.bx29 {color: #00875f; background-color: inherit;}</span>
<span class="s">${selector} span.fx30 {color: #008787;} ${selector} span.bx30 {background-color: #008787;}  ${selector} span.reverse.fx30 {background-color: #008787; color: inherit;} ${selector} span.reverse.bx30 {color: #008787; background-color: inherit;}</span>
<span class="s">${selector} span.fx31 {color: #0087af;} ${selector} span.bx31 {background-color: #0087af;}  ${selector} span.reverse.fx31 {background-color: #0087af; color: inherit;} ${selector} span.reverse.bx31 {color: #0087af; background-color: inherit;}</span>
<span class="s">${selector} span.fx32 {color: #0087d7;} ${selector} span.bx32 {background-color: #0087d7;}  ${selector} span.reverse.fx32 {background-color: #0087d7; color: inherit;} ${selector} span.reverse.bx32 {color: #0087d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx33 {color: #0087ff;} ${selector} span.bx33 {background-color: #0087ff;}  ${selector} span.reverse.fx33 {background-color: #0087ff; color: inherit;} ${selector} span.reverse.bx33 {color: #0087ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx34 {color: #00af00;} ${selector} span.bx34 {background-color: #00af00;}  ${selector} span.reverse.fx34 {background-color: #00af00; color: inherit;} ${selector} span.reverse.bx34 {color: #00af00; background-color: inherit;}</span>
<span class="s">${selector} span.fx35 {color: #00af5f;} ${selector} span.bx35 {background-color: #00af5f;}  ${selector} span.reverse.fx35 {background-color: #00af5f; color: inherit;} ${selector} span.reverse.bx35 {color: #00af5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx36 {color: #00af87;} ${selector} span.bx36 {background-color: #00af87;}  ${selector} span.reverse.fx36 {background-color: #00af87; color: inherit;} ${selector} span.reverse.bx36 {color: #00af87; background-color: inherit;}</span>
<span class="s">${selector} span.fx37 {color: #00afaf;} ${selector} span.bx37 {background-color: #00afaf;}  ${selector} span.reverse.fx37 {background-color: #00afaf; color: inherit;} ${selector} span.reverse.bx37 {color: #00afaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx38 {color: #00afd7;} ${selector} span.bx38 {background-color: #00afd7;}  ${selector} span.reverse.fx38 {background-color: #00afd7; color: inherit;} ${selector} span.reverse.bx38 {color: #00afd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx39 {color: #00afff;} ${selector} span.bx39 {background-color: #00afff;}  ${selector} span.reverse.fx39 {background-color: #00afff; color: inherit;} ${selector} span.reverse.bx39 {color: #00afff; background-color: inherit;}</span>
<span class="s">${selector} span.fx40 {color: #00d700;} ${selector} span.bx40 {background-color: #00d700;}  ${selector} span.reverse.fx40 {background-color: #00d700; color: inherit;} ${selector} span.reverse.bx40 {color: #00d700; background-color: inherit;}</span>
<span class="s">${selector} span.fx41 {color: #00d75f;} ${selector} span.bx41 {background-color: #00d75f;}  ${selector} span.reverse.fx41 {background-color: #00d75f; color: inherit;} ${selector} span.reverse.bx41 {color: #00d75f; background-color: inherit;}</span>
<span class="s">${selector} span.fx42 {color: #00d787;} ${selector} span.bx42 {background-color: #00d787;}  ${selector} span.reverse.fx42 {background-color: #00d787; color: inherit;} ${selector} span.reverse.bx42 {color: #00d787; background-color: inherit;}</span>
<span class="s">${selector} span.fx43 {color: #00d7af;} ${selector} span.bx43 {background-color: #00d7af;}  ${selector} span.reverse.fx43 {background-color: #00d7af; color: inherit;} ${selector} span.reverse.bx43 {color: #00d7af; background-color: inherit;}</span>
<span class="s">${selector} span.fx44 {color: #00d7d7;} ${selector} span.bx44 {background-color: #00d7d7;}  ${selector} span.reverse.fx44 {background-color: #00d7d7; color: inherit;} ${selector} span.reverse.bx44 {color: #00d7d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx45 {color: #00d7ff;} ${selector} span.bx45 {background-color: #00d7ff;}  ${selector} span.reverse.fx45 {background-color: #00d7ff; color: inherit;} ${selector} span.reverse.bx45 {color: #00d7ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx46 {color: #00ff00;} ${selector} span.bx46 {background-color: #00ff00;}  ${selector} span.reverse.fx46 {background-color: #00ff00; color: inherit;} ${selector} span.reverse.bx46 {color: #00ff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx47 {color: #00ff5f;} ${selector} span.bx47 {background-color: #00ff5f;}  ${selector} span.reverse.fx47 {background-color: #00ff5f; color: inherit;} ${selector} span.reverse.bx47 {color: #00ff5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx48 {color: #00ff87;} ${selector} span.bx48 {background-color: #00ff87;}  ${selector} span.reverse.fx48 {background-color: #00ff87; color: inherit;} ${selector} span.reverse.bx48 {color: #00ff87; background-color: inherit;}</span>
<span class="s">${selector} span.fx49 {color: #00ffaf;} ${selector} span.bx49 {background-color: #00ffaf;}  ${selector} span.reverse.fx49 {background-color: #00ffaf; color: inherit;} ${selector} span.reverse.bx49 {color: #00ffaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx50 {color: #00ffd7;} ${selector} span.bx50 {background-color: #00ffd7;}  ${selector} span.reverse.fx50 {background-color: #00ffd7; color: inherit;} ${selector} span.reverse.bx50 {color: #00ffd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx51 {color: #00ffff;} ${selector} span.bx51 {background-color: #00ffff;}  ${selector} span.reverse.fx51 {background-color: #00ffff; color: inherit;} ${selector} span.reverse.bx51 {color: #00ffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx52 {color: #5f0000;} ${selector} span.bx52 {background-color: #5f0000;}  ${selector} span.reverse.fx52 {background-color: #5f0000; color: inherit;} ${selector} span.reverse.bx52 {color: #5f0000; background-color: inherit;}</span>
<span class="s">${selector} span.fx53 {color: #5f005f;} ${selector} span.bx53 {background-color: #5f005f;}  ${selector} span.reverse.fx53 {background-color: #5f005f; color: inherit;} ${selector} span.reverse.bx53 {color: #5f005f; background-color: inherit;}</span>
<span class="s">${selector} span.fx54 {color: #5f0087;} ${selector} span.bx54 {background-color: #5f0087;}  ${selector} span.reverse.fx54 {background-color: #5f0087; color: inherit;} ${selector} span.reverse.bx54 {color: #5f0087; background-color: inherit;}</span>
<span class="s">${selector} span.fx55 {color: #5f00af;} ${selector} span.bx55 {background-color: #5f00af;}  ${selector} span.reverse.fx55 {background-color: #5f00af; color: inherit;} ${selector} span.reverse.bx55 {color: #5f00af; background-color: inherit;}</span>
<span class="s">${selector} span.fx56 {color: #5f00d7;} ${selector} span.bx56 {background-color: #5f00d7;}  ${selector} span.reverse.fx56 {background-color: #5f00d7; color: inherit;} ${selector} span.reverse.bx56 {color: #5f00d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx57 {color: #5f00ff;} ${selector} span.bx57 {background-color: #5f00ff;}  ${selector} span.reverse.fx57 {background-color: #5f00ff; color: inherit;} ${selector} span.reverse.bx57 {color: #5f00ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx58 {color: #5f5f00;} ${selector} span.bx58 {background-color: #5f5f00;}  ${selector} span.reverse.fx58 {background-color: #5f5f00; color: inherit;} ${selector} span.reverse.bx58 {color: #5f5f00; background-color: inherit;}</span>
<span class="s">${selector} span.fx59 {color: #5f5f5f;} ${selector} span.bx59 {background-color: #5f5f5f;}  ${selector} span.reverse.fx59 {background-color: #5f5f5f; color: inherit;} ${selector} span.reverse.bx59 {color: #5f5f5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx60 {color: #5f5f87;} ${selector} span.bx60 {background-color: #5f5f87;}  ${selector} span.reverse.fx60 {background-color: #5f5f87; color: inherit;} ${selector} span.reverse.bx60 {color: #5f5f87; background-color: inherit;}</span>
<span class="s">${selector} span.fx61 {color: #5f5faf;} ${selector} span.bx61 {background-color: #5f5faf;}  ${selector} span.reverse.fx61 {background-color: #5f5faf; color: inherit;} ${selector} span.reverse.bx61 {color: #5f5faf; background-color: inherit;}</span>
<span class="s">${selector} span.fx62 {color: #5f5fd7;} ${selector} span.bx62 {background-color: #5f5fd7;}  ${selector} span.reverse.fx62 {background-color: #5f5fd7; color: inherit;} ${selector} span.reverse.bx62 {color: #5f5fd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx63 {color: #5f5fff;} ${selector} span.bx63 {background-color: #5f5fff;}  ${selector} span.reverse.fx63 {background-color: #5f5fff; color: inherit;} ${selector} span.reverse.bx63 {color: #5f5fff; background-color: inherit;}</span>
<span class="s">${selector} span.fx64 {color: #5f8700;} ${selector} span.bx64 {background-color: #5f8700;}  ${selector} span.reverse.fx64 {background-color: #5f8700; color: inherit;} ${selector} span.reverse.bx64 {color: #5f8700; background-color: inherit;}</span>
<span class="s">${selector} span.fx65 {color: #5f875f;} ${selector} span.bx65 {background-color: #5f875f;}  ${selector} span.reverse.fx65 {background-color: #5f875f; color: inherit;} ${selector} span.reverse.bx65 {color: #5f875f; background-color: inherit;}</span>
<span class="s">${selector} span.fx66 {color: #5f8787;} ${selector} span.bx66 {background-color: #5f8787;}  ${selector} span.reverse.fx66 {background-color: #5f8787; color: inherit;} ${selector} span.reverse.bx66 {color: #5f8787; background-color: inherit;}</span>
<span class="s">${selector} span.fx67 {color: #5f87af;} ${selector} span.bx67 {background-color: #5f87af;}  ${selector} span.reverse.fx67 {background-color: #5f87af; color: inherit;} ${selector} span.reverse.bx67 {color: #5f87af; background-color: inherit;}</span>
<span class="s">${selector} span.fx68 {color: #5f87d7;} ${selector} span.bx68 {background-color: #5f87d7;}  ${selector} span.reverse.fx68 {background-color: #5f87d7; color: inherit;} ${selector} span.reverse.bx68 {color: #5f87d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx69 {color: #5f87ff;} ${selector} span.bx69 {background-color: #5f87ff;}  ${selector} span.reverse.fx69 {background-color: #5f87ff; color: inherit;} ${selector} span.reverse.bx69 {color: #5f87ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx70 {color: #5faf00;} ${selector} span.bx70 {background-color: #5faf00;}  ${selector} span.reverse.fx70 {background-color: #5faf00; color: inherit;} ${selector} span.reverse.bx70 {color: #5faf00; background-color: inherit;}</span>
<span class="s">${selector} span.fx71 {color: #5faf5f;} ${selector} span.bx71 {background-color: #5faf5f;}  ${selector} span.reverse.fx71 {background-color: #5faf5f; color: inherit;} ${selector} span.reverse.bx71 {color: #5faf5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx72 {color: #5faf87;} ${selector} span.bx72 {background-color: #5faf87;}  ${selector} span.reverse.fx72 {background-color: #5faf87; color: inherit;} ${selector} span.reverse.bx72 {color: #5faf87; background-color: inherit;}</span>
<span class="s">${selector} span.fx73 {color: #5fafaf;} ${selector} span.bx73 {background-color: #5fafaf;}  ${selector} span.reverse.fx73 {background-color: #5fafaf; color: inherit;} ${selector} span.reverse.bx73 {color: #5fafaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx74 {color: #5fafd7;} ${selector} span.bx74 {background-color: #5fafd7;}  ${selector} span.reverse.fx74 {background-color: #5fafd7; color: inherit;} ${selector} span.reverse.bx74 {color: #5fafd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx75 {color: #5fafff;} ${selector} span.bx75 {background-color: #5fafff;}  ${selector} span.reverse.fx75 {background-color: #5fafff; color: inherit;} ${selector} span.reverse.bx75 {color: #5fafff; background-color: inherit;}</span>
<span class="s">${selector} span.fx76 {color: #5fd700;} ${selector} span.bx76 {background-color: #5fd700;}  ${selector} span.reverse.fx76 {background-color: #5fd700; color: inherit;} ${selector} span.reverse.bx76 {color: #5fd700; background-color: inherit;}</span>
<span class="s">${selector} span.fx77 {color: #5fd75f;} ${selector} span.bx77 {background-color: #5fd75f;}  ${selector} span.reverse.fx77 {background-color: #5fd75f; color: inherit;} ${selector} span.reverse.bx77 {color: #5fd75f; background-color: inherit;}</span>
<span class="s">${selector} span.fx78 {color: #5fd787;} ${selector} span.bx78 {background-color: #5fd787;}  ${selector} span.reverse.fx78 {background-color: #5fd787; color: inherit;} ${selector} span.reverse.bx78 {color: #5fd787; background-color: inherit;}</span>
<span class="s">${selector} span.fx79 {color: #5fd7af;} ${selector} span.bx79 {background-color: #5fd7af;}  ${selector} span.reverse.fx79 {background-color: #5fd7af; color: inherit;} ${selector} span.reverse.bx79 {color: #5fd7af; background-color: inherit;}</span>
<span class="s">${selector} span.fx80 {color: #5fd7d7;} ${selector} span.bx80 {background-color: #5fd7d7;}  ${selector} span.reverse.fx80 {background-color: #5fd7d7; color: inherit;} ${selector} span.reverse.bx80 {color: #5fd7d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx81 {color: #5fd7ff;} ${selector} span.bx81 {background-color: #5fd7ff;}  ${selector} span.reverse.fx81 {background-color: #5fd7ff; color: inherit;} ${selector} span.reverse.bx81 {color: #5fd7ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx82 {color: #5fff00;} ${selector} span.bx82 {background-color: #5fff00;}  ${selector} span.reverse.fx82 {background-color: #5fff00; color: inherit;} ${selector} span.reverse.bx82 {color: #5fff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx83 {color: #5fff5f;} ${selector} span.bx83 {background-color: #5fff5f;}  ${selector} span.reverse.fx83 {background-color: #5fff5f; color: inherit;} ${selector} span.reverse.bx83 {color: #5fff5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx84 {color: #5fff87;} ${selector} span.bx84 {background-color: #5fff87;}  ${selector} span.reverse.fx84 {background-color: #5fff87; color: inherit;} ${selector} span.reverse.bx84 {color: #5fff87; background-color: inherit;}</span>
<span class="s">${selector} span.fx85 {color: #5fffaf;} ${selector} span.bx85 {background-color: #5fffaf;}  ${selector} span.reverse.fx85 {background-color: #5fffaf; color: inherit;} ${selector} span.reverse.bx85 {color: #5fffaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx86 {color: #5fffd7;} ${selector} span.bx86 {background-color: #5fffd7;}  ${selector} span.reverse.fx86 {background-color: #5fffd7; color: inherit;} ${selector} span.reverse.bx86 {color: #5fffd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx87 {color: #5fffff;} ${selector} span.bx87 {background-color: #5fffff;}  ${selector} span.reverse.fx87 {background-color: #5fffff; color: inherit;} ${selector} span.reverse.bx87 {color: #5fffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx88 {color: #870000;} ${selector} span.bx88 {background-color: #870000;}  ${selector} span.reverse.fx88 {background-color: #870000; color: inherit;} ${selector} span.reverse.bx88 {color: #870000; background-color: inherit;}</span>
<span class="s">${selector} span.fx89 {color: #87005f;} ${selector} span.bx89 {background-color: #87005f;}  ${selector} span.reverse.fx89 {background-color: #87005f; color: inherit;} ${selector} span.reverse.bx89 {color: #87005f; background-color: inherit;}</span>
<span class="s">${selector} span.fx90 {color: #870087;} ${selector} span.bx90 {background-color: #870087;}  ${selector} span.reverse.fx90 {background-color: #870087; color: inherit;} ${selector} span.reverse.bx90 {color: #870087; background-color: inherit;}</span>
<span class="s">${selector} span.fx91 {color: #8700af;} ${selector} span.bx91 {background-color: #8700af;}  ${selector} span.reverse.fx91 {background-color: #8700af; color: inherit;} ${selector} span.reverse.bx91 {color: #8700af; background-color: inherit;}</span>
<span class="s">${selector} span.fx92 {color: #8700d7;} ${selector} span.bx92 {background-color: #8700d7;}  ${selector} span.reverse.fx92 {background-color: #8700d7; color: inherit;} ${selector} span.reverse.bx92 {color: #8700d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx93 {color: #8700ff;} ${selector} span.bx93 {background-color: #8700ff;}  ${selector} span.reverse.fx93 {background-color: #8700ff; color: inherit;} ${selector} span.reverse.bx93 {color: #8700ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx94 {color: #875f00;} ${selector} span.bx94 {background-color: #875f00;}  ${selector} span.reverse.fx94 {background-color: #875f00; color: inherit;} ${selector} span.reverse.bx94 {color: #875f00; background-color: inherit;}</span>
<span class="s">${selector} span.fx95 {color: #875f5f;} ${selector} span.bx95 {background-color: #875f5f;}  ${selector} span.reverse.fx95 {background-color: #875f5f; color: inherit;} ${selector} span.reverse.bx95 {color: #875f5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx96 {color: #875f87;} ${selector} span.bx96 {background-color: #875f87;}  ${selector} span.reverse.fx96 {background-color: #875f87; color: inherit;} ${selector} span.reverse.bx96 {color: #875f87; background-color: inherit;}</span>
<span class="s">${selector} span.fx97 {color: #875faf;} ${selector} span.bx97 {background-color: #875faf;}  ${selector} span.reverse.fx97 {background-color: #875faf; color: inherit;} ${selector} span.reverse.bx97 {color: #875faf; background-color: inherit;}</span>
<span class="s">${selector} span.fx98 {color: #875fd7;} ${selector} span.bx98 {background-color: #875fd7;}  ${selector} span.reverse.fx98 {background-color: #875fd7; color: inherit;} ${selector} span.reverse.bx98 {color: #875fd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx99 {color: #875fff;} ${selector} span.bx99 {background-color: #875fff;}  ${selector} span.reverse.fx99 {background-color: #875fff; color: inherit;} ${selector} span.reverse.bx99 {color: #875fff; background-color: inherit;}</span>
<span class="s">${selector} span.fx100 {color: #878700;} ${selector} span.bx100 {background-color: #878700;}  ${selector} span.reverse.fx100 {background-color: #878700; color: inherit;} ${selector} span.reverse.bx100 {color: #878700; background-color: inherit;}</span>
<span class="s">${selector} span.fx101 {color: #87875f;} ${selector} span.bx101 {background-color: #87875f;}  ${selector} span.reverse.fx101 {background-color: #87875f; color: inherit;} ${selector} span.reverse.bx101 {color: #87875f; background-color: inherit;}</span>
<span class="s">${selector} span.fx102 {color: #878787;} ${selector} span.bx102 {background-color: #878787;}  ${selector} span.reverse.fx102 {background-color: #878787; color: inherit;} ${selector} span.reverse.bx102 {color: #878787; background-color: inherit;}</span>
<span class="s">${selector} span.fx103 {color: #8787af;} ${selector} span.bx103 {background-color: #8787af;}  ${selector} span.reverse.fx103 {background-color: #8787af; color: inherit;} ${selector} span.reverse.bx103 {color: #8787af; background-color: inherit;}</span>
<span class="s">${selector} span.fx104 {color: #8787d7;} ${selector} span.bx104 {background-color: #8787d7;}  ${selector} span.reverse.fx104 {background-color: #8787d7; color: inherit;} ${selector} span.reverse.bx104 {color: #8787d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx105 {color: #8787ff;} ${selector} span.bx105 {background-color: #8787ff;}  ${selector} span.reverse.fx105 {background-color: #8787ff; color: inherit;} ${selector} span.reverse.bx105 {color: #8787ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx106 {color: #87af00;} ${selector} span.bx106 {background-color: #87af00;}  ${selector} span.reverse.fx106 {background-color: #87af00; color: inherit;} ${selector} span.reverse.bx106 {color: #87af00; background-color: inherit;}</span>
<span class="s">${selector} span.fx107 {color: #87af5f;} ${selector} span.bx107 {background-color: #87af5f;}  ${selector} span.reverse.fx107 {background-color: #87af5f; color: inherit;} ${selector} span.reverse.bx107 {color: #87af5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx108 {color: #87af87;} ${selector} span.bx108 {background-color: #87af87;}  ${selector} span.reverse.fx108 {background-color: #87af87; color: inherit;} ${selector} span.reverse.bx108 {color: #87af87; background-color: inherit;}</span>
<span class="s">${selector} span.fx109 {color: #87afaf;} ${selector} span.bx109 {background-color: #87afaf;}  ${selector} span.reverse.fx109 {background-color: #87afaf; color: inherit;} ${selector} span.reverse.bx109 {color: #87afaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx110 {color: #87afd7;} ${selector} span.bx110 {background-color: #87afd7;}  ${selector} span.reverse.fx110 {background-color: #87afd7; color: inherit;} ${selector} span.reverse.bx110 {color: #87afd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx111 {color: #87afff;} ${selector} span.bx111 {background-color: #87afff;}  ${selector} span.reverse.fx111 {background-color: #87afff; color: inherit;} ${selector} span.reverse.bx111 {color: #87afff; background-color: inherit;}</span>
<span class="s">${selector} span.fx112 {color: #87d700;} ${selector} span.bx112 {background-color: #87d700;}  ${selector} span.reverse.fx112 {background-color: #87d700; color: inherit;} ${selector} span.reverse.bx112 {color: #87d700; background-color: inherit;}</span>
<span class="s">${selector} span.fx113 {color: #87d75f;} ${selector} span.bx113 {background-color: #87d75f;}  ${selector} span.reverse.fx113 {background-color: #87d75f; color: inherit;} ${selector} span.reverse.bx113 {color: #87d75f; background-color: inherit;}</span>
<span class="s">${selector} span.fx114 {color: #87d787;} ${selector} span.bx114 {background-color: #87d787;}  ${selector} span.reverse.fx114 {background-color: #87d787; color: inherit;} ${selector} span.reverse.bx114 {color: #87d787; background-color: inherit;}</span>
<span class="s">${selector} span.fx115 {color: #87d7af;} ${selector} span.bx115 {background-color: #87d7af;}  ${selector} span.reverse.fx115 {background-color: #87d7af; color: inherit;} ${selector} span.reverse.bx115 {color: #87d7af; background-color: inherit;}</span>
<span class="s">${selector} span.fx116 {color: #87d7d7;} ${selector} span.bx116 {background-color: #87d7d7;}  ${selector} span.reverse.fx116 {background-color: #87d7d7; color: inherit;} ${selector} span.reverse.bx116 {color: #87d7d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx117 {color: #87d7ff;} ${selector} span.bx117 {background-color: #87d7ff;}  ${selector} span.reverse.fx117 {background-color: #87d7ff; color: inherit;} ${selector} span.reverse.bx117 {color: #87d7ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx118 {color: #87ff00;} ${selector} span.bx118 {background-color: #87ff00;}  ${selector} span.reverse.fx118 {background-color: #87ff00; color: inherit;} ${selector} span.reverse.bx118 {color: #87ff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx119 {color: #87ff5f;} ${selector} span.bx119 {background-color: #87ff5f;}  ${selector} span.reverse.fx119 {background-color: #87ff5f; color: inherit;} ${selector} span.reverse.bx119 {color: #87ff5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx120 {color: #87ff87;} ${selector} span.bx120 {background-color: #87ff87;}  ${selector} span.reverse.fx120 {background-color: #87ff87; color: inherit;} ${selector} span.reverse.bx120 {color: #87ff87; background-color: inherit;}</span>
<span class="s">${selector} span.fx121 {color: #87ffaf;} ${selector} span.bx121 {background-color: #87ffaf;}  ${selector} span.reverse.fx121 {background-color: #87ffaf; color: inherit;} ${selector} span.reverse.bx121 {color: #87ffaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx122 {color: #87ffd7;} ${selector} span.bx122 {background-color: #87ffd7;}  ${selector} span.reverse.fx122 {background-color: #87ffd7; color: inherit;} ${selector} span.reverse.bx122 {color: #87ffd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx123 {color: #87ffff;} ${selector} span.bx123 {background-color: #87ffff;}  ${selector} span.reverse.fx123 {background-color: #87ffff; color: inherit;} ${selector} span.reverse.bx123 {color: #87ffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx124 {color: #af0000;} ${selector} span.bx124 {background-color: #af0000;}  ${selector} span.reverse.fx124 {background-color: #af0000; color: inherit;} ${selector} span.reverse.bx124 {color: #af0000; background-color: inherit;}</span>
<span class="s">${selector} span.fx125 {color: #af005f;} ${selector} span.bx125 {background-color: #af005f;}  ${selector} span.reverse.fx125 {background-color: #af005f; color: inherit;} ${selector} span.reverse.bx125 {color: #af005f; background-color: inherit;}</span>
<span class="s">${selector} span.fx126 {color: #af0087;} ${selector} span.bx126 {background-color: #af0087;}  ${selector} span.reverse.fx126 {background-color: #af0087; color: inherit;} ${selector} span.reverse.bx126 {color: #af0087; background-color: inherit;}</span>
<span class="s">${selector} span.fx127 {color: #af00af;} ${selector} span.bx127 {background-color: #af00af;}  ${selector} span.reverse.fx127 {background-color: #af00af; color: inherit;} ${selector} span.reverse.bx127 {color: #af00af; background-color: inherit;}</span>
<span class="s">${selector} span.fx128 {color: #af00d7;} ${selector} span.bx128 {background-color: #af00d7;}  ${selector} span.reverse.fx128 {background-color: #af00d7; color: inherit;} ${selector} span.reverse.bx128 {color: #af00d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx129 {color: #af00ff;} ${selector} span.bx129 {background-color: #af00ff;}  ${selector} span.reverse.fx129 {background-color: #af00ff; color: inherit;} ${selector} span.reverse.bx129 {color: #af00ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx130 {color: #af5f00;} ${selector} span.bx130 {background-color: #af5f00;}  ${selector} span.reverse.fx130 {background-color: #af5f00; color: inherit;} ${selector} span.reverse.bx130 {color: #af5f00; background-color: inherit;}</span>
<span class="s">${selector} span.fx131 {color: #af5f5f;} ${selector} span.bx131 {background-color: #af5f5f;}  ${selector} span.reverse.fx131 {background-color: #af5f5f; color: inherit;} ${selector} span.reverse.bx131 {color: #af5f5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx132 {color: #af5f87;} ${selector} span.bx132 {background-color: #af5f87;}  ${selector} span.reverse.fx132 {background-color: #af5f87; color: inherit;} ${selector} span.reverse.bx132 {color: #af5f87; background-color: inherit;}</span>
<span class="s">${selector} span.fx133 {color: #af5faf;} ${selector} span.bx133 {background-color: #af5faf;}  ${selector} span.reverse.fx133 {background-color: #af5faf; color: inherit;} ${selector} span.reverse.bx133 {color: #af5faf; background-color: inherit;}</span>
<span class="s">${selector} span.fx134 {color: #af5fd7;} ${selector} span.bx134 {background-color: #af5fd7;}  ${selector} span.reverse.fx134 {background-color: #af5fd7; color: inherit;} ${selector} span.reverse.bx134 {color: #af5fd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx135 {color: #af5fff;} ${selector} span.bx135 {background-color: #af5fff;}  ${selector} span.reverse.fx135 {background-color: #af5fff; color: inherit;} ${selector} span.reverse.bx135 {color: #af5fff; background-color: inherit;}</span>
<span class="s">${selector} span.fx136 {color: #af8700;} ${selector} span.bx136 {background-color: #af8700;}  ${selector} span.reverse.fx136 {background-color: #af8700; color: inherit;} ${selector} span.reverse.bx136 {color: #af8700; background-color: inherit;}</span>
<span class="s">${selector} span.fx137 {color: #af875f;} ${selector} span.bx137 {background-color: #af875f;}  ${selector} span.reverse.fx137 {background-color: #af875f; color: inherit;} ${selector} span.reverse.bx137 {color: #af875f; background-color: inherit;}</span>
<span class="s">${selector} span.fx138 {color: #af8787;} ${selector} span.bx138 {background-color: #af8787;}  ${selector} span.reverse.fx138 {background-color: #af8787; color: inherit;} ${selector} span.reverse.bx138 {color: #af8787; background-color: inherit;}</span>
<span class="s">${selector} span.fx139 {color: #af87af;} ${selector} span.bx139 {background-color: #af87af;}  ${selector} span.reverse.fx139 {background-color: #af87af; color: inherit;} ${selector} span.reverse.bx139 {color: #af87af; background-color: inherit;}</span>
<span class="s">${selector} span.fx140 {color: #af87d7;} ${selector} span.bx140 {background-color: #af87d7;}  ${selector} span.reverse.fx140 {background-color: #af87d7; color: inherit;} ${selector} span.reverse.bx140 {color: #af87d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx141 {color: #af87ff;} ${selector} span.bx141 {background-color: #af87ff;}  ${selector} span.reverse.fx141 {background-color: #af87ff; color: inherit;} ${selector} span.reverse.bx141 {color: #af87ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx142 {color: #afaf00;} ${selector} span.bx142 {background-color: #afaf00;}  ${selector} span.reverse.fx142 {background-color: #afaf00; color: inherit;} ${selector} span.reverse.bx142 {color: #afaf00; background-color: inherit;}</span>
<span class="s">${selector} span.fx143 {color: #afaf5f;} ${selector} span.bx143 {background-color: #afaf5f;}  ${selector} span.reverse.fx143 {background-color: #afaf5f; color: inherit;} ${selector} span.reverse.bx143 {color: #afaf5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx144 {color: #afaf87;} ${selector} span.bx144 {background-color: #afaf87;}  ${selector} span.reverse.fx144 {background-color: #afaf87; color: inherit;} ${selector} span.reverse.bx144 {color: #afaf87; background-color: inherit;}</span>
<span class="s">${selector} span.fx145 {color: #afafaf;} ${selector} span.bx145 {background-color: #afafaf;}  ${selector} span.reverse.fx145 {background-color: #afafaf; color: inherit;} ${selector} span.reverse.bx145 {color: #afafaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx146 {color: #afafd7;} ${selector} span.bx146 {background-color: #afafd7;}  ${selector} span.reverse.fx146 {background-color: #afafd7; color: inherit;} ${selector} span.reverse.bx146 {color: #afafd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx147 {color: #afafff;} ${selector} span.bx147 {background-color: #afafff;}  ${selector} span.reverse.fx147 {background-color: #afafff; color: inherit;} ${selector} span.reverse.bx147 {color: #afafff; background-color: inherit;}</span>
<span class="s">${selector} span.fx148 {color: #afd700;} ${selector} span.bx148 {background-color: #afd700;}  ${selector} span.reverse.fx148 {background-color: #afd700; color: inherit;} ${selector} span.reverse.bx148 {color: #afd700; background-color: inherit;}</span>
<span class="s">${selector} span.fx149 {color: #afd75f;} ${selector} span.bx149 {background-color: #afd75f;}  ${selector} span.reverse.fx149 {background-color: #afd75f; color: inherit;} ${selector} span.reverse.bx149 {color: #afd75f; background-color: inherit;}</span>
<span class="s">${selector} span.fx150 {color: #afd787;} ${selector} span.bx150 {background-color: #afd787;}  ${selector} span.reverse.fx150 {background-color: #afd787; color: inherit;} ${selector} span.reverse.bx150 {color: #afd787; background-color: inherit;}</span>
<span class="s">${selector} span.fx151 {color: #afd7af;} ${selector} span.bx151 {background-color: #afd7af;}  ${selector} span.reverse.fx151 {background-color: #afd7af; color: inherit;} ${selector} span.reverse.bx151 {color: #afd7af; background-color: inherit;}</span>
<span class="s">${selector} span.fx152 {color: #afd7d7;} ${selector} span.bx152 {background-color: #afd7d7;}  ${selector} span.reverse.fx152 {background-color: #afd7d7; color: inherit;} ${selector} span.reverse.bx152 {color: #afd7d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx153 {color: #afd7ff;} ${selector} span.bx153 {background-color: #afd7ff;}  ${selector} span.reverse.fx153 {background-color: #afd7ff; color: inherit;} ${selector} span.reverse.bx153 {color: #afd7ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx154 {color: #afff00;} ${selector} span.bx154 {background-color: #afff00;}  ${selector} span.reverse.fx154 {background-color: #afff00; color: inherit;} ${selector} span.reverse.bx154 {color: #afff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx155 {color: #afff5f;} ${selector} span.bx155 {background-color: #afff5f;}  ${selector} span.reverse.fx155 {background-color: #afff5f; color: inherit;} ${selector} span.reverse.bx155 {color: #afff5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx156 {color: #afff87;} ${selector} span.bx156 {background-color: #afff87;}  ${selector} span.reverse.fx156 {background-color: #afff87; color: inherit;} ${selector} span.reverse.bx156 {color: #afff87; background-color: inherit;}</span>
<span class="s">${selector} span.fx157 {color: #afffaf;} ${selector} span.bx157 {background-color: #afffaf;}  ${selector} span.reverse.fx157 {background-color: #afffaf; color: inherit;} ${selector} span.reverse.bx157 {color: #afffaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx158 {color: #afffd7;} ${selector} span.bx158 {background-color: #afffd7;}  ${selector} span.reverse.fx158 {background-color: #afffd7; color: inherit;} ${selector} span.reverse.bx158 {color: #afffd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx159 {color: #afffff;} ${selector} span.bx159 {background-color: #afffff;}  ${selector} span.reverse.fx159 {background-color: #afffff; color: inherit;} ${selector} span.reverse.bx159 {color: #afffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx160 {color: #d70000;} ${selector} span.bx160 {background-color: #d70000;}  ${selector} span.reverse.fx160 {background-color: #d70000; color: inherit;} ${selector} span.reverse.bx160 {color: #d70000; background-color: inherit;}</span>
<span class="s">${selector} span.fx161 {color: #d7005f;} ${selector} span.bx161 {background-color: #d7005f;}  ${selector} span.reverse.fx161 {background-color: #d7005f; color: inherit;} ${selector} span.reverse.bx161 {color: #d7005f; background-color: inherit;}</span>
<span class="s">${selector} span.fx162 {color: #d70087;} ${selector} span.bx162 {background-color: #d70087;}  ${selector} span.reverse.fx162 {background-color: #d70087; color: inherit;} ${selector} span.reverse.bx162 {color: #d70087; background-color: inherit;}</span>
<span class="s">${selector} span.fx163 {color: #d700af;} ${selector} span.bx163 {background-color: #d700af;}  ${selector} span.reverse.fx163 {background-color: #d700af; color: inherit;} ${selector} span.reverse.bx163 {color: #d700af; background-color: inherit;}</span>
<span class="s">${selector} span.fx164 {color: #d700d7;} ${selector} span.bx164 {background-color: #d700d7;}  ${selector} span.reverse.fx164 {background-color: #d700d7; color: inherit;} ${selector} span.reverse.bx164 {color: #d700d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx165 {color: #d700ff;} ${selector} span.bx165 {background-color: #d700ff;}  ${selector} span.reverse.fx165 {background-color: #d700ff; color: inherit;} ${selector} span.reverse.bx165 {color: #d700ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx166 {color: #d75f00;} ${selector} span.bx166 {background-color: #d75f00;}  ${selector} span.reverse.fx166 {background-color: #d75f00; color: inherit;} ${selector} span.reverse.bx166 {color: #d75f00; background-color: inherit;}</span>
<span class="s">${selector} span.fx167 {color: #d75f5f;} ${selector} span.bx167 {background-color: #d75f5f;}  ${selector} span.reverse.fx167 {background-color: #d75f5f; color: inherit;} ${selector} span.reverse.bx167 {color: #d75f5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx168 {color: #d75f87;} ${selector} span.bx168 {background-color: #d75f87;}  ${selector} span.reverse.fx168 {background-color: #d75f87; color: inherit;} ${selector} span.reverse.bx168 {color: #d75f87; background-color: inherit;}</span>
<span class="s">${selector} span.fx169 {color: #d75faf;} ${selector} span.bx169 {background-color: #d75faf;}  ${selector} span.reverse.fx169 {background-color: #d75faf; color: inherit;} ${selector} span.reverse.bx169 {color: #d75faf; background-color: inherit;}</span>
<span class="s">${selector} span.fx170 {color: #d75fd7;} ${selector} span.bx170 {background-color: #d75fd7;}  ${selector} span.reverse.fx170 {background-color: #d75fd7; color: inherit;} ${selector} span.reverse.bx170 {color: #d75fd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx171 {color: #d75fff;} ${selector} span.bx171 {background-color: #d75fff;}  ${selector} span.reverse.fx171 {background-color: #d75fff; color: inherit;} ${selector} span.reverse.bx171 {color: #d75fff; background-color: inherit;}</span>
<span class="s">${selector} span.fx172 {color: #d78700;} ${selector} span.bx172 {background-color: #d78700;}  ${selector} span.reverse.fx172 {background-color: #d78700; color: inherit;} ${selector} span.reverse.bx172 {color: #d78700; background-color: inherit;}</span>
<span class="s">${selector} span.fx173 {color: #d7875f;} ${selector} span.bx173 {background-color: #d7875f;}  ${selector} span.reverse.fx173 {background-color: #d7875f; color: inherit;} ${selector} span.reverse.bx173 {color: #d7875f; background-color: inherit;}</span>
<span class="s">${selector} span.fx174 {color: #d78787;} ${selector} span.bx174 {background-color: #d78787;}  ${selector} span.reverse.fx174 {background-color: #d78787; color: inherit;} ${selector} span.reverse.bx174 {color: #d78787; background-color: inherit;}</span>
<span class="s">${selector} span.fx175 {color: #d787af;} ${selector} span.bx175 {background-color: #d787af;}  ${selector} span.reverse.fx175 {background-color: #d787af; color: inherit;} ${selector} span.reverse.bx175 {color: #d787af; background-color: inherit;}</span>
<span class="s">${selector} span.fx176 {color: #d787d7;} ${selector} span.bx176 {background-color: #d787d7;}  ${selector} span.reverse.fx176 {background-color: #d787d7; color: inherit;} ${selector} span.reverse.bx176 {color: #d787d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx177 {color: #d787ff;} ${selector} span.bx177 {background-color: #d787ff;}  ${selector} span.reverse.fx177 {background-color: #d787ff; color: inherit;} ${selector} span.reverse.bx177 {color: #d787ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx178 {color: #d7af00;} ${selector} span.bx178 {background-color: #d7af00;}  ${selector} span.reverse.fx178 {background-color: #d7af00; color: inherit;} ${selector} span.reverse.bx178 {color: #d7af00; background-color: inherit;}</span>
<span class="s">${selector} span.fx179 {color: #d7af5f;} ${selector} span.bx179 {background-color: #d7af5f;}  ${selector} span.reverse.fx179 {background-color: #d7af5f; color: inherit;} ${selector} span.reverse.bx179 {color: #d7af5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx180 {color: #d7af87;} ${selector} span.bx180 {background-color: #d7af87;}  ${selector} span.reverse.fx180 {background-color: #d7af87; color: inherit;} ${selector} span.reverse.bx180 {color: #d7af87; background-color: inherit;}</span>
<span class="s">${selector} span.fx181 {color: #d7afaf;} ${selector} span.bx181 {background-color: #d7afaf;}  ${selector} span.reverse.fx181 {background-color: #d7afaf; color: inherit;} ${selector} span.reverse.bx181 {color: #d7afaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx182 {color: #d7afd7;} ${selector} span.bx182 {background-color: #d7afd7;}  ${selector} span.reverse.fx182 {background-color: #d7afd7; color: inherit;} ${selector} span.reverse.bx182 {color: #d7afd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx183 {color: #d7afff;} ${selector} span.bx183 {background-color: #d7afff;}  ${selector} span.reverse.fx183 {background-color: #d7afff; color: inherit;} ${selector} span.reverse.bx183 {color: #d7afff; background-color: inherit;}</span>
<span class="s">${selector} span.fx184 {color: #d7d700;} ${selector} span.bx184 {background-color: #d7d700;}  ${selector} span.reverse.fx184 {background-color: #d7d700; color: inherit;} ${selector} span.reverse.bx184 {color: #d7d700; background-color: inherit;}</span>
<span class="s">${selector} span.fx185 {color: #d7d75f;} ${selector} span.bx185 {background-color: #d7d75f;}  ${selector} span.reverse.fx185 {background-color: #d7d75f; color: inherit;} ${selector} span.reverse.bx185 {color: #d7d75f; background-color: inherit;}</span>
<span class="s">${selector} span.fx186 {color: #d7d787;} ${selector} span.bx186 {background-color: #d7d787;}  ${selector} span.reverse.fx186 {background-color: #d7d787; color: inherit;} ${selector} span.reverse.bx186 {color: #d7d787; background-color: inherit;}</span>
<span class="s">${selector} span.fx187 {color: #d7d7af;} ${selector} span.bx187 {background-color: #d7d7af;}  ${selector} span.reverse.fx187 {background-color: #d7d7af; color: inherit;} ${selector} span.reverse.bx187 {color: #d7d7af; background-color: inherit;}</span>
<span class="s">${selector} span.fx188 {color: #d7d7d7;} ${selector} span.bx188 {background-color: #d7d7d7;}  ${selector} span.reverse.fx188 {background-color: #d7d7d7; color: inherit;} ${selector} span.reverse.bx188 {color: #d7d7d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx189 {color: #d7d7ff;} ${selector} span.bx189 {background-color: #d7d7ff;}  ${selector} span.reverse.fx189 {background-color: #d7d7ff; color: inherit;} ${selector} span.reverse.bx189 {color: #d7d7ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx190 {color: #d7ff00;} ${selector} span.bx190 {background-color: #d7ff00;}  ${selector} span.reverse.fx190 {background-color: #d7ff00; color: inherit;} ${selector} span.reverse.bx190 {color: #d7ff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx191 {color: #d7ff5f;} ${selector} span.bx191 {background-color: #d7ff5f;}  ${selector} span.reverse.fx191 {background-color: #d7ff5f; color: inherit;} ${selector} span.reverse.bx191 {color: #d7ff5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx192 {color: #d7ff87;} ${selector} span.bx192 {background-color: #d7ff87;}  ${selector} span.reverse.fx192 {background-color: #d7ff87; color: inherit;} ${selector} span.reverse.bx192 {color: #d7ff87; background-color: inherit;}</span>
<span class="s">${selector} span.fx193 {color: #d7ffaf;} ${selector} span.bx193 {background-color: #d7ffaf;}  ${selector} span.reverse.fx193 {background-color: #d7ffaf; color: inherit;} ${selector} span.reverse.bx193 {color: #d7ffaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx194 {color: #d7ffd7;} ${selector} span.bx194 {background-color: #d7ffd7;}  ${selector} span.reverse.fx194 {background-color: #d7ffd7; color: inherit;} ${selector} span.reverse.bx194 {color: #d7ffd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx195 {color: #d7ffff;} ${selector} span.bx195 {background-color: #d7ffff;}  ${selector} span.reverse.fx195 {background-color: #d7ffff; color: inherit;} ${selector} span.reverse.bx195 {color: #d7ffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx196 {color: #ff0000;} ${selector} span.bx196 {background-color: #ff0000;}  ${selector} span.reverse.fx196 {background-color: #ff0000; color: inherit;} ${selector} span.reverse.bx196 {color: #ff0000; background-color: inherit;}</span>
<span class="s">${selector} span.fx197 {color: #ff005f;} ${selector} span.bx197 {background-color: #ff005f;}  ${selector} span.reverse.fx197 {background-color: #ff005f; color: inherit;} ${selector} span.reverse.bx197 {color: #ff005f; background-color: inherit;}</span>
<span class="s">${selector} span.fx198 {color: #ff0087;} ${selector} span.bx198 {background-color: #ff0087;}  ${selector} span.reverse.fx198 {background-color: #ff0087; color: inherit;} ${selector} span.reverse.bx198 {color: #ff0087; background-color: inherit;}</span>
<span class="s">${selector} span.fx199 {color: #ff00af;} ${selector} span.bx199 {background-color: #ff00af;}  ${selector} span.reverse.fx199 {background-color: #ff00af; color: inherit;} ${selector} span.reverse.bx199 {color: #ff00af; background-color: inherit;}</span>
<span class="s">${selector} span.fx200 {color: #ff00d7;} ${selector} span.bx200 {background-color: #ff00d7;}  ${selector} span.reverse.fx200 {background-color: #ff00d7; color: inherit;} ${selector} span.reverse.bx200 {color: #ff00d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx201 {color: #ff00ff;} ${selector} span.bx201 {background-color: #ff00ff;}  ${selector} span.reverse.fx201 {background-color: #ff00ff; color: inherit;} ${selector} span.reverse.bx201 {color: #ff00ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx202 {color: #ff5f00;} ${selector} span.bx202 {background-color: #ff5f00;}  ${selector} span.reverse.fx202 {background-color: #ff5f00; color: inherit;} ${selector} span.reverse.bx202 {color: #ff5f00; background-color: inherit;}</span>
<span class="s">${selector} span.fx203 {color: #ff5f5f;} ${selector} span.bx203 {background-color: #ff5f5f;}  ${selector} span.reverse.fx203 {background-color: #ff5f5f; color: inherit;} ${selector} span.reverse.bx203 {color: #ff5f5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx204 {color: #ff5f87;} ${selector} span.bx204 {background-color: #ff5f87;}  ${selector} span.reverse.fx204 {background-color: #ff5f87; color: inherit;} ${selector} span.reverse.bx204 {color: #ff5f87; background-color: inherit;}</span>
<span class="s">${selector} span.fx205 {color: #ff5faf;} ${selector} span.bx205 {background-color: #ff5faf;}  ${selector} span.reverse.fx205 {background-color: #ff5faf; color: inherit;} ${selector} span.reverse.bx205 {color: #ff5faf; background-color: inherit;}</span>
<span class="s">${selector} span.fx206 {color: #ff5fd7;} ${selector} span.bx206 {background-color: #ff5fd7;}  ${selector} span.reverse.fx206 {background-color: #ff5fd7; color: inherit;} ${selector} span.reverse.bx206 {color: #ff5fd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx207 {color: #ff5fff;} ${selector} span.bx207 {background-color: #ff5fff;}  ${selector} span.reverse.fx207 {background-color: #ff5fff; color: inherit;} ${selector} span.reverse.bx207 {color: #ff5fff; background-color: inherit;}</span>
<span class="s">${selector} span.fx208 {color: #ff8700;} ${selector} span.bx208 {background-color: #ff8700;}  ${selector} span.reverse.fx208 {background-color: #ff8700; color: inherit;} ${selector} span.reverse.bx208 {color: #ff8700; background-color: inherit;}</span>
<span class="s">${selector} span.fx209 {color: #ff875f;} ${selector} span.bx209 {background-color: #ff875f;}  ${selector} span.reverse.fx209 {background-color: #ff875f; color: inherit;} ${selector} span.reverse.bx209 {color: #ff875f; background-color: inherit;}</span>
<span class="s">${selector} span.fx210 {color: #ff8787;} ${selector} span.bx210 {background-color: #ff8787;}  ${selector} span.reverse.fx210 {background-color: #ff8787; color: inherit;} ${selector} span.reverse.bx210 {color: #ff8787; background-color: inherit;}</span>
<span class="s">${selector} span.fx211 {color: #ff87af;} ${selector} span.bx211 {background-color: #ff87af;}  ${selector} span.reverse.fx211 {background-color: #ff87af; color: inherit;} ${selector} span.reverse.bx211 {color: #ff87af; background-color: inherit;}</span>
<span class="s">${selector} span.fx212 {color: #ff87d7;} ${selector} span.bx212 {background-color: #ff87d7;}  ${selector} span.reverse.fx212 {background-color: #ff87d7; color: inherit;} ${selector} span.reverse.bx212 {color: #ff87d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx213 {color: #ff87ff;} ${selector} span.bx213 {background-color: #ff87ff;}  ${selector} span.reverse.fx213 {background-color: #ff87ff; color: inherit;} ${selector} span.reverse.bx213 {color: #ff87ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx214 {color: #ffaf00;} ${selector} span.bx214 {background-color: #ffaf00;}  ${selector} span.reverse.fx214 {background-color: #ffaf00; color: inherit;} ${selector} span.reverse.bx214 {color: #ffaf00; background-color: inherit;}</span>
<span class="s">${selector} span.fx215 {color: #ffaf5f;} ${selector} span.bx215 {background-color: #ffaf5f;}  ${selector} span.reverse.fx215 {background-color: #ffaf5f; color: inherit;} ${selector} span.reverse.bx215 {color: #ffaf5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx216 {color: #ffaf87;} ${selector} span.bx216 {background-color: #ffaf87;}  ${selector} span.reverse.fx216 {background-color: #ffaf87; color: inherit;} ${selector} span.reverse.bx216 {color: #ffaf87; background-color: inherit;}</span>
<span class="s">${selector} span.fx217 {color: #ffafaf;} ${selector} span.bx217 {background-color: #ffafaf;}  ${selector} span.reverse.fx217 {background-color: #ffafaf; color: inherit;} ${selector} span.reverse.bx217 {color: #ffafaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx218 {color: #ffafd7;} ${selector} span.bx218 {background-color: #ffafd7;}  ${selector} span.reverse.fx218 {background-color: #ffafd7; color: inherit;} ${selector} span.reverse.bx218 {color: #ffafd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx219 {color: #ffafff;} ${selector} span.bx219 {background-color: #ffafff;}  ${selector} span.reverse.fx219 {background-color: #ffafff; color: inherit;} ${selector} span.reverse.bx219 {color: #ffafff; background-color: inherit;}</span>
<span class="s">${selector} span.fx220 {color: #ffd700;} ${selector} span.bx220 {background-color: #ffd700;}  ${selector} span.reverse.fx220 {background-color: #ffd700; color: inherit;} ${selector} span.reverse.bx220 {color: #ffd700; background-color: inherit;}</span>
<span class="s">${selector} span.fx221 {color: #ffd75f;} ${selector} span.bx221 {background-color: #ffd75f;}  ${selector} span.reverse.fx221 {background-color: #ffd75f; color: inherit;} ${selector} span.reverse.bx221 {color: #ffd75f; background-color: inherit;}</span>
<span class="s">${selector} span.fx222 {color: #ffd787;} ${selector} span.bx222 {background-color: #ffd787;}  ${selector} span.reverse.fx222 {background-color: #ffd787; color: inherit;} ${selector} span.reverse.bx222 {color: #ffd787; background-color: inherit;}</span>
<span class="s">${selector} span.fx223 {color: #ffd7af;} ${selector} span.bx223 {background-color: #ffd7af;}  ${selector} span.reverse.fx223 {background-color: #ffd7af; color: inherit;} ${selector} span.reverse.bx223 {color: #ffd7af; background-color: inherit;}</span>
<span class="s">${selector} span.fx224 {color: #ffd7d7;} ${selector} span.bx224 {background-color: #ffd7d7;}  ${selector} span.reverse.fx224 {background-color: #ffd7d7; color: inherit;} ${selector} span.reverse.bx224 {color: #ffd7d7; background-color: inherit;}</span>
<span class="s">${selector} span.fx225 {color: #ffd7ff;} ${selector} span.bx225 {background-color: #ffd7ff;}  ${selector} span.reverse.fx225 {background-color: #ffd7ff; color: inherit;} ${selector} span.reverse.bx225 {color: #ffd7ff; background-color: inherit;}</span>
<span class="s">${selector} span.fx226 {color: #ffff00;} ${selector} span.bx226 {background-color: #ffff00;}  ${selector} span.reverse.fx226 {background-color: #ffff00; color: inherit;} ${selector} span.reverse.bx226 {color: #ffff00; background-color: inherit;}</span>
<span class="s">${selector} span.fx227 {color: #ffff5f;} ${selector} span.bx227 {background-color: #ffff5f;}  ${selector} span.reverse.fx227 {background-color: #ffff5f; color: inherit;} ${selector} span.reverse.bx227 {color: #ffff5f; background-color: inherit;}</span>
<span class="s">${selector} span.fx228 {color: #ffff87;} ${selector} span.bx228 {background-color: #ffff87;}  ${selector} span.reverse.fx228 {background-color: #ffff87; color: inherit;} ${selector} span.reverse.bx228 {color: #ffff87; background-color: inherit;}</span>
<span class="s">${selector} span.fx229 {color: #ffffaf;} ${selector} span.bx229 {background-color: #ffffaf;}  ${selector} span.reverse.fx229 {background-color: #ffffaf; color: inherit;} ${selector} span.reverse.bx229 {color: #ffffaf; background-color: inherit;}</span>
<span class="s">${selector} span.fx230 {color: #ffffd7;} ${selector} span.bx230 {background-color: #ffffd7;}  ${selector} span.reverse.fx230 {background-color: #ffffd7; color: inherit;} ${selector} span.reverse.bx230 {color: #ffffd7; background-color: inherit;}</span>
<span class="s">${selector} span.fx231 {color: #ffffff;} ${selector} span.bx231 {background-color: #ffffff;}  ${selector} span.reverse.fx231 {background-color: #ffffff; color: inherit;} ${selector} span.reverse.bx231 {color: #ffffff; background-color: inherit;}</span>
<span class="s">${selector} span.fx232 {color: #080808;} ${selector} span.bx232 {background-color: #080808;}  ${selector} span.reverse.fx232 {background-color: #080808; color: inherit;} ${selector} span.reverse.bx232 {color: #080808; background-color: inherit;}</span>
<span class="s">${selector} span.fx233 {color: #121212;} ${selector} span.bx233 {background-color: #121212;}  ${selector} span.reverse.fx233 {background-color: #121212; color: inherit;} ${selector} span.reverse.bx233 {color: #121212; background-color: inherit;}</span>
<span class="s">${selector} span.fx234 {color: #1c1c1c;} ${selector} span.bx234 {background-color: #1c1c1c;}  ${selector} span.reverse.fx234 {background-color: #1c1c1c; color: inherit;} ${selector} span.reverse.bx234 {color: #1c1c1c; background-color: inherit;}</span>
<span class="s">${selector} span.fx235 {color: #262626;} ${selector} span.bx235 {background-color: #262626;}  ${selector} span.reverse.fx235 {background-color: #262626; color: inherit;} ${selector} span.reverse.bx235 {color: #262626; background-color: inherit;}</span>
<span class="s">${selector} span.fx236 {color: #303030;} ${selector} span.bx236 {background-color: #303030;}  ${selector} span.reverse.fx236 {background-color: #303030; color: inherit;} ${selector} span.reverse.bx236 {color: #303030; background-color: inherit;}</span>
<span class="s">${selector} span.fx237 {color: #3a3a3a;} ${selector} span.bx237 {background-color: #3a3a3a;}  ${selector} span.reverse.fx237 {background-color: #3a3a3a; color: inherit;} ${selector} span.reverse.bx237 {color: #3a3a3a; background-color: inherit;}</span>
<span class="s">${selector} span.fx238 {color: #444444;} ${selector} span.bx238 {background-color: #444444;}  ${selector} span.reverse.fx238 {background-color: #444444; color: inherit;} ${selector} span.reverse.bx238 {color: #444444; background-color: inherit;}</span>
<span class="s">${selector} span.fx239 {color: #4e4e4e;} ${selector} span.bx239 {background-color: #4e4e4e;}  ${selector} span.reverse.fx239 {background-color: #4e4e4e; color: inherit;} ${selector} span.reverse.bx239 {color: #4e4e4e; background-color: inherit;}</span>
<span class="s">${selector} span.fx240 {color: #585858;} ${selector} span.bx240 {background-color: #585858;}  ${selector} span.reverse.fx240 {background-color: #585858; color: inherit;} ${selector} span.reverse.bx240 {color: #585858; background-color: inherit;}</span>
<span class="s">${selector} span.fx241 {color: #626262;} ${selector} span.bx241 {background-color: #626262;}  ${selector} span.reverse.fx241 {background-color: #626262; color: inherit;} ${selector} span.reverse.bx241 {color: #626262; background-color: inherit;}</span>
<span class="s">${selector} span.fx242 {color: #6c6c6c;} ${selector} span.bx242 {background-color: #6c6c6c;}  ${selector} span.reverse.fx242 {background-color: #6c6c6c; color: inherit;} ${selector} span.reverse.bx242 {color: #6c6c6c; background-color: inherit;}</span>
<span class="s">${selector} span.fx243 {color: #767676;} ${selector} span.bx243 {background-color: #767676;}  ${selector} span.reverse.fx243 {background-color: #767676; color: inherit;} ${selector} span.reverse.bx243 {color: #767676; background-color: inherit;}</span>
<span class="s">${selector} span.fx244 {color: #808080;} ${selector} span.bx244 {background-color: #808080;}  ${selector} span.reverse.fx244 {background-color: #808080; color: inherit;} ${selector} span.reverse.bx244 {color: #808080; background-color: inherit;}</span>
<span class="s">${selector} span.fx245 {color: #8a8a8a;} ${selector} span.bx245 {background-color: #8a8a8a;}  ${selector} span.reverse.fx245 {background-color: #8a8a8a; color: inherit;} ${selector} span.reverse.bx245 {color: #8a8a8a; background-color: inherit;}</span>
<span class="s">${selector} span.fx246 {color: #949494;} ${selector} span.bx246 {background-color: #949494;}  ${selector} span.reverse.fx246 {background-color: #949494; color: inherit;} ${selector} span.reverse.bx246 {color: #949494; background-color: inherit;}</span>
<span class="s">${selector} span.fx247 {color: #9e9e9e;} ${selector} span.bx247 {background-color: #9e9e9e;}  ${selector} span.reverse.fx247 {background-color: #9e9e9e; color: inherit;} ${selector} span.reverse.bx247 {color: #9e9e9e; background-color: inherit;}</span>
<span class="s">${selector} span.fx248 {color: #a8a8a8;} ${selector} span.bx248 {background-color: #a8a8a8;}  ${selector} span.reverse.fx248 {background-color: #a8a8a8; color: inherit;} ${selector} span.reverse.bx248 {color: #a8a8a8; background-color: inherit;}</span>
<span class="s">${selector} span.fx249 {color: #b2b2b2;} ${selector} span.bx249 {background-color: #b2b2b2;}  ${selector} span.reverse.fx249 {background-color: #b2b2b2; color: inherit;} ${selector} span.reverse.bx249 {color: #b2b2b2; background-color: inherit;}</span>
<span class="s">${selector} span.fx250 {color: #bcbcbc;} ${selector} span.bx250 {background-color: #bcbcbc;}  ${selector} span.reverse.fx250 {background-color: #bcbcbc; color: inherit;} ${selector} span.reverse.bx250 {color: #bcbcbc; background-color: inherit;}</span>
<span class="s">${selector} span.fx251 {color: #c6c6c6;} ${selector} span.bx251 {background-color: #c6c6c6;}  ${selector} span.reverse.fx251 {background-color: #c6c6c6; color: inherit;} ${selector} span.reverse.bx251 {color: #c6c6c6; background-color: inherit;}</span>
<span class="s">${selector} span.fx252 {color: #d0d0d0;} ${selector} span.bx252 {background-color: #d0d0d0;}  ${selector} span.reverse.fx252 {background-color: #d0d0d0; color: inherit;} ${selector} span.reverse.bx252 {color: #d0d0d0; background-color: inherit;}</span>
<span class="s">${selector} span.fx253 {color: #dadada;} ${selector} span.bx253 {background-color: #dadada;}  ${selector} span.reverse.fx253 {background-color: #dadada; color: inherit;} ${selector} span.reverse.bx253 {color: #dadada; background-color: inherit;}</span>
<span class="s">${selector} span.fx254 {color: #e4e4e4;} ${selector} span.bx254 {background-color: #e4e4e4;}  ${selector} span.reverse.fx254 {background-color: #e4e4e4; color: inherit;} ${selector} span.reverse.bx254 {color: #e4e4e4; background-color: inherit;}</span>
<span class="s">${selector} span.fx255 {color: #eeeeee;} ${selector} span.bx255 {background-color: #eeeeee;}  ${selector} span.reverse.fx255 {background-color: #eeeeee; color: inherit;} ${selector} span.reverse.bx255 {color: #eeeeee; background-color: inherit;}</span>

<span class="s">${selector} span.cursor { color: #000; background-color: #ccc; }&quot;&quot;&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/ls_logo_1inch_300dpi.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Gate One Documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2011, Liftoff Software Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
<script type="text/javascript">
window.onload = function(e) {
    // Make our collapseindex elements actually collapsible
    $('<span class="collapsindextitle">Index</span> <a class="showhide">[show]</a>').insertBefore('.collapseindex');
    $('.showhide').each(function(index, value){
        var showHide = $(this);
        showHide.click(function() {
            if (this.innerHTML == "[hide]") {
                this.innerHTML = "[show]";
            } else {
                this.innerHTML = "[hide]";
            }
            $(this).next('.collapseindex').toggle(1); // This should always be the next .collapseindex element
        });
    });
    $('.collapseindex').each(function(index, value){
        // Start them out hidden
        $(this).hide();
    });
}
</script>

  </body>
</html>