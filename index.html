<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interface</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/font-awesome.css"></link>
    <link rel="stylesheet" href="css/salvius.css"></link>
</head>

<body>

    <nav class="top-bar" data-topbar>
      <ul class="title-area">
        <li class="name">
          <h1><a href="#">Interface</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
      </ul>

      <section class="top-bar-section">

        <ul class="right">
            <li style="width:200px">
                <div class="progress success">
                    <span class="meter" style="width: 80%"><label>80%</label></span>
                </div>
            </li>
            <li class="has-dropdown">
                <a href="#"><i class="icon-cog"></i></a>
                <ul class="dropdown">
                    <li><a href="#"><i class="icon-off"></i> Shutdown</a></li>
                </ul>
            </li>
        </ul>

        <ul class="left">
            <li class="has-dropdown">
                <a href="#"><i class="icon-wrench"></i> Configuration</a>
                <ul class="dropdown">
                    <li><label>Rapsberry Pi IP</label></li>
                    <li class="has-form">
                        <div class="row collapse">
                            <div class="small-10 columns">
                                <input type="text" placeholder="http://0.0.0.0">
                            </div>
                            <div class="small-2 columns">
                                <a href="#" class="postfix button ok"><i class="icon-ok-sign"></i></a>
                            </div>
                        </div>
                    </li>
                    <li><label>Camera IP</label></li>
                    <li class="has-form">
                        <div class="row collapse">
                            <div class="small-10 columns">
                                <input type="text" placeholder="http://0.0.0.0">
                            </div>
                            <div class="small-2 columns">
                                <a href="#" class="postfix button ok"><i class="icon-ok-sign"></i></a>
                            </div>
                        </div>
                    </li>
                    <li><label>Arduino IP</label></li>
                    <li class="has-form">
                        <div class="row collapse">
                            <div class="small-10 columns">
                                <input type="text" placeholder="http://0.0.0.0">
                            </div>
                            <div class="small-2 columns">
                                <a href="#" class="postfix button ok"><i class="icon-ok-sign"></i></a>
                            </div>
                        </div>
                    </li>
                    <li>
                        <a href="http://www.routerlogin.net"><i class="icon-external-link"></i> Router Login</a>
                    </li>
                </ul>
            </li>
        </ul>
      </section>
    </nav>

    <div data-alert id="camError" class="alert-box warning" style="display:none">
        Camera input is unavailable.
        <a href="#" class="close">&times;</a>
    </div>
    <div data-alert id="apiError" class="alert-box warning" style="display:none">
        Arduino api is unavailable.
        <a href="#" class="close">&times;</a>
    </div>

    <div data-alert id="shutdown" class="alert-box shutdown" style="display:none">
	    <h2 style="color:#f00"><i class="icon-warning-sign"></i> Emergency Shutdown</h2>
	    <section>
	    <a href="#" class="pushbutton on" id="button"><i class="icon-off"></i></a>
	    <span class="led"></span>
	    </section>
	    <p style="color:#F60">WARNING: This operation will deactivate all systems on the robot. Sudden deactivation may cause damage to the robot and objects near by.</p>
    </div>

    <div class="row">

        <div class="large-3 columns">
            <div class="row collapse">
                <div class="small-9 columns">
                    <input type="text" placeholder="Text to Speech"/>
                </div>
                <div class="small-3 columns">
                    <button class="button prefix"><i class="icon-bullhorn"></i> Say</button>
                </div>
            </div>
            <div class="row collapse">
                <div class="small-9 columns">
                    <input type="text" placeholder="Text to Handwriting"/>
                </div>
                <div class="small-3 columns">
                    <button class="button prefix"><i class="icon-pencil"></i> Write</button>
                </div>
            </div>
        </div>

        <div class="large-6 columns">
            <canvas id="cam" class="small-12"/>
            <div id="txt">0</div>
        </div>

        <div class="large-3 columns">
            <div class="row">
                <button class="small button large-12 columns toggle"><i class="icon-lightbulb"></i> Infrared</button>
            </div>
            <div class="row">
                <button class="small button small-6 columns toggle"><i class="icon-male"></i> Stand Up</button>
                <button class="small button small-6 columns toggle"><i class="icon-male icon-rotate-270"></i> Sit Down</button>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="large-6 columns">
            <input type="text" placeholder="Filter available sensors"/>
            <table style="width:100%">
                <thead>
                    <tr>
                        <th class="center"><i class="icon-compass"></i> Sensor</th>
                        <th class="center">Value</th>
                    </tr>
                </thead>
                <tbody class="sensorValues">
                </tbody>
            </table>
        </div>
    </div>

<script src="./js/jquery.js"></script>
<script src="js/foundation/foundation.js"></script>
<script src="js/foundation/foundation.topbar.js"></script>
<script type="text/javascript">
$(document).foundation();

var cameraImage = "http://192.168.1.2/image.jpg";
var arduinoJson = "http://192.168.1.177/json";

var iUpdateMs = 100;
var count = 0;
var newImg;

$.get(cameraImage, function(data) {
    setTimeout("imageupdate()", iUpdateMs );
}).error(function() {
    $("#camError").show();
});

function imageupdate() {
	document.getElementById("txt").innerHTML = count++;

	newImg = new Image();
	newImg.Id = "camimg" + count;
	newImg.Name = newImg.Id;
	newImg.onload = imageLoaded;
	newImg.src = cameraImage + "?u=" + count;
}

function imageLoaded() {
	var drawingCanvas = document.getElementById("cam");

	// Check if the browser supports canvas
	if(drawingCanvas.getContext) {
		var context = drawingCanvas.getContext("2d");
		context.drawImage(newImg,0,0,640,480,0,0,300,150);
	}

	setTimeout("imageupdate()", iUpdateMs);
}

// Hide alerts on click
$(".alert-box").click(function() {
    $(this).fadeOut();
});

$.ajax({ 
    type: 'GET', 
    url: arduinoJson, 
    data: { get_param: 'value' }, 
    dataType: 'json',
    success: function (data) { 
        $.each(data, function(index, element) {
            $('.sensorValues').append('<tr><td>' + index + '</td><td>' + element + '</td></tr>');
        });
    }
}).error(function() {
    $("#apiError").show();
});;
</script>
</body>
</html>
